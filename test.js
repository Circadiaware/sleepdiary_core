(function(){/*
 Copyright 2020-2022 Sleepdiary Developers <sleepdiary@pileofstuff.org>

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use, copy,
 modify, merge, publish, distribute, sublicense, and/or sell copies
 of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.
*/
function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ba(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}var ca="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},da="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ea(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var fa=ea(this);function E(a,b){if(b)a:{var c=fa;a=a.split(".");for(var g=0;g<a.length-1;g++){var f=a[g];if(!(f in c))break a;c=c[f]}a=a[a.length-1];g=c[a];b=b(g);b!=g&&null!=b&&da(c,a,{configurable:!0,writable:!0,value:b})}}var ha;
if("function"==typeof Object.setPrototypeOf)ha=Object.setPrototypeOf;else{var ia;a:{var ja={a:!0},la={};try{la.__proto__=ja;ia=la.a;break a}catch(a){}ia=!1}ha=ia?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ma=ha;
function na(a,b){a.prototype=ca(b.prototype);a.prototype.constructor=a;if(ma)ma(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(b,c);g&&Object.defineProperty(a,c,g)}else a[c]=b[c];a.ua=b.prototype}
E("Symbol",function(a){function b(d){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(g+(d||"")+"_"+f++,d)}function c(d,h){this.h=d;da(this,"description",{configurable:!0,writable:!0,value:h})}if(a)return a;c.prototype.toString=function(){return this.h};var g="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",f=0;return b});
E("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var g=fa[b[c]];"function"===typeof g&&"function"!=typeof g.prototype[a]&&da(g.prototype,a,{configurable:!0,writable:!0,value:function(){return oa(aa(this))}})}return a});function oa(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function pa(a,b){a instanceof String&&(a+="");var c=0,g=!1,f={next:function(){if(!g&&c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}g=!0;return{done:!0,value:void 0}}};f[Symbol.iterator]=function(){return f};return f}E("Array.prototype.keys",function(a){return a?a:function(){return pa(this,function(b){return b})}});E("Math.log10",function(a){return a?a:function(b){return Math.log(b)/Math.LN10}});
var qa="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var g=arguments[c];if(g)for(var f in g)Object.prototype.hasOwnProperty.call(g,f)&&(a[f]=g[f])}return a};E("Object.assign",function(a){return a||qa});
E("Array.from",function(a){return a?a:function(b,c,g){c=null!=c?c:function(e){return e};var f=[],d="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof d){b=d.call(b);for(var h=0;!(d=b.next()).done;)f.push(c.call(g,d.value,h++))}else for(d=b.length,h=0;h<d;h++)f.push(c.call(g,b[h],h));return f}});
E("Promise",function(a){function b(h){this.j=0;this.o=void 0;this.h=[];this.P=!1;var e=this.D();try{h(e.resolve,e.reject)}catch(p){e.reject(p)}}function c(){this.h=null}function g(h){return h instanceof b?h:new b(function(e){e(h)})}if(a)return a;c.prototype.j=function(h){if(null==this.h){this.h=[];var e=this;this.o(function(){e.F()})}this.h.push(h)};var f=fa.setTimeout;c.prototype.o=function(h){f(h,0)};c.prototype.F=function(){for(;this.h&&this.h.length;){var h=this.h;this.h=[];for(var e=0;e<h.length;++e){var p=
h[e];h[e]=null;try{p()}catch(k){this.D(k)}}}this.h=null};c.prototype.D=function(h){this.o(function(){throw h;})};b.prototype.D=function(){function h(k){return function(l){p||(p=!0,k.call(e,l))}}var e=this,p=!1;return{resolve:h(this.T),reject:h(this.F)}};b.prototype.T=function(h){if(h===this)this.F(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof b)this.V(h);else{a:switch(typeof h){case "object":var e=null!=h;break a;case "function":e=!0;break a;default:e=!1}e?this.S(h):this.O(h)}};
b.prototype.S=function(h){var e=void 0;try{e=h.then}catch(p){this.F(p);return}"function"==typeof e?this.W(e,h):this.O(h)};b.prototype.F=function(h){this.R(2,h)};b.prototype.O=function(h){this.R(1,h)};b.prototype.R=function(h,e){if(0!=this.j)throw Error("Cannot settle("+h+", "+e+"): Promise already settled in state"+this.j);this.j=h;this.o=e;2===this.j&&this.U();this.aa()};b.prototype.U=function(){var h=this;f(function(){if(h.ba()){var e=fa.console;"undefined"!==typeof e&&e.error(h.o)}},1)};b.prototype.ba=
function(){if(this.P)return!1;var h=fa.CustomEvent,e=fa.Event,p=fa.dispatchEvent;if("undefined"===typeof p)return!0;"function"===typeof h?h=new h("unhandledrejection",{cancelable:!0}):"function"===typeof e?h=new e("unhandledrejection",{cancelable:!0}):(h=fa.document.createEvent("CustomEvent"),h.initCustomEvent("unhandledrejection",!1,!0,h));h.promise=this;h.reason=this.o;return p(h)};b.prototype.aa=function(){if(null!=this.h){for(var h=0;h<this.h.length;++h)d.j(this.h[h]);this.h=null}};var d=new c;
b.prototype.V=function(h){var e=this.D();h.I(e.resolve,e.reject)};b.prototype.W=function(h,e){var p=this.D();try{h.call(e,p.resolve,p.reject)}catch(k){p.reject(k)}};b.prototype.then=function(h,e){function p(n,r){return"function"==typeof n?function(x){try{k(n(x))}catch(J){l(J)}}:r}var k,l,q=new b(function(n,r){k=n;l=r});this.I(p(h,k),p(e,l));return q};b.prototype.catch=function(h){return this.then(void 0,h)};b.prototype.I=function(h,e){function p(){switch(k.j){case 1:h(k.o);break;case 2:e(k.o);break;
default:throw Error("Unexpected state: "+k.j);}}var k=this;null==this.h?d.j(p):this.h.push(p);this.P=!0};b.resolve=g;b.reject=function(h){return new b(function(e,p){p(h)})};b.race=function(h){return new b(function(e,p){for(var k=ba(h),l=k.next();!l.done;l=k.next())g(l.value).I(e,p)})};b.all=function(h){var e=ba(h),p=e.next();return p.done?g([]):new b(function(k,l){function q(x){return function(J){n[x]=J;r--;0==r&&k(n)}}var n=[],r=0;do n.push(void 0),r++,g(p.value).I(q(n.length-1),l),p=e.next();while(!p.done)})};
return b});E("Array.prototype.find",function(a){return a?a:function(b,c){a:{var g=this;g instanceof String&&(g=String(g));for(var f=g.length,d=0;d<f;d++){var h=g[d];if(b.call(c,h,d,g)){b=h;break a}}b=void 0}return b}});E("Object.values",function(a){return a?a:function(b){var c=[],g;for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&c.push(b[g]);return c}});
E("Array.prototype.fill",function(a){return a?a:function(b,c,g){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==g||g>f)g=f;g=Number(g);0>g&&(g=Math.max(0,f+g));for(c=Number(c||0);c<g;c++)this[c]=b;return this}});function ra(a){return a?a:Array.prototype.fill}E("Int8Array.prototype.fill",ra);E("Uint8Array.prototype.fill",ra);E("Uint8ClampedArray.prototype.fill",ra);E("Int16Array.prototype.fill",ra);E("Uint16Array.prototype.fill",ra);E("Int32Array.prototype.fill",ra);
E("Uint32Array.prototype.fill",ra);E("Float32Array.prototype.fill",ra);E("Float64Array.prototype.fill",ra);var sa={},ta=[],ua,va=(new Intl.DateTimeFormat).resolvedOptions().timeZone;ua="UTC"==va?"Etc/GMT":va;function G(a,b){b&&(this.h=b)}G.file_format=function(){return"DiaryBase"};G.prototype.merge=function(){return this};G.prototype.clone=function(){return I({file_format:"storage-line",contents:{file_format:this.file_format(),contents:JSON.parse(JSON.stringify(this,function(a,b){return"spreadsheet"==a?void 0:b}))}},this.h)};
G.prototype.to=function(a){switch(a){case this.file_format():return this;case "url":return"sleepdiary="+encodeURIComponent(JSON.stringify({file_format:this.file_format(),contents:this},function(b,c){return"spreadsheet"==b?void 0:c}));case "json":return JSON.stringify(this,function(b,c){return"spreadsheet"==b?void 0:c});case "storage-line":return"storage-line:"+this.file_format()+":"+JSON.stringify(this,function(b,c){return"spreadsheet"==b?void 0:c});default:if(sa.hasOwnProperty(a))return new sa[a](this.to("Standard"),
this.h);throw Error(this.file_format()+" cannot be converted to "+a);}};G.prototype.to_async=function(a){switch(a){case "spreadsheet":if(!this.spreadsheet.synchronise())throw Error("Could not synchronise data");return this.spreadsheet.serialise();default:var b=this.to(a);return b.then?b:{then:function(c){return c(b)}}}};function wa(a,b){return a.h?a.h(b):b}
function xa(a){var b=a.prototype.format_info();b.constructor=a;ta.push(b);"/"==b.url[0]&&(b.url="https://sleepdiary.github.io/core"+b.url);"Standard"!=b.name&&(sa[b.name]=b.constructor)}function N(){throw null;}function ya(a){throw Error("Does not appear to be a valid "+a.file_format()+" file");}
function za(a,b){switch(b.file_format()){case "url":return b=b.contents,a.file_format()==b.file_format?(Object.keys(b.contents).forEach(function(c){return a[c]=b.contents[c]}),!0):N();case "string":case "spreadsheet":if(a.spreadsheet.load(b))return!0;case "archive":case "array":N()}return!1}function O(a,b){var c="";if(a)for(b=Math.pow(10,(b||2)-1);b>a;b/=10)c+="0";else for(var g=1;g<(b||2);++g)c+="0";return c+a}
function Aa(a){try{var b=self.DOMParser;if(!b)throw"";}catch(c){b=require("@xmldom/xmldom").DOMParser}return(new b).parseFromString(a,"application/xml")}
function Ba(a,b){if(null===a||void 0===a)return NaN;if(a.getTime)return a=a.getTime(),864E5>=a&&(a+=b||0),a;if(a.match){if(b=a.match(/^((19|20)[0-9]{2})[-.]?([0-9]{2})[-.]?([0-9]{2})[T ]?([0-9]{2})[.:]?([0-9]{2})(?:[.:]?([0-9]{2}))?Z?$/))return(new Date(parseInt(b[1],10),parseInt(b[3],10)-1,parseInt(b[4],10),parseInt(b[5],10),parseInt(b[6],10),parseInt(b[7]||0,10))).getTime();a.search(/^[0-9]{4,}$/)||(a=parseInt(a,10))}if("number"==typeof a)return b=12-Math.floor(Math.log10(a)),a*Math.pow(10,a&&2<
Math.abs(b)?b:0);if(!a||!a.search)return NaN;b=(-1==a.search(/[a-su-y]/i)&&-1!=a.search(/-.*-/)?a:a.replace(/\s*(-|to).*/,"")).replace(/([ap])\s*(m)/i,"$1$2").toLowerCase();if(-1!=b.search(/midnight/i))return 0;if(-1!=b.search(/midd?ay|noon|12pm/i))return 432E5;var c=b.match(/^([0-9]*)(:([0-9]*))?\s*([ap])m$/);return c?36E5*(parseInt(c[1],10)+parseInt(c[3]||"0",10)/60+("p"==c[4]?12:0)):(c=b.match(/^([0-9]*)(:([0-9]*))?(:([0-9]*))?$/))?36E5*(parseInt(c[1],10)+parseInt(c[3]||"0",10)/60+parseInt(c[5]||
"0",10)/3600):Date.parse(b)||Date.parse(a)}function Ca(a,b,c){if("function"!=typeof c){var g=c;c=function(d){return g.map(function(h){return d[h]}).join("\ue000")}}var f={};a.forEach(function(d){return f[c(d)]=1});return b.filter(function(d){return!f.hasOwnProperty(c(d))})}function Da(){try{var a=self.tc;if(!a)throw"";}catch(b){a=require("timezonecomplete")}return a}function R(a,b){var c=Da();a=new c.DateTime(a||0,c.zone("Etc/UTC"));return b?a.toZone(c.zone(b)):a}
function Ea(a,b){for(var c=Da().TzDatabase.instance(),g=a-1728E5;g<a;g+=36E5)try{var f=c.nextDstChange(b,g);if(!f)return Infinity;if(f>a)return f}catch(d){return Infinity}return c.nextDstChange(b,a)||Infinity}
function Fa(){return[["awake","w.ke",""],["asleep","sle*p(?!.*aid)","#FFFFFF00,#FF0000FF,#FFFFFFFF"],["lights off","light.*(?:out|off)","#FFFFFFFF,#FF000080,#FFFFFFFF"],["lights on","light.*on","#FFFFFFFF,#FFE6E6FF"],["snack","snack","#FFFF7FFF,#FF7FFF7F"],["meal","meal|eat","#FFFF00FF,#FF00FF00"],["alcohol","alco","#FF1FAFEF,#FFE05010,#FFFFFFFF"],["chocolate","choc","#FF84C0FF,#FF7B3F00,#FFFFFFFF"],["caffeine","caffeine|coffee|tea|cola","#FF0B3B8B,#FFF4C474"],["drink","drink","#FFDF8F5F,#FF2070a0,#FFFFFFFF"],
["sleep aid","sle*p.*aid|pill|tranq","#FFAFFF7F,#FF500080,#FFFFFFFF"],["exercise","exercise","#FF00C0C0,#FFFF3F3F"],["toilet","toilet|bathroom|loo","#FF363636,#FFC9C9C9"],["noise","noise","#FF8F8F8F,#FF707070,#FFFFFFFF"],["alarm","alarm","#FF000000,#FFFF0000"],["in bed","down|(in|to).*bed","#FFA0A000,#FF5f5fff"],["out of bed","up|out.*bed","#FF0000FF,#FFFFFFCC"]]}G.prototype.timezones=function(){return Object.keys(self.tzdata.zones).sort()};G.prototype.software_version=function(){return"2def2ce"};
function I(a,b){var c=Error("This does not appear to be a sleep diary"),g=a.file_format;if("string"==typeof a)g="string",a={file_format:function(){return"string"},contents:a};else if(g)"string"==typeof g?a.file_format=function(){return g}:g=g(),"url"==g?a.contents=JSON.parse(decodeURIComponent(a.contents.replace(/^sleep-?diary=/,""))):"storage-line"==g&&(g="url");else throw c;"string"==g&&Object.assign(a,Ga(a.contents));for(var f=0;f!=ta.length;++f)try{return new ta[f].constructor(a,b)}catch(d){d&&
(c=d)}throw c;};function Ha(a,b,c){function g(h){return function(){(history.state||{})["sleepdiary-core-processed"]||location.hash.replace(/(?:^#|[?&])(sleep-?diary=[^&]*)/g,function(e,p){history.replaceState(Object.assign({"sleepdiary-core-processed":c},history.state||{}),"");d.load({file_format:"url",contents:p},h)})}}this.success_callback=a||function(){};this.error_callback=b||function(){};var f,d=this;2!=c&&(f=setInterval(function(){self.tc&&(clearInterval(f),self.addEventListener("hashchange",g("hashchange"),
!1),g("hash")())},100));Ia()}function Ja(){return[[self.JSZip,"https://cdn.jsdelivr.net/npm/jszip@3.6.x/dist/jszip.min.js"],[self.tc,"https://cdn.jsdelivr.net/npm/tzdata@1.0.x/tzdata.js","https://cdn.jsdelivr.net/npm/timezonecomplete@5.12.x/dist/timezonecomplete.min.js"],[self.ExcelJS,"https://cdn.jsdelivr.net/npm/exceljs@4.2.x/dist/exceljs.min.js"]]}
function Ia(){try{var a=[];Ja().forEach(function(b){b[0]||(a=a.concat(b.slice(1)))});self.importScripts?self.importScripts.apply(self,a):a.forEach(function(b){var c=document.createElement("script");c.src=b;document.head.appendChild(c)})}catch(b){}}
Ha.prototype.load=function(a,b){var c=this;if(Ja().some(function(h){return!h[0]}))return setTimeout(function(){return c.load(a,b)},100);var g=self.JSZip;if(!g)return setTimeout(function(){return c.load(a,b)},100);if("string"==typeof a&&!a.search(/^(blob|data):/)){var f=new XMLHttpRequest;f.responseType="blob";f.onload=function(){return c.load([f.response],b)};f.open("GET",a);return f.send()}b||(b=a);a.target&&a.target.files&&(a=a.target.files);a.replace&&a.replace(/^storage-line:([^:]+):(.*)/,function(h,
e,p){a={file_format:"storage-line",contents:{file_format:e,contents:JSON.parse(p)}}});if("string"!=typeof a&&a.length)Array.from(a).forEach(function(h){var e=new FileReader,p=new g;e.onload=function(){return Ka(e.result).then(function(k){return c.load(k,b)},function(){return p.loadAsync(e.result).then(function(k){function l(){n.length?k.file(n[0]).async("string").then(function(r){q[n[0]]=r;n.shift();l()}):c.load({file_format:"archive",contents:q},b)}var q={},n=Object.keys(k.files);l()},function(){var k=
c.error_callback;try{c.error_callback=function(){},c.load({file_format:"array",contents:e.result},b),c.error_callback=k}catch(l){c.error_callback=k,e.onload=function(){return c.load({file_format:"string",contents:e.result},b)},e.readAsText(h)}})})};e.readAsArrayBuffer(h)});else{try{var d=self.new_sleep_diary(a,Ha.serialiser)}catch(h){throw this.error_callback(a,b),h;}d?this.success_callback(d,b):this.error_callback(a,b)}};
Ha.serialiser=function(a){switch(a.file_format()){case "array":return a.contents;case "string":return btoa(unescape(encodeURIComponent(a.contents)));case "archive":var b=function(c,g){var f=self.JSZip;if(!f)return setTimeout(function(){return b(c,g)},100);var d=new f;Object.keys(a.contents).forEach(function(h){return d.file(h,a.contents[h])});return d.generateAsync({type:"base64",compression:"DEFLATE"}).then(c,g)};Ia();return new Promise(b);default:throw Error("Unsupported output format: "+a.file_format());
}};Ha.to_url=function(a){if("string"==typeof a)return"data:application/octet-stream;base64,"+a;a.file_format&&a.contents&&("archive"==a.file_format()?a=JSON.stringify(a):a=a.contents);return URL.createObjectURL(new Blob([a]))};var La={number:"General",time:'YYYY-MM-DD" "HH:MM',duration:"[h]:mm"};
function S(a,b,c){function g(h){var e=h.member;switch(h.type){case "time":var p=function(l,q,n){return q[n]=T(void 0===l[e]?void 0:new Date(l[e]))};break;case "duration":p=function(l,q,n){return q[n]=T(void 0===l[e]?void 0:l[e]/864E5)};break;default:p=function(l,q,n){return q[n]=T(l[e])}}if(h.optional){var k=p;p=function(l,q,n){return void 0===l[e]||k(l,q,n)}}return p}function f(h,e){var p=h.member;switch(h.type){case "time":var k=c?function(n,r,x){return!isNaN(n[p]=r[x].N)}:function(n,r,x){return!isNaN(n[p]=
r[x].$)};break;case "duration":k=function(n,r,x){return!isNaN(n[p]=r[x].value.getTime()+e.epoch_offset)};break;case "number":k=function(n,r,x){return!isNaN(n[p]=parseFloat(r[x].value))};break;case "boolean":k=function(n,r,x){return!isNaN(n[p]=!!r[x].value)};break;default:k=function(n,r,x){n[p]=r[x].value;return!0}}if(h.regexp){var l=k;k=function(n,r,x){return h.regexp.test(r[x].value)&&l(n,r,x)}}if(h.optional){var q=k;k=function(n,r,x){return!r[x]||null==r[x].value||q(n,r,x)||""==r[x].value}}return k}
var d=this;this.h=null;this.j=a;this.o=b.map(function(h){return{sheet:h.sheet||h.member,member:h.member||h.sheet,type:h.type||"list",optional:!!h.optional,cells:h.cells.map(function(e){if(e.members){for(e.formats=(e.formats||[]).map(function(p){return La[p]||p});e.formats.length<e.members.length;)e.formats.push("General");return e}return{members:[e.member],regexp:e.regexp||RegExp(""),formats:[La[e.type]||"General"],"export":g(e),"import":f(e,d)}})}});this.epoch_offset=0;this.sheets=[]}
function T(a,b){return{value:a,style:b||""}}S.prototype.get_sheet=function(a,b,c){var g=b.join("\x00"),f=this.sheets.filter(function(d){return d.cells[0]&&d.cells[0].map(function(h){return h.value}).join("\x00")==g});return f.length?[!1,f.find(function(d){return d.name==a})||f[0]]:[!0,{name:a,number_formats:c.map(function(d){return d?La[d]||d:"General"}),cells:[b.map(function(d){return T(d,"#FFEEEEEE,#FFEEEEEE")})]}]};
function Na(a,b){return Ba((a||{}).hasOwnProperty("value")?a.value:a,b?(b.properties||{}).date1904?20828448E5:22091616E5:0)}function Oa(a,b){var c=0;a.forEach(function(g){return g.forEach(function(f){var d=f.$=Na(f,b);d=f.N=isNaN(d)||0>d||864E5<d?d:d+c-c%864E5;d<c&&(f.N=d+=864E5);c=d})})}
function Ka(a){function b(g){return g.hasOwnProperty("argb")?"#"+g.argb:g.hasOwnProperty("indexed")?"i"+g.indexed:g.hasOwnProperty("theme")?"t"+g.theme:""}try{var c=new self.ExcelJS.Workbook}catch(g){c=new (require("exceljs").Workbook)}return c.xlsx.load(a).then(function(){if(c._worksheets.length){var g=[];c.eachSheet(function(f){var d={name:f.name,cells:[]};g.push(d);f.eachRow({includeEmpty:!0},function(h,e){var p=d.cells[e-1]=[];h.eachCell({includeEmpty:!0},function(k,l){var q="";k.style&&k.style.fill&&
(q=b(k.style.fill.bgColor||{})+","+b(k.style.fill.fgColor||{}));1==q.length&&(q="");if((k.value||{}).getTime){var n=k.value.getTime();if(1==n%1E3||-999==n%1E3)k.value=new Date(n-1);if(-1==n%1E3||999==n%1E3)k.value=new Date(n+1)}p[l-1]=T(k.value,q)})})});g.forEach(function(f){return Oa(f.cells,c)});return{file_format:"spreadsheet",spreadsheet:c,sheets:g}}throw Error("empty spreadsheet");})}
function Ga(a){"\ufeff"==a[0]&&(a=a.substr(1));-1==a.search(/[\r\n]$/)&&(a+="\n");if(!a.search(RegExp('^(([^",\\r\\n]*|"([^"]|"")*")(,([^",\\r\\n]*|"([^"]|"")*"))*(?:\r\n|\r|\n))*$'))){try{var b=new self.ExcelJS.Workbook}catch(e){b=new (require("exceljs").Workbook)}for(var c=b.addWorksheet("Records"),g=b.addWorksheet("Settings"),f=[],d=0,h=[[T("Setting"),T("Value")]];!a.search(/^([A-Za-z_][A-Za-z0-9_]*)=[^,]*\n/);)a=a.replace(/([^=]*?)=(.*)\n/,function(e,p,k){h.push([p,k].map(function(l){return T(l)}));
g.addRow([p,k]);return""});a.replace(RegExp('([^",\\r\\n]*|"([^"]|"")*")(,([^",\\r\\n]*|"([^"]|"")*"))*(?:\r\n|\r|\n)',"g"),function(e){var p=c.getRow(++d),k=[],l=0;f.push(k);e.replace(RegExp('([^",\\r\\n]*|"([^"]|"")*")[,\r\n]',"g"),function(q){var n=p.getCell(++l);n.value='"'==q[0]?q.substr(1,q.length-3).replace(/""/g,'"'):q.substr(0,q.length-1);k.push(T(n.value))})});Oa(f);return{spreadsheet:b,sheets:[{name:"Records",cells:f},{name:"Settings",cells:h}]}}}
function Pa(a){return void 0===a?"":a.getTime?R(a.getTime()).format("yyyy-MM-ddTHH:mm:ss.SSS")+"Z":-1==a.toString().search(/[",\n]/)?a:'"'+a.replace(/"/g,'""')+'"'}
S.prototype.load=function(a){var b=this,c=a.sheets;if(!c)return!1;var g=this.epoch_offset;this.epoch_offset=(a.spreadsheet.properties||{}).date1904?20828448E5:22091616E5;if(!this.o.every(function(f){return c.some(function(d){var h=d.cells,e="dictionary"==f.type;if(!h.length||e&&2!=h.length)return!1;var p=h[0].slice(0);if(!f.cells.every(function(r){return r.members.every(function(x){return x==(p.shift()||{value:NaN}).value})}))return!1;var k=[];if(!h.slice(1).every(function(r){if(!r.length)return!0;
var x=0,J={};k.push(J);return f.cells.every(function(C){return C["import"](J,r,(x+=C.members.length)-C.members.length)})}))return!1;var l=f.member;if(e)b.j[l]=Object.assign(k[0],b.j[l]||{});else{b.j[l]||(b.j[l]=[]);var q=b.j[l];q.length>=h.length&&q.splice(0,h.length-1);k.forEach(function(r,x){return q[x]=Object.assign(r,q[x])})}var n=[];f.cells.forEach(function(r){return n=n.concat(r.formats)});d.number_formats=n;return!0})}))return this.epoch_offset=g,!1;this.h=a.spreadsheet;this.sheets=c;return!0};
S.prototype.synchronise=function(){var a=this;return this.o.every(function(b){function c(l){var q=[],n=0;p.push(q);return b.cells.every(function(r){return r["export"](l,q,(n+=r.members.length)-r.members.length)})}var g="dictionary"==b.type,f=[],d=[];b.cells.forEach(function(l){f=f.concat(l.members);d=d.concat(l.formats)});var h=a.get_sheet(b.sheet,f,d),e=h[0];h=h[1];var p=h.cells=[f.map(function(l){return T(l,"#FFEEEEEE,#FFEEEEEE")})],k=a.j[b.member||b.sheet];if(g){if(!c(k))return!1}else if(!k.every(c))return!1;
e&&a.sheets.push(h);return!0})};
S.prototype.serialise=function(){function a(d){switch(d[0]){case "#":return{argb:d.slice(1)};case "i":return{indexed:parseInt(d.slice(1),10)};case "t":return{theme:parseInt(d.slice(1),10)};default:return{}}}var b=this,c=!this.h;if(!this.h){try{this.h=new self.ExcelJS.Workbook}catch(d){this.h=new (require("exceljs").Workbook)}this.epoch_offset=(this.h.properties||{}).date1904?20828448E5:22091616E5}var g=this.epoch_offset,f={};this.sheets.forEach(function(d){return f[d.name]=0});this.h.eachSheet(function(d,
h){f.hasOwnProperty(d.name)?f[d.name]=d:b.h.ra(h)});this.sheets.forEach(function(d){var h=f[d.name]||b.h.addWorksheet(d.name,d.options);h.eachRow({includeEmpty:!0},function(e,p){var k=d.cells[p-1]||[];e.eachCell({includeEmpty:!0},function(l,q){k[q]||(l.value=null,l.style={})})});d.cells.forEach(function(e,p){var k=h.getRow(p+1);e.forEach(function(l,q){var n=k.getCell(q+1);n.value=c&&(l.value||{}).getTime&&0<=l.value.getTime()&&864E5>l.value.getTime()?new Date(l.value.getTime()-g):l.value;l=l.style.split(",");
n=n.style=n.style||{};q=((d.styles||[])[q]||{}).font;l[0]||l[1]||l[2]?(n.fill=n.fill||{},n.fill.type="pattern",n.fill.pattern="solid",l[0]?n.fill.bgColor=a(l[0]):delete n.fill.bgColor,l[1]?n.fill.fgColor=a(l[1]):delete n.fill.fgColor,l[2]?(n.font=n.font||{},n.font.color=a(l[2])):delete n.font):n&&n.fill&&(delete n.fill.bgColor,delete n.fill.fgColor);q&&Object.assign(n.font=n.font||{},q)});k.commit()});d.widths?d.widths.forEach(function(e,p){return h.columns[p].width=e}):h.columns.forEach(function(e){return e.width=
18});d.styles&&d.styles.forEach(function(e,p){return h.columns[p].style=e});(d.number_formats||[]).forEach(function(e,p){return h.getColumn(p+1).numFmt=e})});return this.h.xlsx.writeBuffer()};
function Qa(a){var b=a.o[0];return(a.j.settings||[]).map(function(c){return c.Setting+"="+c.Value+"\n"}).concat([b.cells.map(function(c){return c.members.join(",")}).join(",")+"\n"],a.j[b.member].map(function(c){var g=[],f=0;b.cells.forEach(function(d){return d["export"](c,g,(f+=d.members.length)-d.members.length)});return g.map(function(d){return Pa(d.value)}).join(",")+"\n"})).join("")}S.prototype.file_format=function(){return"Spreadsheet"};var Ra={new_sleep_diary:I,sleepdiary_engines:ta,DiaryLoader:Ha,Spreadsheet:S};"undefined"!==typeof module&&module.exports?module.exports=Ra:Object.keys(Ra).forEach(function(a){return self[a]=Ra[a]});var Sa={ga:"awake",na:"in bed",fa:"asleep","lights off":"lights off","lights on":"lights on",sa:"snack",pa:"meal",ea:"alcohol",ia:"chocolate",ha:"caffeine",ka:"drink","sleep aid":"sleep aid",la:"exercise",va:"toilet",Y:"noise",da:"alarm","in bed":"in bed","out of bed":"out of bed"};
function W(a,b){b&&(this.h=b);a.records&&!a.file_format&&(a={file_format:function(){return"Standard"},contents:a});this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:[{member:"status",regexp:new RegExp("^("+Object.values(Sa).join("|")+")$"),type:"string"},{member:"start",type:"time",optional:!0},{member:"end",type:"time",optional:!0},{member:"start_timezone",type:"string",optional:!0},{member:"end_timezone",type:"string",optional:!0},{member:"duration",type:"duration",optional:!0},
{members:["tags"],"export":function(k,l,q){return l[q]=T((k.tags||[]).join("; "))},"import":function(k,l,q){l[q].value&&(k.tags=l[q].value.split(/ *; */));return!0}},{members:["comments"],"export":function(k,l,q){return l[q]=T((k.comments||[]).map(function(n){return n.time?"TIME="+n.time+" "+n.text:n}).join("; "))},"import":function(k,l,q){l[q].value&&(l=l[q].value.split(/ *; */).map(function(n){var r;n=n.replace(/^TIME=([0-9]*) */,function(x,J){r=parseInt(J,10);return""});return r?{time:r,text:n}:
n}),k.comments=l);return!0}},{member:"day_number",type:"number",optional:!0},{member:"start_of_new_day",type:"boolean",optional:!0},{member:"is_primary_sleep",type:"boolean",optional:!0},{member:"missing_record_after",type:"boolean",optional:!0}]},{sheet:"Settings",member:"settings",type:"dictionary",cells:[{member:"minimum_day_duration",type:"duration"},{member:"maximum_day_duration",type:"duration"}]}]);switch(a.file_format()){case "string":try{a={file_format:function(){return"Standard"},contents:JSON.parse(a.contents)}}catch(k){return N()}if("Standard"!=
a.contents.file_format)return N();default:if(!za(this,a)){b=a.contents;if("Standard"!=a.file_format()||null===b||"object"!=typeof b||!Array.isArray(b.records))return N();this.records=b.records.map(function(k){return Object.assign({},k)}).sort(function(k,l){return k.start-l.start||k.end-l.end});a=b.settings||b;var c=a.minimum_day_duration||576E5,g=a.maximum_day_duration||2*c;this.settings={minimum_day_duration:c,maximum_day_duration:g};var f=0,d=0,h={status:"",day_number:-1},e=[],p=h;this.records.forEach(function(k){["start",
"end"].forEach(function(q){void 0==k[q]&&delete k[q]});["tags","comments"].forEach(function(q){(k[q]||[]).length||delete k[q]});k.hasOwnProperty("duration")||(k.duration=k.end-k.start,isNaN(k.duration)&&delete k.duration);k.hasOwnProperty("start_of_new_day")?k.start_of_new_day&&(f=k.start):k.start_of_new_day="asleep"==k.status&&k.start>f+c;k.hasOwnProperty("day_number")?d=k.day_number:(k.start_of_new_day&&(d=k.start>f+g?d+2:d+1,f=k.start),k.day_number=d);if("awake"==k.status||"asleep"==k.status)p.hasOwnProperty("missing_record_after")||
(p.missing_record_after=k.status==p.status),p=k;"asleep"==k.status&&(e[k.day_number]||{duration:-Infinity}).duration<k.duration&&(e[k.day_number]=k);if(k.hasOwnProperty("comments")){var l=k.comments;void 0===l?delete k.comments:Array.isArray(l)||(k.comments=[l])}h=k});e.forEach(function(k){k&&!k.hasOwnProperty("is_primary_sleep")&&(k.is_primary_sleep=!0)})}}}na(W,G);
W.prototype.to=function(a){switch(a){case "output":return a=Object.assign({file_format:this.file_format()},this),delete a.spreadsheet,wa(this,{file_format:function(){return"string"},contents:JSON.stringify(a)});default:return G.prototype.to.call(this,a)}};
W.prototype.merge=function(a){var b={};[this,a.to(this.file_format())].forEach(function(c){return c.records.forEach(function(g){return b[[g.start,g.end,g.status].join()]=g})});this.records=Object.values(b).sort(function(c,g){return c.start-g.start||c.end-g.end});return this};W.prototype.file_format=function(){return"Standard"};W.prototype.format_info=function(){return{name:"Standard",title:"Standardised diary format",url:"/src/Standard",extension:".json"}};
function Ta(a,b){function c(q,n){return q+Math.pow(n-l,2)}function g(q,n){return q+n}var f=a.map(function(q){return q[0]}).filter(function(q){return void 0!==q}),d=f.length;if(!d)return null;var h=f.sort(function(q,n){return q-n}),e=h.slice(Math.round(.25*h.length),Math.round(.75*h.length)),p=f.reduce(g)/(d||1),k=e.reduce(g)/(e.length||1);h={average:p,mean:p,interquartile_mean:k,median:h[Math.floor(h.length/2)],interquartile_range:e[e.length-1]-e[0],durations:a.map(function(q){return q?q[0]:void 0}),
timestamps:a.map(function(q){return q?q[1]:void 0}),interquartile_durations:e,rolling_average:a.map(b?function(q,n){if(!(14>n)){q=a.slice(Math.max(0,n-13),n+1).map(function(x){return x[0]}).filter(function(x){return void 0!==x});var r=[0,0];q.forEach(function(x){x<1*b/4?++r[0]:x>3*b/4&&++r[1]});return q.length?(q.reduce(function(x,J){return x+J})+(r[0]<r[1]?r[0]*b:r[1]*-b))/q.length:void 0}}:function(q,n){q=a.slice(Math.max(0,n-13),n+1).map(function(r){return r[0]}).filter(function(r){return void 0!==
r});return 14<=n&&q.length?q.reduce(function(r,x){return r+x})/q.length:void 0})};var l=p;h.standard_deviation=Math.sqrt(f.reduce(c,0)/d);l=k;h.interquartile_standard_deviation=Math.sqrt(e.reduce(c,0)/e.length);return h}W.prototype.summarise_records=function(a){return Ta((a?this.records.filter(a):this.records).map(function(b){return[b.duration,b.start||b.end]}))};
W.prototype.summarise_days=function(a){var b=[],c=this.records.length?this.records[this.records.length-1].day_number:0;for((a?this.records.filter(a):this.records).forEach(function(f){var d=f.day_number;(b[d]||0)<f.start&&0<d&&d<c&&(b[d]=f.start)});b.length&&!b[0];)b.shift();a=[];for(var g=1;g<b.length;++g)b[g]&&b[g-1]&&(a[g-1]=[b[g]-b[g-1],b[g-1]]);return Ta(a)};
W.prototype.total_per_day=function(a,b){var c=[],g=this.records.length?this.records[this.records.length-1].day_number:0;(b?this.records.filter(b):this.records).forEach(function(f){return(c[f.day_number]=c[f.day_number]||[0,f.start])[0]+=a&&!a(f)?0:1});for(c=c.slice(1,g);c.length&&void 0===c[0];)c.shift();return Ta(c)};
W.prototype.summarise_schedule=function(a,b,c){b=b||864E5;c=c||ua;var g=b/2,f=[],d=[],h=[],e=[];(a?this.records.filter(a):this.records).forEach(function(q){if(q.is_primary_sleep){if(q.start){var n=q.start;n+=6E4*R(n,q.start_timezone||c).offset();f.push([n%b,n]);d.push([(n+g)%b,n])}q.end&&(n=q.end,n+=6E4*R(n,q.end_timezone||c).offset(),h.push([n%b,n]),e.push([(n+g)%b,n]))}});a=Ta(f,b);var p=Ta(d,b),k=Ta(h,b),l=Ta(e,b);[[p,a],[l,k]].forEach(function(q){q[0]&&(["average","mean","interquartile_mean",
"median"].forEach(function(n){return q[0][n]=(q[0][n]+g)%b}),["durations","interquartile_durations"].forEach(function(n){return q[0][n]=q[1][n]}),q[0].rolling_average=q[1].rolling_average)});return{wake:(k||{}).standard_deviation<(l||{}).standard_deviation?k:l,sleep:(a||{}).standard_deviation<(p||{}).standard_deviation?a:p}};
W.prototype.daily_activities=function(a,b,c,g){function f(H,F){F.time=((F.start||F.end)+(F.end||F.start))/2;F.record=H;F.index=r++;H=q[q.length-1];var K=H.start,P=H.duration;["start","end","time"].forEach(function(v){F[v]&&(F["offset_"+v]=(F[v]-K)/P)});return F}function d(H){for(var F=p;C.unixUtcMillis()<=H;)if(F=p,n=0,++l,e=C,C=C.add(c,x),C.unixUtcMillis()>=p){p=Ea(e.unixUtcMillis(),a);var K=C.add(6E4*(e.offset()-C.offset()),x);if(e.lessThan(K)){var P=C.unixUtcMillis()>H;C=K;if(P)break}}if(!n&&(P=
e.unixUtcMillis(),H=C.unixUtcMillis(),K=q[l]={start:P,end:H,duration:H-P,id:e.toString(),year:e.year(),month:e.month()-1,day:e.day()-1,activities:n=[]},0<g))for(K=K.segments=[];P<H;){var v=new Date(P+V);K.push({dst_state:U?"on":"off",id:v.toISOString().replace(/Z/,k),year:v.getUTCFullYear(),month:v.getUTCMonth(),day:v.getUTCDate()-1,hour:v.getUTCHours(),minute:v.getUTCMinutes(),second:v.getUTCSeconds()});P+=g;P>=F&&(F=R(P,e.zone().name()),K[K.length-1].dst_state="change-"+(U?"back":"forward"),M=F.offsetDuration(),
V=M.milliseconds(),U=!M.equals(e.standardOffsetDuration()),F=Ea(F.unixUtcMillis(),a))}}a=a||ua;b=void 0===b?648E5:b;c=c||864E5;var h=this.records.sort(function(H,F){return(H.start||H.end)-(F.start||F.end)}),e=h.find(function(H){return H.start||H.end}),p=Ea(e?(e.start||e.end)-1:0,a),k=a.replace(/^([A-Za-z])/," $1"),l=0,q=[],n,r,x=Da().TimeUnit.Millisecond;if(e){e=R(e.start||e.end,a);var J=e.unixUtcMillis()-e.startOfDay().unixUtcMillis();e=e.sub((J<b?864E5:0)+J-b,x);var C=e.add(c,x);b=C.add(6E4*(e.offset()-
C.offset()),x);b.greaterThan(e)&&(C=b);var M=e.offsetDuration();var V=M.milliseconds();var U=!M.equals(e.standardOffsetDuration());h.forEach(function(H){r=0;var F=H.start,K=H.end;if(F)if(d(F),K)if(C.unixUtcMillis()>=K)n.push(f(H,{start:F,end:K,type:"start-end"}));else{for(n.push(f(H,{start:F,end:C.unixUtcMillis(),type:"start-mid"}));;){d(C.unixUtcMillis()+1);if(C.unixUtcMillis()>=K)break;n.push(f(H,{start:e.unixUtcMillis(),end:C.unixUtcMillis(),type:"mid-mid"}))}n.push(f(H,{start:e.unixUtcMillis(),
end:K,type:"mid-end"}))}else n.push(f(H,{start:F,type:"start-unknown"}));else K&&(d(K),n.push(f(H,{end:K,type:"unknown-end"})))})}q.forEach(function(H){var F=H.activity_summaries={};H.activities.forEach(function(K){var P=K.record.status,v=F[P]=F[P]||{duration:0};["start","end"].forEach(function(z){var A=K[z];void 0!==A&&(A=R(A,a).toString(),v["last_"+z]=A,void 0==v["first_"+z]&&(v["first_"+z]=A))});v.duration=K.start&&K.end?v.duration+(K.end-K.start):NaN})});return q};
W.prototype.latest_sleep_status=function(){for(var a=this.records.length-1;0<=a;--a){var b=this.records[a].status;if("awake"==b||"asleep"==b)return b}return""};xa(W);function Ua(a,b){function c(m){return m.substr(1,m.length-2)}function g(m){return(new Date(m.substr(1,m.length-2))).getTime()}function f(m){var t=m.match(z);return{string:m,year:parseInt(t[1],10),month:parseInt(t[2],10),day:parseInt(t[3],10),hour:parseInt(t[4],10),minute:parseInt(t[5],10),offset:("-"==t[6]?-1:1)*(60*parseInt(t[7],10)+parseInt(t[8],10))}}function d(m,t){m=R(m,t);t=m.offset();return{string:'"'+m.year()+"-"+O(m.month())+"-"+O(m.day())+" "+O(m.hour())+":"+O(m.minute())+(0>t?"-":"+")+
O(Math.abs(Math.round(t/60)))+O(Math.abs(t%60))+'"',year:m.year(),month:m.month(),day:m.day(),hour:m.hour(),minute:m.minute(),offset:t}}function h(m,t){var y=Math.floor(t/60),w=Math.floor(t%60);m=new Date((m.getTime?m.getTime():m)+6E4*(60*y+w));return{string:'"'+m.getUTCFullYear()+"-"+O(m.getUTCMonth()+1)+"-"+O(m.getUTCDate())+" "+O(m.getUTCHours())+":"+O(m.getUTCMinutes())+("-"==t[0]?"":"+")+O(Math.floor(t/60),2)+O(Math.floor(t%60),2)+'"',year:m.getUTCFullYear(),month:m.getUTCMonth()+1,day:m.getUTCDate(),
hour:m.getUTCHours(),minute:m.getUTCMinutes(),offset:t}}function e(m){var t=[];if(""!=m){m=m.split("|");for(var y=0;y!=m.length;++y){var w=m[y].split("-");t.push({wake:parseInt(w[0],10),sleep:parseInt(w[1],10)})}}return t}function p(m){var t=[];if(m.length&&"NONE"!=m){m=m.split("|");for(var y=0;y!=m.length;++y){var w=m[y].split(":");t.push({type:w[0],mood:parseInt(w[1],10),themes:w.slice(2)})}}return t}function k(m){return m.length&&"NONE"!=m?m.split("|"):[]}function l(m){m=m.match(F);return{custom_aid_id:m[1],
"class":m[2],name:c(m[3])}}function q(m){m=m.match(K);return{custom_hindrance_id:m[1],"class":m[2],name:c(m[3])}}function n(m){m=m.match(P);return{custom_tag_id:m[1],name:c(m[2])}}function r(m){m=m.match(v);var t=e(m[28]);return{start:g(m[19]),end:g(m[1]),duration:t.reduce(function(y,w){return y+w.sleep-w.wake},g(m[1])-g(m[10])),wake:f(m[1]),sleep:f(m[10]),bedtime:f(m[19]),holes:t,type:m[34],dreams:p(m[35]),aids:k(m[47]),hindrances:k(m[51]),tags:k(m[55]),quality:parseInt(m[59],10),notes:c(m[60])}}
function x(m){var t=!0,y={K:[],L:[],M:[],B:[]};m=m.split("\n");for(var w=0;w!=m.length;++w){var Q=m[w];if(t){switch(Q){case "custom_aid_id,class,name":var B=y.K;var L=F;break;case "custom_hindrance_id,class,name":B=y.L;L=K;break;case "custom_tag_id,name":B=y.M;L=P;break;case "wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes":B=y.B;L=v;break;default:if(B)B[B.length-1]+="\n",--w;else return ya(this)}t=!1}else if(""==m[w])t=!0;else{for(;'"'!=Q.substr(Q.length-1);){if(++w==m.length)return ya(this);
Q+="\n"+m[w]}if(L.test(Q))B.push(Q);else if(B.length)B[B.length-1]+="\n"+Q;else return ya(this)}}return y}b&&(this.h=b);var J="ALCOHOL AMBIEN AMBIEN_CR AROMATHERAPY BENADRYL CHAMOMILE CIRCADIN CPAP DOZILE EAR_PLUGS EXERCISE GABA IMOVANE LUNESTA MAGNESIUM MARIJUANA MEDITATION MELATONIN MILK MUSIC NYQUIL READING RESTAVIT ROZEREM SEX SOUND_MACHINE ST_JOHNS_WORT TV TYLENOL TYLENOL_PM UNISOM UNISOM2 VALERIAN ZIMOVANE".split(" "),C="ALARM_CLOCK ANGER ANXIETY ARGUMENT BABY_CRYING BATHROOM_BREAK TOO_BRIGHT BUNKMATE_SNORING CAFFEINE TOO_COLD DOG_BARKING FIRE_ANTS HEARTBURN TOO_HOT HUNGER LOUD_NEIGHBOR MIND_RACING PAIN PHONE_RANG RESTLESS_LEGS SCARY_MOVIE SICK SQUIRRELS_ON_ROOF STORM STRESS SUGAR VIDEO_GAME WIND".split(" "),
M="ALONE BUNKMATE CAMPING COUCH GOING_FISHING HOTEL OUT_OF_TOWN PASSED_OUT_DRUNK SCHOOL_NIGHT SLEEP_TALKING SLEEP_WALKING SLEPT_AT_FRIENDS_PLACE SLEPT_IN_CAR WORK_NIGHT".split(" ");b=J.join("|")+"|CUSTOM_[0-9]*";var V=C.join("|")+"|CUSTOM_[0-9]*",U=M.join("|")+"|CUSTOM_[0-9]*",H={};[J,C,M].forEach(function(m,t){return m.forEach(function(y){return H[y]=t})});J=RegExp("^CUSTOM_[0-9]*$");var F=RegExp('^(CUSTOM_[0-9]*),(AIRWAY|BEVERAGE|DRUG|EXERTION|HERBAL|READING|RELAXATION|SENSORY_DEPRIVATION|SOUND),("(.|\n)*")$'),
K=RegExp('^(CUSTOM_[0-9]*),(ENVIRONMENTAL|MENTAL|NOISE|OBLIGATION|PHYSICAL|STIMULANT),("(.|\n)*")$'),P=RegExp('^(CUSTOM_[0-9]*),("(.|\n)*")$'),v=new RegExp('^("([0-9][0-9]*)-([0-9][0-9]?)-([0-9][0-9]?) ([0-9][0-9]?):([0-9][0-9])?([-+])([0-9][0-9]*)([0-9][0-9])"),("([0-9][0-9]*)-([0-9][0-9]?)-([0-9][0-9]?) ([0-9][0-9]?):([0-9][0-9])?([-+])([0-9][0-9]*)([0-9][0-9])"),("([0-9][0-9]*)-([0-9][0-9]?)-([0-9][0-9]?) ([0-9][0-9]?):([0-9][0-9])?([-+])([0-9][0-9]*)([0-9][0-9])"),(|([1-9][0-9]*)-([1-9][0-9]*)(\\|([1-9][0-9]*)-([1-9][0-9]*))*),(NIGHT_SLEEP|NAP),(NONE|((UNKNOWN|GOOD|EROTIC|NEUTRAL|STRANGE|CREEPY|TROUBLING|NIGHTMARE):(-[1-5]|[0-5])(:(CHASE|COMPENSATORY|DAILY_LIFE|DEATH|EPIC|FALLING|FALSE_AWAKENING|FLYING|LUCID|MURDER|MUTUAL|NAKED_IN_PUBLIC|ORGASMIC|PHYSIOLOGICAL|PRECOGNITIVE|PROGRESSIVE|RECURRING|RELIGIOUS|SIGNAL|TEETH|TEST|MONEY))*)(\\|((UNKNOWN|GOOD|EROTIC|NEUTRAL|STRANGE|CREEPY|TROUBLING|NIGHTMARE):(-[1-5]|[0-5])(:(CHASE|COMPENSATORY|DAILY_LIFE|DEATH|EPIC|FALLING|FALSE_AWAKENING|FLYING|LUCID|MURDER|MUTUAL|NAKED_IN_PUBLIC|ORGASMIC|PHYSIOLOGICAL|PRECOGNITIVE|PROGRESSIVE|RECURRING|RELIGIOUS|SIGNAL|TEETH|TEST|MONEY))*))*),(NONE|('+
(b+")(\\|("+b+"))*),(NONE|(")+(V+")(\\|("+V+"))*),(NONE|(")+(U+")(\\|("+U+'))*),([0-9]|10),("(.|\n)*")$')),z=RegExp('"([0-9][0-9]*)-([0-9][0-9]?)-([0-9][0-9]?) ([0-9][0-9]?):([0-9][0-9])?([-+])([0-9][0-9]*)([0-9][0-9])"');this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:[{members:["start","start_offset"],formats:["time",null],"export":function(m,t,y){t[y]=T(new Date(m.start));t[y+1]=T(m.bedtime.offset);return!0},"import":function(m,t,y){m.start=t[y].value.getTime();return m.bedtime=
h(t[y].value,t[y+1].value)}},{members:["end","end_offset"],formats:["time",null],"export":function(m,t,y){t[y]=T(new Date(m.end));t[y+1]=T(m.wake.offset);return!0},"import":function(m,t,y){m.end=t[y].value.getTime();return m.wake=h(t[y].value,t[y+1].value)}},{member:"duration",type:"duration"},{members:["sleep","sleep_offset"],formats:["time",null],"export":function(m,t,y){t[y]=T(new Date(m.sleep.string.substr(1,m.sleep.string.length-2)));t[y+1]=T(m.sleep.offset);return!0},"import":function(m,t,y){return m.sleep=
h(t[y].value,t[y+1].value)}},{members:["holes"],regexp:/^([0-9]*-[0-9]*(\|[0-9]*-[0-9]*)*)?$/,"export":function(m,t,y){t[y]=T(m.holes.map(function(w){return w.wake+"-"+w.sleep}).join("|"));return!0},"import":function(m,t,y){m.holes=e(t[y].value);return!0}},{member:"type",regexp:/^(NIGHT_SLEEP|NAP)$/},{members:["dreams"],"export":function(m,t,y){t[y]=T(m.dreams.map(function(w){return[w.type,w.mood].concat(w.themes).join(":")}).join("|"));return!0},"import":function(m,t,y){return m.dreams=p(t[y].value)}},
{members:["aids"],"export":function(m,t,y){t[y]=T(m.aids.join("|"));return!0},"import":function(m,t,y){m.aids=k(t[y].value);return!0}},{members:["hindrances"],"export":function(m,t,y){t[y]=T(m.hindrances.join("|"));return!0},"import":function(m,t,y){m.hindrances=k(t[y].value);return!0}},{members:["tags"],"export":function(m,t,y){t[y]=T(m.tags.join("|"));return!0},"import":function(m,t,y){m.tags=k(t[y].value);return!0}},{member:"quality",regexp:/^[0-9]*$/},{member:"notes"}]},{sheet:"Custom Aids",member:"custom_aids",
cells:[{member:"custom_aid_id",regexp:J},{member:"class",regexp:RegExp("^(AIRWAY|BEVERAGE|DRUG|EXERTION|HERBAL|READING|RELAXATION|SENSORY_DEPRIVATION|SOUND)$")},{member:"name"}]},{sheet:"Custom Hindrances",member:"custom_hindrances",cells:[{member:"custom_hindrance_id",regexp:J},{member:"class",regexp:RegExp("^(ENVIRONMENTAL|MENTAL|NOISE|OBLIGATION|PHYSICAL|STIMULANT)$")},{member:"name"}]},{sheet:"Custom Tags",member:"custom_tags",cells:[{member:"custom_tag_id",regexp:J},{member:"name"}]}]);b=[];
V=[];var A=[],u=[];switch(a.file_format()){case "string":if(-1==a.contents.search("wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes"))return N();a=x(a.contents);b=a.K.map(l);V=a.L.map(q);A=a.M.map(n);u=a.B.map(r);break;default:if(za(this,a))return;var D={};a.to("Standard").records.forEach(function(m){switch(m.status){case "in bed":D[m.end]=[m.start,m.start_timezone];break;case "asleep":var t=[[],[],[]],y=D[m.start]||[m.start,m.start_timezone];(m.tags||[]).forEach(function(w){if(H.hasOwnProperty(w))t[H[w]].push(w);
else{var Q=A.find(function(B){return w==B.name});Q?t[2].push(Q.custom_tag_id):(Q="CUSTOM_"+O(A.length+1,4),A.push({custom_tag_id:Q,name:w}),t[2].push(Q))}});u.push({start:y[0],end:m.end,duration:m.duration,wake:d(m.end,m.end_timezone),sleep:d(m.start,m.start_timezone),bedtime:d(y[0],y[1]),holes:[],type:m.is_primary_sleep?"NIGHT_SLEEP":"NAP",dreams:[],aids:t[0],hindrances:t[1],tags:t[2],quality:5,notes:(m.comments||[]).join("; ")})}})}this.custom_aids=b;this.custom_hindrances=V;this.custom_tags=A;
this.records=u}na(Ua,G);
Ua.prototype.to=function(a){switch(a){case "output":var b="";this.custom_aids.length&&(b+="custom_aid_id,class,name\n",this.custom_aids.forEach(function(e){return b+=e.custom_aid_id+","+e["class"]+',"'+e.name+'"\n'}),b+="\n");this.custom_hindrances.length&&(b+="custom_hindrance_id,class,name\n",this.custom_hindrances.forEach(function(e){return b+=e.custom_hindrance_id+","+e["class"]+',"'+e.name+'"\n'}),b+="\n");this.custom_tags.length&&(b+="custom_tag_id,name\n",this.custom_tags.forEach(function(e){return b+=e.custom_tag_id+
',"'+e.name+'"\n'}),b+="\n");b+="wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n";this.records.forEach(function(e){return b+=[e.wake.string,e.sleep.string,e.bedtime.string,e.holes.map(function(p){return p.wake+"-"+p.sleep}).join("|"),e.type,e.dreams.map(function(p){return[p.type,p.mood].concat(p.themes).join(":")}).join("|")||"NONE",e.aids.join("|")||"NONE",e.hindrances.join("|")||"NONE",e.tags.join("|")||"NONE",e.quality,'"'+e.notes+'"'].join()+"\n"});return wa(this,{file_format:function(){return"string"},
contents:b});case "Standard":var c=function(e){e=Math.round(e.offset/60);return 0>e?"Etc/GMT+"+Math.abs(e):0<e?"Etc/GMT-"+e:"Etc/GMT"},g={},f={},d={},h=[];this.custom_aids.forEach(function(e){return g[e.custom_aid_id]=e.name});this.custom_hindrances.forEach(function(e){return f[e.custom_hindrance_id]=e.name});this.custom_tags.forEach(function(e){return d[e.custom_tag_id]=e.name});this.records.forEach(function(e){var p=e.sleep;p=(new Date(p.string.substr(1,p.string.length-2))).getTime();e.start<p&&
h.push({status:"in bed",start:e.start,end:p,start_timezone:c(e.bedtime),end_timezone:c(e.sleep)});var k=[];e.aids.forEach(function(l){return k.push(g[l]||l)});e.hindrances.forEach(function(l){return k.push(f[l]||l)});e.tags.forEach(function(l){return k.push(d[l]||l)});h.push(Object.assign({status:"asleep",start:void 0===e.start?p||void 0:Math.max(e.start,p),end:e.end,start_timezone:c(e.sleep),end_timezone:c(e.wake),tags:k,comments:e.notes.length?[e.notes]:[]},void 0===e.duration?{}:{duration:e.duration},
"NIGHT_SLEEP"==e.type?{is_primary_sleep:!0}:{}))});return new W({records:h},this.h);default:return G.prototype.to.call(this,a)}};
Ua.prototype.merge=function(a){var b=this,c={},g={},f={};a=a.to(this.file_format());this.custom_aids.length&&a.custom_aids.length?a.custom_aids.forEach(function(d){var h=b.custom_aids.find(function(p){return p["class"]==d["class"]&&p.name==d.name});if(!h){var e="CUSTOM_0001";for(h=2;b.custom_aids.some(function(p){return p.custom_aid_id==e});++h)e="CUSTOM_"+O(h,4);h={custom_aid_id:e,"class":d["class"],name:d.name};b.custom_aids.push(h)}c[d.custom_aid_id]=h.custom_aid_id}):a.custom_aids.forEach(function(d){return c[d.custom_aid_id]=
d.custom_aid_id});this.custom_hindrances.length&&a.custom_hindrances.length?a.custom_hindrances.forEach(function(d){var h=b.custom_hindrances.find(function(p){return p["class"]==d["class"]&&p.name==d.name});if(!h){var e="CUSTOM_0001";for(h=2;b.custom_hindrances.some(function(p){return p.custom_hindrance_id==e});++h)e="CUSTOM_"+O(h,4);h={custom_hindrance_id:e,"class":d["class"],name:d.name};b.custom_hindrances.push(h)}g[d.custom_hindrance_id]=h.custom_hindrance_id}):a.custom_hindrances.forEach(function(d){return g[d.custom_hindrance_id]=
d.custom_hindrance_id});this.custom_tags.length&&a.custom_tags.length?a.custom_tags.forEach(function(d){var h=b.custom_tags.find(function(p){return p.name==d.name});if(!h){var e="CUSTOM_0001";for(h=2;b.custom_tags.some(function(p){return p.custom_tag_id==e});++h)e="CUSTOM_"+O(h,4);h={custom_tag_id:e,name:d.name};b.custom_tags.push(h)}f[d.custom_tag_id]=h.custom_tag_id}):a.custom_tags.forEach(function(d){return f[d.custom_tag_id]=d.custom_tag_id});this.records=this.records.concat(Ca(this.records,a.records,
function(d){return[d.wake.string,d.sleep.string,d.bedtime.string].join()}).map(function(d){return Object.assign({},d,{aids:d.aids.map(function(h){return c[h]||h}),hindrances:d.hindrances.map(function(h){return g[h]||h}),tags:d.tags.map(function(h){return f[h]||h})})})).sort(function(d,h){return d.wake-h.wake});return this};Ua.prototype.file_format=function(){return"Sleepmeter"};
Ua.prototype.format_info=function(){return{name:"Sleepmeter",title:"Sleepmeter",url:"/src/Sleepmeter",statuses:["in bed","asleep"],extension:".csv",logo:"http://www.squalllinesoftware.com/sites/squalllinesoftware.com/files/sleepmeter_logo_128x128.png"}};xa(Ua);function Va(a,b){function c(u){return u.substr(1,u.length-2).replace(F,'"').replace(K,"\n")}function g(u){var D=[];u.replace(U,function(m,t){3<t.length&&("_2x"==t.substr(t.length-3)?D.push({count:2,value:t.substr(0,t.length-3)}):"_3x"==t.substr(t.length-3)?D.push({count:3,value:t.substr(0,t.length-3)}):D.push({count:1,value:t}))});return D}function f(u){var D=u.match(J);return{string:u,year:parseInt(D[3],10),month:parseInt(D[2],10),day:parseInt(D[1],10),hour:parseInt(D[4],10),minute:parseInt(D[5],
10)}}function d(u,D){u=R(u,D);return{string:'"'+O(u.day())+". "+O(u.month())+". "+u.year()+" "+u.hour()+":"+O(u.minute())+'"',year:u.year(),month:u.month(),day:u.day(),hour:u.hour(),minute:u.minute()}}function h(u,D){return D.some(function(m){return m==u})?null:p(u)}function e(u,D){return D.some(function(m){return m==u})?null:p(u)}function p(u){return parseFloat(u.substr(1,u.length-2))}function k(u,D){return D.some(function(m){return m==u})?null:c(u)}function l(u){var D={},m=Aa(u).documentElement;
u=Array.from(m.getElementsByTagName("long"));var t=Array.from(m.getElementsByTagName("int")),y=Array.from(m.getElementsByTagName("boolean"));m=Array.from(m.getElementsByTagName("string"));u.forEach(function(w){return D[w.getAttribute("name")]=parseInt(w.getAttribute("value"),10)});t.forEach(function(w){return D[w.getAttribute("name")]=parseInt(w.getAttribute("value"),10)});y.forEach(function(w){return D[w.getAttribute("name")]="true"==w.getAttribute("value")});m.forEach(function(w){return D[w.getAttribute("name")]=
w.textContent});return D}function q(u){var D=[];u=u.split("\n");""==u[u.length-1]&&u.pop();for(var m={},t=0;t!=u.length;m={l:m.l,A:m.A,u:m.u,C:m.C,v:m.v},t+=2){var y=function(B){return function(L){return R(["year","month","day"].map(function(ka){return O(L[ka])}).join("-")+"T"+["hour","minute"].map(function(ka){return O(L[ka])}).join(":"),B.l.Tz).unixUtcMillis()}}(m),w=u[t].match(n);m.A=[];m.u=[];if(!w)return ya(this);w[1].replace(C,function(B){return function(L,ka,Ma){B.A.push({header_string:L,hours:parseInt(ka,
10),minutes:parseInt(Ma,10),actigraphy:null,noise:null})}}(m));w[5].replace(/"Event"/g,function(B){return function(){B.u.push({label:null,timestamp:null})}}(m));w=u[t+1].match(r);if(!w)return ya(this);m.C=0;m.v=0;var Q=c(w[27]);m.l={Id:c(w[1]),Tz:c(w[3]),From:f(w[5]),To:f(w[11]),Sched:f(w[17]),Hours:p(w[23]),Rating:p(w[25]),Comment:{string:Q,tags:g(Q),notags:Q.replace(H,"")},Framerate:c(w[29]),Snore:h(w[31],['"-1"']),Noise:e(w[32],['"-1.0"']),Cycles:h(w[34],['"-1"']),DeepSleep:e(w[35],['"-1.0"','"-2.0"']),
LenAdjust:e(w[37],['"-1.0"']),Geo:k(w[39],[""]),times:m.A,events:m.u};m.l.start=parseInt(m.l.Id,10);m.l.end=m.l.start+36E5*m.l.Hours;m.l.duration=Math.round(6E4*(60*m.l.Hours+("-1.0"==w[37]?0:m.l.LenAdjust)));m.l.alarm=6E4*Math.round((m.l.end+y(m.l.Sched)-y(m.l.To))/6E4);w[40].replace(M,function(B){return function(L){B.A[B.C++].ca=p(L)}}(m));w[43].replace(V,function(B){return function(L,ka,Ma,jb,Ya){B.u[B.v].label=ka;B.u[B.v].timestamp=parseInt(Ma,10);Ya&&(B.u[B.v].value=parseFloat(Ya));++B.v}}(m));
if(y=u[t+2]?u[t+2].match(x):0)m.C=0,y[1].replace(M,function(B){return function(L){B.A[B.C++].Y=p(L)}}(m)),++t;D.push(m.l)}return D}b&&(this.h=b);var n=RegExp('^Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo((,"([0-9]*):([0-9]*)")*)((,"Event")*)$'),r=RegExp('^("([^"]|"")*"),("([^"]|"")*"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("[0-9]*(\\.[0-9]*)?"),("[0-9]*(\\.[0-9]*)?"),("([^"]|"")*"),("([^"]|"")*"),("-?[0-9]*"),("-?[0-9]*(\\.[0-9]*)?"),("-?[0-9]*"),("(-[12]\\.0|0\\.[0-9]*|1\\.0)"),("-?[0-9]*(\\.[0-9]*)?"),("[0-9a-f]*")((,"-?[0-9]*(\\.[0-9]*)?")*)((,"([A-Z_]*)-([0-9]*)(-([-0-9E.]*))?")*)$'),
x=RegExp('^,,,,,,,,,,,,((,"-?[0-9]*(\\.[0-9]*)?")*)$');b=RegExp('^(Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo((,"([0-9]*):([0-9]*)")*)((,"Event")*)\n("([^"]|"")*"),("([^"]|"")*"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("[0-9]*(\\.[0-9]*)?"),("[0-9]*(\\.[0-9]*)?"),("([^"]|"")*"),("([^"]|"")*"),("-?[0-9]*"),("-?[0-9]*(\\.[0-9]*)?"),("-?[0-9]*"),("(-[12]\\.0|0\\.[0-9]*|1\\.0)"),("-?[0-9]*(\\.[0-9]*)?"),("[0-9a-f]*")((,"-?[0-9]*(\\.[0-9]*)?")*)((,"([A-Z_]*)-([0-9]*)(-([-0-9E.]*))?")*)\n(,,,,,,,,,,,,((,"-?[0-9]*(\\.[0-9]*)?")*)\n)?)*(Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo((,"([0-9]*):([0-9]*)")*)((,"Event")*)\n("([^"]|"")*"),("([^"]|"")*"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"),("[0-9]*(\\.[0-9]*)?"),("[0-9]*(\\.[0-9]*)?"),("([^"]|"")*"),("([^"]|"")*"),("-?[0-9]*"),("-?[0-9]*(\\.[0-9]*)?"),("-?[0-9]*"),("(-[12]\\.0|0\\.[0-9]*|1\\.0)"),("-?[0-9]*(\\.[0-9]*)?"),("[0-9a-f]*")((,"-?[0-9]*(\\.[0-9]*)?")*)((,"([A-Z_]*)-([0-9]*)(-([-0-9E.]*))?")*)(\n,,,,,,,,,,,,((,"-?[0-9]*(\\.[0-9]*)?")*))?)\n?$');
var J=RegExp('"([0-9]*)\\. ([0-9]*). ([0-9]*) ([0-9]*):([0-9]*)"'),C=RegExp('"([0-9]*):([0-9]*)"',"g"),M=RegExp('"-?[0-9]*(\\.[0-9]*)?"',"g"),V=RegExp('"([A-Z_]*)-([0-9]*)(-([-0-9E.]*))?"',"g"),U=RegExp('#([^ ",][^ ",]*)',"g"),H=RegExp(' *#([^ ",][^ ",]*)',"g"),F=RegExp('""',"g"),K=RegExp(" \\\\n ","g"),P={},v=[];this.spreadsheet=new S(this,[]);var z=a.contents;switch(a.file_format()){case "spreadsheet":if(!a.sheets.some(function(u){u=u.cells;if(!u.length)return!1;A=[];var D=1,m,t,y;return u.every(function(w){if("Id,Tz,From,To,Sched,Hours,Rating,Comment,Tags,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo"==
w.slice(0,16).map(function(B){return B.value}).join())t=[],y=[],m={times:t,events:y},A.push(m),D=2,w.slice(16).forEach(function(B){if("Event"==B.value)y.push({label:null,timestamp:null});else if("number"==typeof B.value){var L=Math.floor(24*B.value);B=Math.floor(1440*B.value)%60;t.push({header_string:L+":"+O(B),hours:L,minutes:B,actigraphy:null,noise:null})}else return!1});else if(2==D){D=3;["Id","Tz",,,,"Hours","Rating","Comment","Tags","Framerate","Snore","Noise","Cycles","DeepSleep","LenAdjust",
"Geo"].forEach(function(B,L){return m[B]=w[L]?w[L].value:null});m.Comment=m.Comment&&m.Tags?{string:m.Comment+" "+m.Tags,tags:g(m.Tags),notags:m.Comment}:m.Comment?{string:m.Comment,tags:[],notags:m.Comment}:m.Tags?{string:m.Tags,tags:g(m.Tags),notags:""}:{string:"",tags:[],notags:""};delete m.Tags;var Q=w[1].value;m.start=w[2].value.getTime();m.From=d(w[2].value.getTime(),Q);m.end=w[3].value.getTime();m.To=d(w[3].value.getTime(),Q);m.alarm=w[4].value.getTime();m.Sched=d(w[4].value.getTime(),Q);m.duration=
Math.round(6E4*(60*m.Hours+(m.LenAdjust||0)));t.forEach(function(B,L){w[16+L]&&(B.actigraphy=w[16+L].value)});y.forEach(function(B,L){w[16+t.length+L]&&(L=w[16+t.length+L].value.split("-"),B.label=L[0],B.timestamp=L[1],2<L.length&&(B.value=L[2]))})}else if(3==D)D=1,t.forEach(function(B,L){w[16+L]&&(B.noise=w[16+L].value)});else return!1;return!0})})||!a.sheets.some(function(u){u=u.cells;if(!u.length||"Alarm"!=u[0][0].value)return!1;v=u.slice(1).map(function(D){return JSON.parse(D[0].value)});return!0})||
!a.sheets.some(function(u){u=u.cells;if(!u.length||"Preferences"!=u[0][0].value)return!1;P=JSON.parse(u[1][0].value);return!0}))return N();break;case "string":if(!b.test(z))return N();var A=q.call(this,z);break;case "archive":if(z.hasOwnProperty("sleep-export.csv")&&z["prefs.xml"]&&z["alarms.json"]){A=q.call(this,z["sleep-export.csv"]);P=l(z["prefs.xml"]);v=JSON.parse(z["alarms.json"]);break}else return N();default:if(za(this,a))return;A=a.to("Standard").records.filter(function(u){return"asleep"==
u.status}).map(function(u){return{start:u.start,end:u.end,duration:u.duration,alarm:6E4*Math.round(u.end/6E4),Id:(u.start||0).toString(),Tz:u.start_timezone||u.end_timezone||"Etc/GMT",From:d(u.start,u.start_timezone||u.end_timezone),To:d(u.end,u.end_timezone||u.start_timezone),Sched:d(u.end,u.end_timezone||u.start_timezone),Hours:(u.end-u.start)/36E5,Rating:2.5,Comment:{string:(u.comments||[]).join("\n")+(u.tags||[]).map(function(D){return"#"+D}).join(" "),tags:(u.tags||[]).map(function(D){return{count:1,
value:D}}),notags:(u.comments||[]).join("\n")},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:null,Geo:"",times:[],events:[]}})}this.records=A;this.prefs=P;this.alarms=v}na(Va,G);
Va.prototype.to=function(a){var b=this,c=["Id","Tz","From","To","Sched"],g=["Hours","Rating"],f="Framerate Snore Noise Cycles DeepSleep LenAdjust Geo".split(" ");switch(a){case "output":var d=function(p,k){return'"'+(null===p?k:p)+'"'};a=JSON.stringify(this.alarms);var h="<?xml version='1.0' encoding='utf-8' standalone='yes' ?>\n<map>"+Object.keys(this.prefs).map(function(p){var k=b.prefs[p];switch(typeof k){case "boolean":return'\n\t<boolean name="'+p+'" value="'+k+'" />\n';case "number":return"\n\t<"+
(Math.abs(k)>=Math.pow(2,31)?"long":"int")+' name="'+p+'" value="'+k+'" />\n';default:return'\n\t<string name="'+p+'"><![CDATA['+k+"]]\x3e</string>\n"}}).join("")+"\n</map>\n",e=this.records.map(function(p){return[].concat(c,g,["Comment"],f,p.times.map(function(k){return',"'+k.header_string+'"'}),p.events.map(function(){return',"Event"'})).join(",")+"\n"+['"'+p.Id+'"','"'+p.Tz+'"'].concat(["start","end","alarm"].map(function(k){k=R(p[k],p.Tz);return'"'+O(k.day())+". "+O(k.month())+". "+k.year()+" "+
k.hour()+":"+O(k.minute())+'"'}),g.map(function(k){return'"'+p[k]+'"'}),['"'+p.Comment.string.replace(/"/g,'""').replace(/\n/g," \\n ")+'"','"'+p.Framerate+'"',d(p.Snore,"-1"),d(p.Noise,"-1.0"),d(p.Cycles,"-1"),d(p.DeepSleep,"-1.0"),d(p.LenAdjust,"-1.0"),d(p.Geo,"")],p.times.map(function(k){return'"'+k.actigraphy+'"'}),p.events.map(function(k){return'"'+k.label+"-"+k.timestamp+(k.hasOwnProperty("value")?"-"+k.value:"")+'"'})).join(",")+"\n"+(p.times.length?",,,,,,,,,,,,,"+p.times.map(function(k){return'"'+
k.noise+'"'}).join(",")+"\n":"")}).join("");return wa(this,{file_format:function(){return"archive"},contents:{"sleep-export.csv":e,"prefs.xml":h,"alarms.json":a}});case "Standard":return new W({records:this.records.map(function(p){return Object.assign({status:"asleep",start:p.start,end:p.end,start_timezone:p.Tz,end_timezone:p.Tz,tags:p.Comment.tags.map(function(k){return k.value}),comments:p.Comment.notags.length?[p.Comment.notags]:void 0},void 0===p.duration?{}:{duration:p.duration})})},this.h);
default:return G.prototype.to.call(this,a)}};
Va.prototype.to_async=function(a){var b=["Id","Tz","From","To","Sched"],c=["Hours","Rating"],g="Framerate Snore Noise Cycles DeepSleep LenAdjust Geo".split(" ");switch(a){case "spreadsheet":a=this.spreadsheet;var f=this.records.length?Math.max.apply(0,this.records.map(function(k){return k.times.length})):0,d=a.get_sheet("Records",b.concat(c,["Comment","Tags"],g),[null,null,"time","time","time",null,null,null,null,null,null,null,null,null,null].concat(Array(f).fill("duration")));f=d[0];d=d[1];var h=
d.cells;h.splice(0);this.records.forEach(function(k){h.push([].concat(b,c,["Comment","Tags"],g,k.times.map(function(l){return(60*l.hours+l.minutes)/1440}),k.events.map(function(){return"Event"})).map(function(l){return T(l,"#FFEEEEEE,#FFEEEEEE")}));h.push([k.Id,k.Tz].concat(["start","end","alarm"].map(function(l){return new Date(k[l])}),c.map(function(l){return k[l]}),[k.Comment.notags,k.Comment.tags.map(function(l){return"#"+l.value+(1==l.count?"":"_"+l.count+"x")}).join(" "),k.Framerate,k.Snore,
k.Noise,k.Cycles,k.DeepSleep,k.LenAdjust,k.Geo],k.times.map(function(l){return l.actigraphy}),k.events.map(function(l){return l.label+"-"+l.timestamp+(l.hasOwnProperty("value")?"-"+l.value:"")})).map(function(l){return T(l)}));k.times.some(function(l){return l.noise})&&h.push([].concat(Array(13).fill(""),k.times.map(function(l){return l.noise})).map(function(l){return T(l)}))});d.cells=h;f&&a.sheets.push(d);d=a.get_sheet("Alarms",["Alarm"],[""]);f=d[0];d=d[1];var e=d.cells;e.splice(1);this.alarms.forEach(function(k){return e.push([T(JSON.stringify(k))])});
f&&a.sheets.push(d);d=a.get_sheet("Preferences",["Preferences"],[""]);f=d[0];d=d[1];var p=d.cells;p.splice(1);p.push([T(JSON.stringify(this.prefs))]);f&&a.sheets.push(d);return a.serialise();default:return G.prototype.to_async.call(this,a)}};Va.prototype.merge=function(a){a=a.to(this.file_format());this.records=this.records.concat(Ca(this.records,a.records,["Id"]));return this};Va.prototype.file_format=function(){return"SleepAsAndroid"};
Va.prototype.format_info=function(){return{name:"SleepAsAndroid",title:"Sleep as Android",url:"/src/SleepAsAndroid",statuses:["asleep"],extension:".zip",logo:"https://docs.sleep.urbandroid.org/assets/images/logo.png"}};xa(Va);function Wa(a,b){b&&(this.h=b);this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:[{member:"sid",regexp:/^[1-9][0-9]*$/,type:"number"},{member:"start",type:"time"},{member:"stop",type:"time"},{member:"rating",regexp:/^[0-5]$/,type:"number"}]}]);za(this,a)||(this.records=a.to("Standard").records.filter(function(c){return"asleep"==c.status}).map(function(c,g){return{start:c.start,stop:c.end,sid:g+1,rating:0}}))}na(Wa,G);
Wa.prototype.to=function(a){switch(a){case "output":return wa(this,{file_format:function(){return"string"},contents:"sid,start,stop,rating\n"+this.records.map(function(b){return[b.sid,b.start,b.stop,b.rating].join()+"\n"}).join("")});case "Standard":return new W({records:this.records.map(function(b){return{status:"asleep",start:b.start,end:b.stop}})},this.h);default:return G.prototype.to.call(this,a)}};
Wa.prototype.merge=function(a){a=a.to(this.file_format());this.records=this.records.concat(Ca(this.records,a.records,["start","stop"]));this.records.forEach(function(b,c){return b.sid=c+1});return this};Wa.prototype.file_format=function(){return"PleesTracker"};Wa.prototype.format_info=function(){return{name:"PleesTracker",title:"Plees Tracker",url:"/src/PleesTracker",statuses:["asleep"],extension:".csv",logo:"https://raw.githubusercontent.com/vmiklos/plees-tracker/master/app/src/main/res/mipmap-xxxhdpi/ic_launcher_round.png"}};
xa(Wa);function Xa(a,b){b&&(this.h=b);b=[];this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:[{member:"start",type:"time"},{member:"end",type:"time"},{member:"forced awakening",type:"boolean"},{member:"delayed retirement",type:"boolean"}]}]);switch(a.file_format()){case "array":a=a.contents;if(a.byteLength%12)return N();for(var c=new Float32Array(a),g=new Uint8Array(a),f=1,d=0;d<a.byteLength/12;++d){var h=c[3*d],e=c[3*d+1],p=!g[12*d+8],k=!g[12*d+9];if(h<f||e<=h)return N();f=e;b.push({start:6E4*
Math.round(15776640+1440*h),end:6E4*Math.round(15776640+1440*e),"forced awakening":p,"delayed retirement":k})}break;default:if(za(this,a))return;b=a.to("Standard").records.filter(function(l){return"asleep"==l.status}).map(function(l){return{start:l.start,end:l.end,"forced awakening":(l.tags||[]).some(function(q){return-1!=q.search(/forced awakening/i)}),"delayed retirement":(l.tags||[]).some(function(q){return-1!=q.search(/delayed retirement/i)})}})}this.records=b}na(Xa,G);
Xa.prototype.to=function(a){switch(a){case "output":var b=new Float32Array(3*this.records.length),c=new Uint8Array(b.buffer);this.records.forEach(function(g,f){b[3*f]=(g.start-9465984E5)/864E5;b[3*f+1]=(g.end-9465984E5)/864E5;c[12*f+8]=g["forced awakening"]?0:255;c[12*f+9]=g["delayed retirement"]?0:255});return wa(this,{file_format:function(){return"array"},contents:b.buffer});case "Standard":return new W({records:this.records.map(function(g){return{status:"asleep",start:g.start,end:g.end,tags:[].concat(g["forced awakening"]?
["forced awakening"]:[],g["delayed retirement"]?["delayed retirement"]:[])}})},this.h);default:return G.prototype.to.call(this,a)}};Xa.prototype.merge=function(a){a=a.to(this.file_format());var b=1;this.records=this.records.concat(a.records).sort(function(c,g){return c.start-g.start}).filter(function(c){if(c.start<b||c.start>=c.end)return!1;b=c.end;return!0});return this};Xa.prototype.file_format=function(){return"SleepChart1"};
Xa.prototype.format_info=function(){return{name:"SleepChart1",title:"SleepChart 1.0",url:"/src/SleepChart1",statuses:["asleep"],extension:".tim",logo:"https://www.supermemo.com/assets/images/frontpage2/intro/icon4.svg"}};xa(Xa);function Za(a,b){b&&(this.h=b);this.spreadsheet=new S(this,[{sheet:"Activities",member:"activities",cells:[{member:"ActivityStart",type:"time"},{member:"ActivityEnd",type:"time"}]},{sheet:"Settings",member:"settings",cells:[{member:"Setting",type:"text"},{member:"Value",type:"number"}]}]);za(this,a)?$a(this,[]):(this.records=a.to("Standard").records.filter(function(c){return"awake"==c.status||"asleep"==c.status}).map(function(c){return{status:c.status,start:c.start,end:c.end}}),this.activities=this.records.map(function(c){return{ActivityStart:c.start,
ActivityEnd:c.end}}),this.settings=[{Setting:"maximum_day_length_ms",Value:6E4}])}na(Za,G);
function $a(a,b){var c=a.records=[],g=[{}],f=1152E5,d=NaN,h=NaN,e=1;a.settings.forEach(function(r){"maximum_day_length_ms"==r.Setting&&(f=r.Value)});a.activities.concat(b).sort(function(r,x){return r.ActivityStart-x.ActivityStart}).forEach(function(r){h>=r.ActivityStart-6E4?g[g.length-1].ActivityEnd=r.ActivityEnd:g.push({ActivityStart:r.ActivityStart,ActivityEnd:h=r.ActivityEnd})});for(a.activities=g.slice(1);e<g.length;){a=g[e];b=a.ActivityStart;for(var p=a.ActivityEnd,k=0,l=++e;l<g.length;){var q=
g[l],n=q.ActivityStart-a.ActivityEnd;k<n&&(k=n,p=a.ActivityEnd,e=l);if(q.ActivityEnd-b>f)break;a=q;++l}36E5<p-b&&(b-d<f&&c.push({start:h+1,end:b-1,status:"asleep"}),c.push({start:b,end:l==g.length?g[l-1].ActivityEnd:p,status:"awake"}),d=b,h=p);if(l==g.length)break}}
Za.prototype.to=function(a){switch(a){case "output":return wa(this,{file_format:function(){return"string"},contents:Qa(this.spreadsheet)});case "Standard":return new W({records:this.records},this.h);default:return G.prototype.to.call(this,a)}};Za.prototype.merge=function(a){a=a.to(this.file_format());$a(this,a.activities);return this};Za.prototype.file_format=function(){return"ActivityLog"};
Za.prototype.format_info=function(){return{name:"ActivityLog",title:"Activity Log",url:"/src/ActivityLog",statuses:["awake","asleep"],extension:".csv"}};xa(Za);function ab(a,b){function c(f){return"N/A"==f?null:parseInt(f.replace(/,/g,""),10)}b&&(this.h=b);var g=[];this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:[{member:"Start Time",type:"time"},{member:"End Time",type:"time"},{member:"Minutes Asleep",type:"number"},{member:"Minutes Awake",type:"number"},{member:"Number of Awakenings",type:"number",optional:!0},{member:"Time in Bed",type:"number",optional:!0},{member:"Minutes REM Sleep",type:"number",optional:!0},{member:"Minutes Light Sleep",
type:"number",optional:!0},{member:"Minutes Deep Sleep",type:"number",optional:!0},{members:[],"export":function(){return!0},"import":function(f){f.end=f["End Time"];f.start=f["Start Time"];return!0}}]}]);b=RegExp('^Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n(?:"(([0-9][0-9]*)-([0-9][0-9]*)-([0-9][0-9]*) ([0-9][0-9]*):([0-9][0-9]*) *([AP])M)","(([0-9][0-9]*)-([0-9][0-9]*)-([0-9][0-9]*) ([0-9][0-9]*):([0-9][0-9]*) *([AP])M)","([0-9][0-9,]*)","([0-9][0-9,]*)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)"\n)*\n$',
"i");switch(a.file_format()){case "string":a=a.contents;if(b.test(a))a.replace(RegExp('"(([0-9][0-9]*)-([0-9][0-9]*)-([0-9][0-9]*) ([0-9][0-9]*):([0-9][0-9]*) *([AP])M)","(([0-9][0-9]*)-([0-9][0-9]*)-([0-9][0-9]*) ([0-9][0-9]*):([0-9][0-9]*) *([AP])M)","([0-9][0-9,]*)","([0-9][0-9,]*)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)","([0-9][0-9,]*|N/A)"\n',"gi"),function(f,d,h,e,p,k,l,q,n,r,x,J,C,M,V,U,H,F,K,P,v,z){f=V.toUpperCase();r=parseInt(r,10);x=parseInt(x,
10);J=parseInt(J,10);C=parseInt(C,10);12==C?"A"==f&&(C=0):"P"==f&&(C+=12);M=parseInt(M,10);M=31<J?(new Date(J,x-1,r,C,M)).getTime():(new Date(r,x-1,J,C,M)).getTime();U={"End Time":M,"Minutes Asleep":parseInt(U.replace(/,/g,""),10),"Minutes Awake":parseInt(H.replace(/,/g,""),10),"Number of Awakenings":c(F),"Time in Bed":c(K),"Minutes REM Sleep":c(P),"Minutes Light Sleep":c(v),"Minutes Deep Sleep":c(z),end:M};U["Start Time"]=U.start=M-6E4*(U["Minutes Asleep"]+U["Minutes Awake"]);g.push(U)}),this.records=
g;else return N();break;default:za(this,a)?this.records.forEach(function(f){return["Number of Awakenings","Time in Bed","Minutes REM Sleep","Minutes Light Sleep","Minutes Deep Sleep"].forEach(function(d){return Object.prototype.hasOwnProperty.call(f,d)||(f[d]=null)})}):this.records=a.to("Standard").records.filter(function(f){return"asleep"==f.status}).map(function(f){return{start:f.start,end:f.end,"Start Time":f.start,"End Time":f.end,"Minutes Asleep":Math.round((f.end-f.start)/6E4),"Minutes Awake":0,
"Number of Awakenings":null,"Time in Bed":null,"Minutes REM Sleep":null,"Minutes Light Sleep":null,"Minutes Deep Sleep":null}})}}na(ab,G);
ab.prototype.to=function(a){switch(a){case "output":return wa(this,{file_format:function(){return"string"},contents:["Sleep","Start Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep"].concat(this.records.map(function(b){return["Start Time","End Time"].map(function(c){c=new Date(b[c]);var g=c.getHours();return'"'+c.getFullYear()+"-"+O(c.getMonth()+1)+"-"+O(c.getDate())+" "+(g%12||12)+":"+O(c.getMinutes())+(12<=g?"PM":
"AM")+'"'}).concat("Minutes Asleep;Minutes Awake;Number of Awakenings;Time in Bed;Minutes REM Sleep;Minutes Light Sleep;Minutes Deep Sleep".split(";").map(function(c){return null===b[c]?'"N/A"':'"'+b[c].toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+'"'})).join(",")}),"\n").join("\n")});case "Standard":return new W({records:this.records.map(function(b){return{status:"asleep",start:b.start,end:b.end,duration:b.end-b.start}})},this.h);default:return G.prototype.to.call(this,a)}};
ab.prototype.merge=function(a){a=a.to(this.file_format());this.records=this.records.concat(Ca(this.records,a.records,["start","end"])).sort(function(b,c){return c.start-b.start});return this};ab.prototype.file_format=function(){return"Fitbit"};ab.prototype.format_info=function(){return{name:"Fitbit",title:"fitbit",url:"/src/Fitbit",statuses:["asleep"],extension:".csv",logo:"https://community.fitbit.com/html/assets/fitbit_logo_1200.png"}};xa(ab);function bb(a,b){function c(l){return{type:"text",member:"status",regexp:new RegExp(h.map(function(q){return"("+q[1]+")"}).join("|"),"i"),"export":function(q,n,r){return n[r]=T(q[l])},"import":function(q,n,r){return h.some(function(x){return-1!=n[r].value.toString().search(new RegExp(x[1],"i"))&&(q[l]=x[0])})}}}function g(l){return{"export":function(q,n,r){q[l].forEach(function(x){return n[r++]=T(x)});return!0},"import":function(q,n,r){for(q=q[l]=e.map(function(){return(n[r++]||{}).value});q.length&&
!q[q.length-1];)q.pop();return!0}}}b&&(this.h=b);var f=[],d={},h=Fa();b={members:[],"export":function(){return!0},"import":function(l){return l.status="asleep"}};var e=[];if("url"==a.file_format()&&"SpreadsheetTable"==a.contents.file_format)d=a.contents.contents.member_map,Object.keys(d).forEach(function(l){var q=d[l];switch(l){case "start":case "end":f[q[1]]={member:q[0],type:"time",optional:!0};break;case "status":f[q[1]]=Object.assign({members:[q[0]]},c(q[0]));break;case "comments":e=q[2];1==e.length?
f[q[1]]={member:q[0],type:"text"}:f.push(Object.assign({members:e},g(q[0])));break;default:return N()}}),d.status||f.push(b);else if("Standard"==a.file_format())d={start:["start",0],end:["end",1],status:["status",2],comments:["comments",3]},f=[{member:"start",type:"time",optional:!0},{member:"end",type:"time",optional:!0},c("status"),{members:["comments"],"export":function(l,q,n){return q[n]=T((l.comments||[]).join("; "))},"import":function(l,q,n){q[n].value&&(l.comments=q[n].value.split(/ *; */));
return!0}}];else if(a.sheets&&a.sheets[0]&&a.sheets[0].cells[0]){if(a.sheets[0].cells[0].map(function(l,q){return[l,q]}).filter(function(l){var q=l[0].value;"string"!=typeof q&&(q="");if(![["end",/w.ke|stop|end/i],["start",/sleep|start|begin/i]].some(function(n){if(-1==q.search(n[1]))return!1;d.hasOwnProperty(n[0])||(d[n[0]]=[q,l[1]],f[l[1]]={member:q,type:"time",optional:!0});return!0}))if(-1!=q.search(/event|activity|stat(e|us)/i))d.hasOwnProperty("status")||(d.status=[q,l[1]],f[l[1]]=Object.assign({members:[q]},
c(q)));else{if(q&&-1==q.search(/comment|note/i))return!0;e.push(l)}return!1}).filter(function(l){var q=l[0].value;if(d.hasOwnProperty("start"))if(d.hasOwnProperty("end"))if(/date|time/i.test(q))f[l[1]]={member:q,optional:!0,oa:!0};else return!0;else d.end=[q,l[1]],f[l[1]]={member:q,type:"time",optional:!0};else d.start=[q,l[1]],f[l[1]]={member:q,type:"time",optional:!0};return!1}).length||!d.hasOwnProperty("start")||!d.hasOwnProperty("end"))return N();for(var p=0;p!=f.length;++p)if(!f[p])return N();
if(e.length)if(d.comments=[e[0][0].value,e[0][1],e.map(function(l){return l[0].value})],1==e.length)f[e[0][1]]={member:e[0][0].value,type:"text"};else{if(e[0][1]!=f.length)return N();for(p=1;p<e.length;++p)if(e[p][1]!=e[p-1][1]+1)return N();f.push(Object.assign({members:e.map(function(l){return l[0].value})},g(e[0][0].value)))}d.hasOwnProperty("status")||f.push(b)}else return N();this.member_map=d;this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:f}],!0);if(!za(this,a)){var k=this.member_map;
a=a.to("Standard").records;k.hasOwnProperty("status")||(a=a.filter(function(l){return"asleep"==l.status}));k.hasOwnProperty("comments")&&(a=a.map(function(l){l.comments&&(l=Object.assign({},l),l.comments=l.comments.map(function(q){return"string"==typeof q?q:q.text}),1==e.length&&(l.comments=l.comments[0]));return l}));this.records=a.map(function(l){var q={};Object.keys(k).forEach(function(n){return q[k[n][0]]=l[n]});return q})}}na(bb,G);
bb.prototype.to=function(a){switch(a){case "output":var b=[],c=[];Object.values(this.member_map).forEach(function(f){c[f[1]]=f[0];f[2]?b=b.concat(f[2]):b[f[1]]=f[0]});return wa(this,{file_format:function(){return"string"},contents:b.filter(function(f){return void 0!==f}).join()+"\n"+this.records.map(function(f){var d=[];c.forEach(function(h){h=f[h];Array.isArray(h)?d=d.concat(h.map(Pa)):d.push(Pa(h))});return d.join()+"\n"}).join("")});case "Standard":var g=this.member_map;return new W({records:this.records.map(function(f){return{status:f[(g.status||
["status"])[0]],start:f[(g.start||["start"])[0]],end:f[(g.end||["end"])[0]],comments:f[(g.comments||["comments"])[0]]||[]}})},this.h);default:return G.prototype.to.call(this,a)}};
bb.prototype.merge=function(a){function b(f){return["status","start","end"].map(function(d){return f[(c[d]||[d])[0]]}).join()}a=a.to("Standard");var c=this.member_map,g={};this.records.forEach(function(f){return g[b(f)]=1});this.records=this.records.concat(a.records.map(function(f){var d={};Object.keys(c).forEach(function(h){f.hasOwnProperty(h)&&(d[c[h][0]]=f[h])});return d}).filter(function(f){return!g.hasOwnProperty(b(f))}));return this};bb.prototype.file_format=function(){return"SpreadsheetTable"};
bb.prototype.format_info=function(){return{name:"SpreadsheetTable",title:"Spreadsheet Table",url:"/src/SpreadsheetTable",extension:".xlsx",icon:"mdi-file-excel"}};xa(bb);function cb(a,b){b&&(this.h=b);var c=Fa(),g={};this.spreadsheet=new S(this,[{sheet:"Records",member:"records",cells:[{member:"start",type:"time"},{member:"end",type:"time"},{member:"status",type:"text"},{members:["comments"],"export":function(v,z,A){return z[A]=T(v.comments.join("; "))},"import":function(v,z,A){return v.comments=z[A].value.split(/\s*;\s*/)}}]}]);if(a.sheets&&a.sheets[0]&&a.sheets[0].cells){var f=a.sheets[0].cells,d=0,h=0,e=f[0].map(function(v){return Na(v,a.spreadsheet)});b=f.map(function(v){return Na(v[0],
a.spreadsheet)});var p=Infinity,k=0,l=Infinity,q=0;f.forEach(function(v,z){return v.forEach(function(A,u){A.style&&(p=Math.min(p,u),k=Math.max(k,u),l=Math.min(l,z),q=Math.max(q,z))})});var n=[e,b].map(function(v){for(var z="number"!=typeof v[0]||isNaN(v[0])?[[1]]:[[0,v[0]]],A=1;A<v.length;++A)432E5<=v[A-1]&&432E5>v[A]&&(v[A]+=432E5),"number"!=typeof v[A]||isNaN(v[A])?z.push([A+1]):z[z.length-1].push(v[A]);v=z.sort(function(m,t){return t.length-m.length})[0];z=v.slice(1);var u;if(4<z.length)z.some(function(m){return 0>
m||864E5<=m})?u=1:23<z.length&&(u=2);else{var D=(new Date).getTime();z.length&&z.every(function(m){return 864E5<=m&&m<=D})&&(u=1)}return{lines:1,start:v[0],m:z,type:u}});switch(n[0].type){case 0:n[1].type&&(d=n[1]);break;case 1:switch(n[1].type){case 2:d=n[1];case 0:h=n[0];break;default:n[0].m.length>n[1].m.length?h=n[0]:d=n[1]}break;case 2:switch(n[1].type){case 1:d=n[1];case 0:h=n[0];break;default:n[0].m.length%24<n[1].m.length%24?h=n[0]:d=n[1]}}if(!h)if((n=d?1:0)?1==d.type:24<=e.length){var r=
[];e=e.length-n;e-=e%24;for(var x=0;x!=e;++x)r.push(864E5*x/e);h={lines:0,start:n,m:r,type:2}}else{r=[];e=(new Date).getTime();e-=e%864E5;for(x=Math.max(n+1,p);x<=k;++x)r.push(e-864E5*(k-x));h={lines:0,start:n,m:r,type:2}}if(!d)if(n=h.lines,1==h.type){r=[];b=b.length-n;b-=b%24;for(e=0;e!=b;++e)r.push(864E5*e/b);d={lines:0,start:n,m:r,type:2}}else{b=[];r=(new Date).getTime();r-=r%864E5;for(e=n=Math.max(n,l);e<=q;++e)b.push(r-864E5*(q-e));d={lines:0,start:n,m:b,type:2}}if(!h.m.length||!d.m.length)return N();
var J=[];d.m.forEach(function(v,z){var A=f[d.start+z];h.m.forEach(function(u,D){D=A[h.start+D]||{style:""};J.push({start:v+u,style:D.style||"",comments:D.value?[D.value]:[]})})});if(!J.length)return N();J=J.sort(function(v,z){return v.start-z.start});var C=[{style:NaN}];J.forEach(function(v){v.style==C[C.length-1].style?C[C.length-1].comments=C[C.length-1].comments.concat(v.comments):(C[C.length-1].end=v.start-1,C.push(v))});C.shift();var M={};C.forEach(function(v){var z=M[v.style]=M[v.style]||{B:[],
duration:0};z.B.push(v);v.end&&v.start&&(z.duration+=v.end-v.start)});var V=[],U=[];f.forEach(function(v,z){v.forEach(function(A,u){if(z<d.start-h.lines||z>=d.start+d.m.length||u<h.start-d.lines||u>=h.start+h.m.length)A.value&&U.push([z,u,A.value]),A.style&&V.push([z,u,A.style])})});var H=[];V.forEach(function(v){return H=H.concat(U.map(function(z){return[Math.abs(z[0]-v[0])+Math.abs(z[1]-v[1]),v[2],z[2]]}))});var F={};c.forEach(function(v){return F[v[0]]=new RegExp(v[1],"i")});var K={};H.sort(function(v,
z){return v[0]-z[0]}).forEach(function(v){if(M[v[1]]&&!K[v[2]]){K[v[2]]=1;var z=Object.keys(F).find(function(A){return-1!=v[2].search(F[A])});z?delete F[z]:z=v[2];g[z]=v[1];M[v[1]].B.forEach(function(A){delete A.style;A.status=z});delete M[v[1]]}});var P=0;Object.values(M).sort(function(v,z){return z.duration-v.duration}).forEach(function(v){var z=c.find(function(A){return F[A[0]]});z?(z=z[0],delete F[z]):z="Unknown status #"+ ++P;v.B.forEach(function(A){g[z]=A.style;A.status=z;delete A.style})})}else{if(za(this,
a))return;C=a.to("Standard").records.map(function(v){var z={comments:[]};["start","end","status","comments"].forEach(function(A){return v.hasOwnProperty(A)&&(z[A]=v[A])});g[v.status]=c.find(function(A){return A[0]==v.status})[2];return z})}this.records=C;this.status_map=g}na(cb,G);
cb.prototype.to=function(a){switch(a){case "output":throw Error("Please use to_async() to generate output for SpreadsheetGraph");case "Standard":return new W({records:this.records},this.h);default:return G.prototype.to.call(this,a)}};
cb.prototype.to_async=function(a){var b=this;switch(a){case "output":var c=this.records,g=this.status_map,f=[60,30,15,5].map(function(n){return 6E4*n}).find(function(n){return!c.filter(function(r){return r.start%n}).length})||3E5,d=Infinity,h=0;c.forEach(function(n){d=Math.min(d,n.start);h=Math.max(h,n.end||n.start+1)});Infinity==d&&(d=h);d-=d%864E5;h-=h%864E5;var e=[[T()]];a=["YYYY-MM-DD"];for(var p=[11],k=[{font:{size:10}}],l=0;864E5!=l;l+=f)e[0].push(T(l/864E5,"#FFEEEEEE,#FFEEEEEE")),a.push("H:MM"),
p.push(5),k.push({font:{size:10}});for(l=d;l<=h;l+=864E5)e.push([T(new Date(l),"#FFEEEEEE,#FFEEEEEE")]);c.forEach(function(n){var r=n.start,x=n.end||r+1,J=g[n.status];n=(n.comments||[]).slice(0);for(var C=Math.ceil(n.length/Math.max((x-r)/f)),M=r;M<Math.max(x,r+1);M+=f){var V=M%864E5;e[(M-V-d)/864E5+1][Math.floor(V/f)+1]=T(n.splice(0,C).join("; "),J)}});var q={};c.forEach(function(n){var r=n.status;g[r]&&((q[r]=q[r]||[0,g[r],r])[0]+=n.end-n.start)});Object.values(q).sort(function(n,r){return r[0]-
n[0]}).forEach(function(n,r){r=e[r+1]=e[r+1]||[];r[e[0].length+2]=T(void 0,n[1]);r[e[0].length+3]=T(n[2])});this.spreadsheet.sheets[0]={name:"Sleep Graph",number_formats:a,cells:e,widths:p,styles:k,options:{properties:{defaultRowHeight:12.5},pageSetup:{paperSize:9,orientation:"landscape"}}};return this.spreadsheet.serialise().then(function(n){return wa(b,{file_format:function(){return"array"},contents:n})});default:return G.prototype.to_async.call(this,a)}};
cb.prototype.merge=function(a){function b(d){return["status","start","end"].map(function(h){return d[h]}).join()}a=a.to(this.file_format());var c={};this.records.forEach(function(d){return c[b(d)]=1});this.records=this.records.concat(a.records.filter(function(d){return!c.hasOwnProperty(b(d))}));var g=a.status_map,f=this.status_map;Object.keys(g).forEach(function(d){f.hasOwnProperty(d)||(f[d]=g[d])});return this};cb.prototype.file_format=function(){return"SpreadsheetGraph"};
cb.prototype.format_info=function(){return{name:"SpreadsheetGraph",title:"Spreadsheet Graph",url:"/src/SpreadsheetGraph",extension:".xlsx",icon:"mdi-file-excel-outline"}};xa(cb);var db=Ha.serialiser,eb={};function fb(a,b){"Example"==a?console.error("register_roundtrip_modifier() called with engine == 'Example' - please set the engine"):eb[a]=b}function gb(a,b,c){var g=Object.assign({},a),f=Object.assign({},b);delete g.spreadsheet;delete f.spreadsheet;Object.keys(g).forEach(function(d){g[d]==db&&delete g[d]});Object.keys(f).forEach(function(d){f[d]==db&&delete f[d]});c&&console.error("Observed and expected objects should be equal:\n",a,b);expect(g).toEqual(f)}
function hb(a,b){var c=null,g=!1,f=console.error;ua="Etc/GMT";a.J&&(console.error=function(){});try{var d=a.input;a.ja&&(d.X=JSON.parse(JSON.stringify(d.X)));d&&"function"==typeof d&&(d=d());c="string"==typeof a.input||a.input.file_format?I(a.input,b):I({file_format:function(){return"archive"},contents:a.input},b)}catch(h){a.error||f.call(console,"Unexpected error constructing object:",h),g=!0}a.J&&(console.error=f);it('produces the correct error for "'+a.name+'"',function(){expect(g).toEqual(!!a.error)});
g||it('produces an extension other than ".exm" for "'+a.name+'"',function(){expect(c.format_info().ma).not.toEqual(".exm")});return g==!!a.error?c:null}
function X(a){a.name||(a.name="engine's 'parse' test");var b=a.debug,c="disable"!=(a.s||""),g="disable"!=(a.Z||""),f=hb(a,db);f&&(it('reads test "'+a.name+'" correctly',function(){gb(f,a.g,b)}),it('produces a file of the correct format for "'+(a.name||"engine's 'parse' test")+'"',function(){expect(f.file_format()).toEqual(a.i)}),it('URL-ifies "'+(a.name||"engine's 'parse' test")+'" correctly',function(){var d=f.to("url");d=I({file_format:"url",contents:d},db);gb(d,f,b)}),ta.forEach(function(d){it('converts "'+
(a.name||"engine's 'parse' test")+'" to '+d.name+" correctly in test_parse()",function(){return new Promise(function(h,e){try{f.to_async(d.name).then(function(p){try{p.to_async(f.file_format()).then(function(k){var l=Object.assign({},k.to("Standard")),q=Object.assign({},f.to("Standard"));b&&console.log({"0. test and engine":[a,d],"1. original":f,"2. original to Standard":f.to("Standard"),"3. original to formatted":p,"4. original to formatted to Standard":p.to("Standard"),"5. original to formatted and back again":k,
"6. observed":l,"7. expected":q});[l,q].forEach(function(r){return r.records=r.records.map(function(x){return Object.assign({},x)})});if(eb[f.file_format()])eb[f.file_format()](q,l,d);if(p.format_info().statuses){var n={};p.format_info().statuses.forEach(function(r){return n[r]=1});k=q.records.length;q.records=q.records.filter(function(r){return n[r.status]});k!=q.records.length&&[l,q].forEach(function(r){return r.records=r.records.map(function(x){x=Object.assign({},x);delete x.missing_record_after;
return x})})}gb(l,q,b);h()},function(k){console.error('formatted.to_async("'+f.file_format()+'") failed:',f,p,k);e(k)})}catch(k){console.error('formatted.to_async("'+f.file_format()+'") failed:',f,p,k),e(k)}},function(p){console.error('diary.to_async("'+d.name+'") failed:',f,p);e(p)})}catch(p){console.error('diary.to_async("'+d.name+'") failed:',f,p),e(p)}})})}),"undefined"!==typeof module&&module.exports||(g&&it('outputs "'+(a.name||"engine's 'parse' test")+'" correctly',function(){return new Promise(function(d,
h){try{f.to_async("output").then(function(e){(new Ha(function(p,k){b&&console.log({"0. test":a,"1. original":f,"2. observed":p,"3. source":k});gb(p,f,b);d()},function(p){console.error("DiaryLoader failed:",f,e,p);h(p)})).load(Ha.to_url(e))})}catch(e){console.error("diary.to_async() failed:",f,e),h(e)}})}),c&&it('spreadsheetifies "'+(a.name||"engine's 'parse' test")+'" correctly',function(){var d=Object.assign({},f);Object.keys(d).forEach(function(h){"function"==(typeof d[h]).toLocaleLowerCase()&&
delete d[h]});return new Promise(function(h,e){try{f.to_async("spreadsheet").then(function(p){return Ka(p).then(function(k){(new Ha(function(l){var q=Object.assign({},l);Object.keys(q).forEach(function(n){"function"==(typeof q[n]).toLocaleLowerCase()&&delete q[n]});gb(q,d,b);h()},function(l){console.error("DiaryLoader failed:",f,k,l);e(l)})).load(k)})})}catch(p){console.error("diary.to_async() failed:",f,p),e(p)}})})))}
function ib(a){var b=a.debug;a.name||(a.name="engine's 'from standard' test");var c=hb({name:a.name,input:{file_format:function(){return"Standard"},contents:{file_format:"Standard",records:a.input}}},db),g=hb({name:a.name,input:a.g},db);it('initialises "'+a.name+'" from Standard format correctly',function(){expect(!!c).toEqual(!0);expect(!!g).toEqual(!0);c&&g&&gb(c.to(a.format),g,b)})}
function Y(a){var b=a.debug;a.name||(a.name="engine's 'to' test");var c=hb(a);c&&it('converts "'+a.name+'" to "'+a.format+'" correctly in test_to',function(){try{return c.to_async(a.format).then(function(g){g="Standard"==a.format?g.records:g.contents;b&&console.error("Observed and expected objects should be equal:\n",g,a.g);return expect(g).toEqual(a.g)})}catch(g){throw console.error("diary.to_async() failed:",c,g),g;}})}
function Z(a){a.name||(a.name="engine's 'merge' test");it('merges "'+a.name+'" correctly',function(){var b=Object.assign({},I(a.left).merge(I(a.right)));delete b.spreadsheet;expect(b).toEqual(a.g)})};describe("Spreadsheet",function(){[[null,NaN],[0,0],[1,1E12],[new Date(0),0],[new Date(1),1],["0",0],["1",36E5],["1AM",36E5],["1am",36E5],["1Am",36E5],["1aM",36E5],["MidNight - 01:00",0],["01:00 - MidNight",36E5],["14:30",522E5]].forEach(function(a){it('parses "'+a[0]+'" correctly',function(){expect(Na(a[0])).toEqual(a[1])})});it("converts between sheets and objects correctly",function(){var a={},b=new S(a,[{sheet:"records",cells:[{member:"test_time",type:"time"},{member:"test_duration",type:"duration"},
{member:"test_number",type:"number"},{member:"test_text",type:"text"},{members:["test_low_level_1","test_low_level_2"],"export":function(g,f,d){f[d+0]={value:2*g.test_low_level_1,style:""};f[d+1]={value:"a"+g.test_low_level_2,style:""};return!0},"import":function(g,f,d){g.test_low_level_1=f[d+0].value/2;g.test_low_level_2=f[d+1].value.substr(1);return!0}}]}]),c={spreadsheet:b,sheets:[{name:"records",cells:[[{style:"",value:"test_time"},{style:"",value:"test_duration"},{style:"",value:"test_number"},
{style:"",value:"test_text"},{style:"",value:"test_low_level_1"},{style:"",value:"test_low_level_2"}],[{style:"",value:new Date("1970-01-01T03:25:45.678Z")},{style:"",value:new Date("1899-12-30T06:30:56.789Z")},{style:"",value:987654321},{style:"",value:"abcdefghij"},{style:"",value:6},{style:"",value:"a3"}]]}]};c.sheets.forEach(function(g){return Oa(g.cells)});expect(b.load(c)).toBeTrue();expect(b.synchronise()).toBeTrue();expect(a).toEqual({records:[{test_time:12345678,test_duration:23456789,test_number:987654321,
test_text:"abcdefghij",test_low_level_1:3,test_low_level_2:"3"}]})})});fb("Standard",function(a,b,c){[a,b].forEach(function(g){g.records=g.records.slice(0).map(function(f){f.comments&&(f.comments=f.comments.slice(0));return f});g.settings=Object.assign({},g.settings)});576E5==a.settings.minimum_day_duration&&1152E5==a.settings.maximum_day_duration||[a,b].forEach(function(g){delete g.settings.minimum_day_duration;delete g.settings.maximum_day_duration;g.records.forEach(function(f){["start_of_new_day","day_number"].forEach(function(d){delete f[d]})})});switch(c.name){case "ActivityLog":case "SpreadsheetGraph":case "SpreadsheetTable":case "PleesTracker":case "SleepChart1":case "Fitbit":[a,
b].forEach(function(g){g.records.forEach(function(f){["duration","day_number","is_primary_sleep","start_of_new_day"].forEach(function(d){delete f[d]})})})}switch(c.name){case "SpreadsheetTable":a.records.forEach(function(g){g.comments&&(g.comments=g.comments.map(function(f){return"string"==typeof f?f:f.text}))})}switch(c.name){case "Sleepmeter":case "SleepAsAndroid":case "Fitbit":a.records.forEach(function(g,f){["start_timezone","end_timezone"].forEach(function(d){void 0!==g[d]||((b.records[f]||{})[d]||
"").search(/^Etc\/GMT(-1)?$/)||(delete g[d],delete b.records[f][d])})})}switch(c.name){case "ActivityLog":case "SleepChart1":case "PleesTracker":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["comments"].forEach(function(d){delete f[d]})})})}});
describe("Standard format",function(){function a(b){b.file_format="Standard";return{file_format:function(){return"Standard"},contents:b}}X({name:"simple diary",i:"Standard",input:'{"file_format":"Standard","records":[]}',g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},records:[]}});X({name:"invaid JSON",qa:!0,i:"Standard",input:"{",error:!0,J:!0});X({name:"missing records",i:"Standard",input:{file_format:"Standard"},error:!0,J:!0});X({name:"input object",i:"Standard",input:a({records:[]}),
g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},records:[]}});X({name:"min/max durations",i:"Standard",input:a({records:[],minimum_day_duration:16,maximum_day_duration:32}),g:{settings:{minimum_day_duration:16,maximum_day_duration:32},records:[]}});X({name:"hard-to-parse comment",i:"Standard",input:a({records:[{status:"awake",comments:['this is a single field containing one comma (,) one newline (\n) and one double quote (")']}]}),g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},
records:[{status:"awake",comments:['this is a single field containing one comma (,) one newline (\n) and one double quote (")'],day_number:0,start_of_new_day:!1}]}});X({name:"records with various members defined",s:"disable",i:"Standard",input:a({file_format:"Standard",records:[{start:1,end:2,duration:3,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:1,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,end:2,status:"awake",comments:["comment string",
{time:4,text:"comment object"}],day_number:1,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:1,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],
is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}]}]}),g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},records:[{start:1,end:2,duration:3,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:1,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,
end:2,duration:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:1,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:1,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:2,start_of_new_day:!0,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",
comments:["comment string",{time:4,text:"comment object"}],day_number:2,start_of_new_day:!1,is_primary_sleep:!0,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:2,start_of_new_day:!1,missing_record_after:!0},{start:1,status:"awake",comments:["comment string",{time:4,text:"comment object"}],day_number:2,start_of_new_day:!1}]}});X({name:"Day-length calculations",s:"disable",i:"Standard",input:a({file_format:"Standard",records:[{start:0,
status:"asleep"},{start:576E5,status:"asleep"},{start:576E5+1,status:"asleep"},{start:1728E5+1,status:"asleep"},{start:288E6+2,status:"asleep"}]}),g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},records:[{start:0,status:"asleep",day_number:0,start_of_new_day:!1,missing_record_after:!0},{start:576E5,status:"asleep",day_number:0,start_of_new_day:!1,missing_record_after:!0},{start:576E5+1,status:"asleep",day_number:1,start_of_new_day:!0,missing_record_after:!0},{start:1728E5+1,status:"asleep",
day_number:2,start_of_new_day:!0,missing_record_after:!0},{start:288E6+2,status:"asleep",day_number:4,start_of_new_day:!0}]}});X({name:"Day-length calculations with specified min/max duration",s:"disable",Z:"disable",i:"Standard",input:a({file_format:"Standard",records:[{start:0,status:"asleep"},{start:576E5,status:"asleep"},{start:576E5+1,status:"asleep"},{start:1728E5+1,status:"asleep"},{start:288E6+2,status:"asleep"}],minimum_day_duration:1,maximum_day_duration:Math.pow(2,31)}),g:{settings:{minimum_day_duration:1,
maximum_day_duration:Math.pow(2,31)},records:[{start:0,status:"asleep",day_number:0,start_of_new_day:!1,missing_record_after:!0},{start:576E5,status:"asleep",day_number:1,start_of_new_day:!0,missing_record_after:!0},{start:576E5+1,status:"asleep",day_number:1,start_of_new_day:!1,missing_record_after:!0},{start:1728E5+1,status:"asleep",day_number:2,start_of_new_day:!0,missing_record_after:!0},{start:288E6+2,status:"asleep",day_number:3,start_of_new_day:!0}]}});X({name:"Out-of-order records",s:"disable",
i:"Standard",input:a({file_format:"Standard",records:[{start:576E5,status:"asleep"},{start:0,status:"asleep"}]}),g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},records:[{start:0,status:"asleep",day_number:0,start_of_new_day:!1,missing_record_after:!0},{start:576E5,status:"asleep",day_number:0,start_of_new_day:!1}]}});X({name:"Multiple sleeps",i:"Standard",input:a({file_format:"Standard",records:[{duration:16,status:"asleep"},{duration:32,status:"asleep"}]}),g:{settings:{minimum_day_duration:576E5,
maximum_day_duration:1152E5},records:[{duration:16,status:"asleep",day_number:0,start_of_new_day:!1,missing_record_after:!0},{duration:32,status:"asleep",day_number:0,start_of_new_day:!1,is_primary_sleep:!0}]}});it("serialises data correctly",function(){expect(I(a({records:[{duration:1,status:"asleep"},{duration:2,status:"asleep"}]})).to("output").contents).toEqual('{"file_format":"Standard","records":[{"duration":1,"status":"asleep","start_of_new_day":false,"day_number":0,"missing_record_after":true},{"duration":2,"status":"asleep","start_of_new_day":false,"day_number":0,"is_primary_sleep":true}],"settings":{"minimum_day_duration":57600000,"maximum_day_duration":115200000}}')});
[{left:[],right:[],expected:[]},{left:[{start:1,end:2}],right:[],expected:[{start:1,end:2,duration:1,start_of_new_day:!1,day_number:0}]},{left:[],right:[{start:1,end:2}],expected:[{start:1,end:2,duration:1,start_of_new_day:!1,day_number:0}]},{left:[{start:1,end:2}],right:[{start:1,end:2}],expected:[{start:1,end:2,duration:1,start_of_new_day:!1,day_number:0}]},{left:[{start:2,end:3}],right:[{start:1,end:2}],expected:[{start:1,end:2,duration:1,start_of_new_day:!1,day_number:0},{start:2,end:3,duration:1,
start_of_new_day:!1,day_number:0}]},{left:[{start:1,end:2}],right:[{start:2,end:3}],expected:[{start:1,end:2,duration:1,start_of_new_day:!1,day_number:0},{start:2,end:3,duration:1,start_of_new_day:!1,day_number:0}]}].forEach(function(b){Z({left:a({file_format:"Standard",records:b.left}),right:a({file_format:"Standard",records:b.right}),g:{settings:{minimum_day_duration:576E5,maximum_day_duration:1152E5},records:b.expected}})});it("summarises records correctly",function(){[{records:[],expected:null},
{records:[{start:1}],expected:null},{records:[{duration:1}],expected:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[void 0],rolling_average:[void 0]}},{records:[{duration:1},{start:1}],expected:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1,void 0],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,
timestamps:[void 0,1],rolling_average:[void 0,void 0]}},{records:[1,1,1,1].map(function(b){return{duration:b}}),expected:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1,1,1,1],interquartile_durations:[1,1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[void 0,void 0,void 0,void 0],rolling_average:[void 0,void 0,void 0,void 0]}},{records:[-10,1,1,11].map(function(b){return{duration:b}}),expected:{average:.75,mean:.75,interquartile_mean:1,median:1,
interquartile_range:0,durations:[-10,1,1,11],interquartile_durations:[1,1],standard_deviation:7.428828979051813,interquartile_standard_deviation:0,timestamps:[void 0,void 0,void 0,void 0],rolling_average:[void 0,void 0,void 0,void 0]}}].forEach(function(b){expect(I(a({file_format:"Standard",records:b.records})).summarise_records()).toEqual(b.expected)})});it("calculates the correct sleep/wake status",function(){[{records:[],expected:""},{records:[{status:"awake"}],expected:"awake"},{records:[{status:"asleep"}],
expected:"asleep"},{records:[{status:"awake"},{status:"asleep"}],expected:"asleep"},{records:[{status:"asleep"},{status:"awake"}],expected:"awake"}].forEach(function(b){expect(I(a({file_format:"Standard",records:b.records})).latest_sleep_status()).toEqual(b.expected)})});it("calculates the correct daily schedule",function(){[{records:[],args:[],expected:{wake:null,sleep:null}},{records:[{start_timezone:"Etc/GMT",is_primary_sleep:!0,start:1}],args:[],expected:{wake:null,sleep:{average:1,mean:1,interquartile_mean:1,
median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[1],rolling_average:[void 0]}}},{records:[{start_timezone:"Etc/GMT",is_primary_sleep:!0,end:1}],args:[],expected:{wake:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[1],rolling_average:[void 0]},sleep:null}},{records:[{start_timezone:"Etc/GMT",
is_primary_sleep:!0,start:1,end:1}],args:[],expected:{wake:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[1],rolling_average:[void 0]},sleep:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[1],rolling_average:[void 0]}}},{records:[{start_timezone:"Etc/GMT",
end_timezone:"Etc/GMT",is_primary_sleep:!0,start:1,end:864E5-1}],args:[],expected:{wake:{average:864E5-1,mean:864E5-1,interquartile_mean:864E5-1,median:864E5-1,interquartile_range:0,durations:[864E5-1],interquartile_durations:[864E5-1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[864E5-1],rolling_average:[void 0]},sleep:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,
timestamps:[1],rolling_average:[void 0]}}},{records:[{start_timezone:"Etc/GMT",is_primary_sleep:!0,start:1},{start_timezone:"Etc/GMT",is_primary_sleep:!0,start:3}],args:[],expected:{wake:null,sleep:{average:2,mean:2,interquartile_mean:3,median:3,interquartile_range:0,durations:[1,3],interquartile_durations:[3],standard_deviation:1,interquartile_standard_deviation:0,timestamps:[1,3],rolling_average:[void 0,void 0]}}},{records:[{start_timezone:"Etc/GMT",is_primary_sleep:!0,start:864E5-1},{start_timezone:"Etc/GMT",
is_primary_sleep:!0,start:1}],args:[],expected:{wake:null,sleep:{average:0,mean:0,interquartile_mean:1,median:1,interquartile_range:0,durations:[1,864E5-1],interquartile_durations:[864E5-1],standard_deviation:1,interquartile_standard_deviation:0,timestamps:[1,864E5-1],rolling_average:[void 0,void 0]}}},{records:[{is_primary_sleep:!0,start:158544E7,start_timezone:"Europe/London"},{is_primary_sleep:!0,start:15855228E5,start_timezone:"Europe/London"},{is_primary_sleep:!0,start:15854364E5,start_timezone:"Europe/Prague"},
{is_primary_sleep:!0,start:15855192E5,start_timezone:"Europe/Prague"},{is_primary_sleep:!0,start:15854076E5,start_timezone:"Asia/Seoul"},{is_primary_sleep:!0,start:1585494E6,start_timezone:"Asia/Seoul"}],args:[null,null],expected:{wake:null,sleep:{average:0,mean:0,interquartile_mean:0,median:0,interquartile_range:0,durations:[0,0,0,0,0,0],interquartile_durations:[0,0,0],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[158544E7,158544E7,158544E7,15855264E5,15855264E5,15855264E5],
rolling_average:[void 0,void 0,void 0,void 0,void 0,void 0]}}},{records:[{is_primary_sleep:!0,start:15854436E5,start_timezone:"Etc/GMT+1",end:1585476E6,end_timezone:"Etc/GMT+2"}],args:[null,null],expected:{wake:{average:288E5,mean:288E5,interquartile_mean:288E5,median:288E5,interquartile_range:0,durations:[288E5],interquartile_durations:[288E5],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[15854688E5],rolling_average:[void 0]},sleep:{average:0,mean:0,interquartile_mean:0,median:0,
interquartile_range:0,durations:[0],interquartile_durations:[0],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[158544E7],rolling_average:[void 0]}}}].forEach(function(b){var c=I(a({file_format:"Standard",records:b.records}));expect(c.summarise_schedule.apply(c,b.args)).toEqual(b.expected)})});it("calculates the correct daily activities",function(){[{records:[],args:[],expected:[]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6}],args:[],expected:[{start:12622824E5,
end:12623688E5,duration:864E5,id:"2009-12-31T18:00:00.000 Etc/GMT",year:2009,month:11,day:30,activities:[{offset_start:.25,offset_time:.25,start:1262304E6,time:1262304E6,type:"start-unknown",index:0,record:{start:1262304E6,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T00:00:00.000 Etc/GMT",first_start:"2010-01-01T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6,end:12623904E5}],
args:[],expected:[{start:12622824E5,end:12623688E5,duration:864E5,id:"2009-12-31T18:00:00.000 Etc/GMT",year:2009,month:11,day:30,activities:[{start:1262304E6,time:12623364E5,end:12623688E5,offset_start:.25,offset_end:1,offset_time:.625,type:"start-mid",index:0,record:{start:1262304E6,end:12623904E5,duration:864E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:648E5,last_start:"2010-01-01T00:00:00.000 Etc/GMT",first_start:"2010-01-01T00:00:00.000 Etc/GMT",
first_end:"2010-01-01T18:00:00.000 Etc/GMT",last_end:"2010-01-01T18:00:00.000 Etc/GMT"}}},{start:12623688E5,end:12624552E5,duration:864E5,id:"2010-01-01T18:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{start:12623688E5,end:12623904E5,type:"mid-end",time:12623796E5,record:{is_primary_sleep:!0,status:"asleep",start:1262304E6,end:12623904E5,duration:864E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:.25,offset_time:.125}],activity_summaries:{asleep:{duration:216E5,last_start:"2010-01-01T18:00:00.000 Etc/GMT",
first_start:"2010-01-01T18:00:00.000 Etc/GMT",last_end:"2010-01-02T00:00:00.000 Etc/GMT",first_end:"2010-01-02T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6,end:12624768E5}],args:[],expected:[{start:12622824E5,end:12623688E5,duration:864E5,id:"2009-12-31T18:00:00.000 Etc/GMT",year:2009,month:11,day:30,activities:[{start:1262304E6,time:12623364E5,end:12623688E5,offset_start:.25,offset_end:1,offset_time:.625,type:"start-mid",index:0,record:{start:1262304E6,
end:12624768E5,duration:1728E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:648E5,last_start:"2010-01-01T00:00:00.000 Etc/GMT",first_start:"2010-01-01T00:00:00.000 Etc/GMT",first_end:"2010-01-01T18:00:00.000 Etc/GMT",last_end:"2010-01-01T18:00:00.000 Etc/GMT"}}},{start:12623688E5,end:12624552E5,duration:864E5,id:"2010-01-01T18:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{start:12623688E5,end:12624552E5,type:"mid-mid",time:1262412E6,
record:{is_primary_sleep:!0,status:"asleep",start:1262304E6,end:12624768E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:1,offset_time:.5}],activity_summaries:{asleep:{duration:864E5,first_start:"2010-01-01T18:00:00.000 Etc/GMT",last_start:"2010-01-01T18:00:00.000 Etc/GMT",first_end:"2010-01-02T18:00:00.000 Etc/GMT",last_end:"2010-01-02T18:00:00.000 Etc/GMT"}}},{start:12624552E5,end:12625416E5,duration:864E5,id:"2010-01-02T18:00:00.000 Etc/GMT",year:2010,month:0,
day:1,activities:[{start:12624552E5,end:12624768E5,type:"mid-end",time:1262466E6,record:{is_primary_sleep:!0,status:"asleep",start:1262304E6,end:12624768E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:2,offset_start:0,offset_end:.25,offset_time:.125}],activity_summaries:{asleep:{duration:216E5,first_start:"2010-01-02T18:00:00.000 Etc/GMT",last_start:"2010-01-02T18:00:00.000 Etc/GMT",first_end:"2010-01-03T00:00:00.000 Etc/GMT",last_end:"2010-01-03T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,
status:"asleep",start:12697344E5}],args:[],expected:[{start:12697128E5,end:12697992E5,duration:864E5,id:"2010-03-27T18:00:00.000 Etc/GMT",year:2010,month:2,day:26,activities:[{offset_start:.25,offset_time:.25,start:12697344E5,time:12697344E5,type:"start-unknown",index:0,record:{start:12697344E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-03-28T00:00:00.000 Etc/GMT",first_start:"2010-03-28T00:00:00.000 Etc/GMT"}}}]},
{records:[{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12698208E5}],args:[],expected:[{start:12697128E5,end:12697992E5,duration:864E5,id:"2010-03-27T18:00:00.000 Etc/GMT",year:2010,month:2,day:26,activities:[{start:12697344E5,time:12697668E5,end:12697992E5,offset_start:.25,offset_end:1,offset_time:.625,type:"start-mid",index:0,record:{start:12697344E5,end:12698208E5,duration:864E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:648E5,
last_start:"2010-03-28T00:00:00.000 Etc/GMT",first_start:"2010-03-28T00:00:00.000 Etc/GMT",first_end:"2010-03-28T18:00:00.000 Etc/GMT",last_end:"2010-03-28T18:00:00.000 Etc/GMT"}}},{start:12697992E5,end:12698856E5,duration:864E5,id:"2010-03-28T18:00:00.000 Etc/GMT",year:2010,month:2,day:27,activities:[{start:12697992E5,end:12698208E5,type:"mid-end",time:126981E7,record:{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12698208E5,duration:864E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,
offset_end:.25,offset_time:.125}],activity_summaries:{asleep:{duration:216E5,last_start:"2010-03-28T18:00:00.000 Etc/GMT",first_start:"2010-03-28T18:00:00.000 Etc/GMT",last_end:"2010-03-29T00:00:00.000 Etc/GMT",first_end:"2010-03-29T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12699072E5}],args:[],expected:[{start:12697128E5,end:12697992E5,duration:864E5,id:"2010-03-27T18:00:00.000 Etc/GMT",year:2010,month:2,day:26,activities:[{start:12697344E5,time:12697668E5,
end:12697992E5,offset_start:.25,offset_end:1,offset_time:.625,type:"start-mid",index:0,record:{start:12697344E5,end:12699072E5,duration:1728E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:648E5,last_start:"2010-03-28T00:00:00.000 Etc/GMT",first_start:"2010-03-28T00:00:00.000 Etc/GMT",first_end:"2010-03-28T18:00:00.000 Etc/GMT",last_end:"2010-03-28T18:00:00.000 Etc/GMT"}}},{start:12697992E5,end:12698856E5,duration:864E5,id:"2010-03-28T18:00:00.000 Etc/GMT",
year:2010,month:2,day:27,activities:[{start:12697992E5,end:12698856E5,type:"mid-mid",time:12698424E5,record:{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12699072E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:1,offset_time:.5}],activity_summaries:{asleep:{duration:864E5,first_start:"2010-03-28T18:00:00.000 Etc/GMT",last_start:"2010-03-28T18:00:00.000 Etc/GMT",first_end:"2010-03-29T18:00:00.000 Etc/GMT",last_end:"2010-03-29T18:00:00.000 Etc/GMT"}}},
{start:12698856E5,end:1269972E6,duration:864E5,id:"2010-03-29T18:00:00.000 Etc/GMT",year:2010,month:2,day:28,activities:[{start:12698856E5,end:12699072E5,type:"mid-end",time:12698964E5,record:{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12699072E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:2,offset_start:0,offset_end:.25,offset_time:.125}],activity_summaries:{asleep:{duration:216E5,first_start:"2010-03-29T18:00:00.000 Etc/GMT",last_start:"2010-03-29T18:00:00.000 Etc/GMT",
first_end:"2010-03-30T00:00:00.000 Etc/GMT",last_end:"2010-03-30T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12697344E5}],args:["Europe/London"],expected:[{start:12697128E5,end:12697956E5,duration:828E5,id:"2010-03-27T18:00:00.000 Europe/London",year:2010,month:2,day:26,activities:[{offset_start:.2608695652173913,offset_time:.2608695652173913,start:12697344E5,time:12697344E5,type:"start-unknown",index:0,record:{start:12697344E5,is_primary_sleep:!0,start_of_new_day:!0,
status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-03-28T00:00:00.000 Europe/London",first_start:"2010-03-28T00:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12698208E5}],args:["Europe/London"],expected:[{start:12697128E5,end:12697956E5,duration:828E5,id:"2010-03-27T18:00:00.000 Europe/London",year:2010,month:2,day:26,activities:[{start:12697344E5,time:1269765E6,end:12697956E5,offset_start:.2608695652173913,
offset_end:1,offset_time:.6304347826086957,type:"start-mid",index:0,record:{start:12697344E5,end:12698208E5,duration:864E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:612E5,last_start:"2010-03-28T00:00:00.000 Europe/London",first_start:"2010-03-28T00:00:00.000 Europe/London",first_end:"2010-03-28T18:00:00.000 Europe/London",last_end:"2010-03-28T18:00:00.000 Europe/London"}}},{start:12697956E5,end:1269882E6,duration:864E5,id:"2010-03-28T18:00:00.000 Europe/London",
year:2010,month:2,day:27,activities:[{start:12697956E5,end:12698208E5,type:"mid-end",time:12698082E5,record:{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12698208E5,duration:864E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:.2916666666666667,offset_time:.14583333333333334}],activity_summaries:{asleep:{duration:252E5,last_start:"2010-03-28T18:00:00.000 Europe/London",first_start:"2010-03-28T18:00:00.000 Europe/London",last_end:"2010-03-29T01:00:00.000 Europe/London",
first_end:"2010-03-29T01:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12699072E5}],args:["Europe/London"],expected:[{start:12697128E5,end:12697956E5,duration:828E5,id:"2010-03-27T18:00:00.000 Europe/London",year:2010,month:2,day:26,activities:[{start:12697344E5,time:1269765E6,end:12697956E5,offset_start:.2608695652173913,offset_end:1,offset_time:.6304347826086957,type:"start-mid",index:0,record:{start:12697344E5,end:12699072E5,duration:1728E5,is_primary_sleep:!0,
start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:612E5,last_start:"2010-03-28T00:00:00.000 Europe/London",first_start:"2010-03-28T00:00:00.000 Europe/London",first_end:"2010-03-28T18:00:00.000 Europe/London",last_end:"2010-03-28T18:00:00.000 Europe/London"}}},{start:12697956E5,end:1269882E6,duration:864E5,id:"2010-03-28T18:00:00.000 Europe/London",year:2010,month:2,day:27,activities:[{start:12697956E5,end:1269882E6,type:"mid-mid",time:12698388E5,record:{is_primary_sleep:!0,
status:"asleep",start:12697344E5,end:12699072E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:1,offset_time:.5}],activity_summaries:{asleep:{duration:864E5,first_start:"2010-03-28T18:00:00.000 Europe/London",last_start:"2010-03-28T18:00:00.000 Europe/London",first_end:"2010-03-29T18:00:00.000 Europe/London",last_end:"2010-03-29T18:00:00.000 Europe/London"}}},{start:1269882E6,end:12699684E5,duration:864E5,id:"2010-03-29T18:00:00.000 Europe/London",year:2010,month:2,
day:28,activities:[{start:1269882E6,end:12699072E5,type:"mid-end",time:12698946E5,record:{is_primary_sleep:!0,status:"asleep",start:12697344E5,end:12699072E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:2,offset_start:0,offset_end:.2916666666666667,offset_time:.14583333333333334}],activity_summaries:{asleep:{duration:252E5,first_start:"2010-03-29T18:00:00.000 Europe/London",last_start:"2010-03-29T18:00:00.000 Europe/London",first_end:"2010-03-30T01:00:00.000 Europe/London",last_end:"2010-03-30T01:00:00.000 Europe/London"}}}]},
{records:[{is_primary_sleep:!0,status:"asleep",start:12884796E5}],args:["Europe/London"],expected:[{start:1288458E6,end:1288548E6,duration:9E7,id:"2010-10-30T18:00:00.000 Europe/London",year:2010,month:9,day:29,activities:[{offset_start:.24,offset_time:.24,start:12884796E5,time:12884796E5,type:"start-unknown",index:0,record:{start:12884796E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-10-31T00:00:00.000 Europe/London",
first_start:"2010-10-31T00:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12884796E5,end:1288566E6}],args:["Europe/London"],expected:[{start:1288458E6,end:1288548E6,duration:9E7,id:"2010-10-30T18:00:00.000 Europe/London",year:2010,month:9,day:29,activities:[{start:12884796E5,time:12885138E5,end:1288548E6,offset_start:.24,offset_end:1,offset_time:.62,type:"start-mid",index:0,record:{start:12884796E5,end:1288566E6,duration:864E5,is_primary_sleep:!0,start_of_new_day:!0,
status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:684E5,last_start:"2010-10-31T00:00:00.000 Europe/London",first_start:"2010-10-31T00:00:00.000 Europe/London",first_end:"2010-10-31T18:00:00.000 Europe/London",last_end:"2010-10-31T18:00:00.000 Europe/London"}}},{start:1288548E6,end:12886344E5,duration:864E5,id:"2010-10-31T18:00:00.000 Europe/London",year:2010,month:9,day:30,activities:[{start:1288548E6,end:1288566E6,type:"mid-end",time:1288557E6,record:{is_primary_sleep:!0,status:"asleep",
start:12884796E5,end:1288566E6,duration:864E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:.20833333333333334,offset_time:.10416666666666667}],activity_summaries:{asleep:{duration:18E6,last_start:"2010-10-31T18:00:00.000 Europe/London",first_start:"2010-10-31T18:00:00.000 Europe/London",last_end:"2010-10-31T23:00:00.000 Europe/London",first_end:"2010-10-31T23:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12884796E5,end:12886524E5}],args:["Europe/London"],
expected:[{start:1288458E6,end:1288548E6,duration:9E7,id:"2010-10-30T18:00:00.000 Europe/London",year:2010,month:9,day:29,activities:[{start:12884796E5,time:12885138E5,end:1288548E6,offset_start:.24,offset_end:1,offset_time:.62,type:"start-mid",index:0,record:{start:12884796E5,end:12886524E5,duration:1728E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:684E5,last_start:"2010-10-31T00:00:00.000 Europe/London",first_start:"2010-10-31T00:00:00.000 Europe/London",
first_end:"2010-10-31T18:00:00.000 Europe/London",last_end:"2010-10-31T18:00:00.000 Europe/London"}}},{start:1288548E6,end:12886344E5,duration:864E5,id:"2010-10-31T18:00:00.000 Europe/London",year:2010,month:9,day:30,activities:[{start:1288548E6,end:12886344E5,type:"mid-mid",time:12885912E5,record:{is_primary_sleep:!0,status:"asleep",start:12884796E5,end:12886524E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:1,offset_time:.5}],activity_summaries:{asleep:{duration:864E5,
first_start:"2010-10-31T18:00:00.000 Europe/London",last_start:"2010-10-31T18:00:00.000 Europe/London",first_end:"2010-11-01T18:00:00.000 Europe/London",last_end:"2010-11-01T18:00:00.000 Europe/London"}}},{start:12886344E5,end:12887208E5,duration:864E5,id:"2010-11-01T18:00:00.000 Europe/London",year:2010,month:10,day:0,activities:[{start:12886344E5,end:12886524E5,type:"mid-end",time:12886434E5,record:{is_primary_sleep:!0,status:"asleep",start:12884796E5,end:12886524E5,duration:1728E5,start_of_new_day:!0,
day_number:2},index:2,offset_start:0,offset_end:.20833333333333334,offset_time:.10416666666666667}],activity_summaries:{asleep:{duration:18E6,first_start:"2010-11-01T18:00:00.000 Europe/London",last_start:"2010-11-01T18:00:00.000 Europe/London",first_end:"2010-11-01T23:00:00.000 Europe/London",last_end:"2010-11-01T23:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12937536E5}],args:["Europe/London"],expected:[{start:1293732E6,end:12938184E5,duration:864E5,id:"2010-12-30T18:00:00.000 Europe/London",
year:2010,month:11,day:29,activities:[{offset_start:.25,offset_time:.25,start:12937536E5,time:12937536E5,type:"start-unknown",index:0,record:{start:12937536E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-12-31T00:00:00.000 Europe/London",first_start:"2010-12-31T00:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12937536E5,end:129384E7}],args:["Europe/London"],expected:[{start:1293732E6,
end:12938184E5,duration:864E5,id:"2010-12-30T18:00:00.000 Europe/London",year:2010,month:11,day:29,activities:[{start:12937536E5,time:1293786E6,end:12938184E5,offset_start:.25,offset_end:1,offset_time:.625,type:"start-mid",index:0,record:{start:12937536E5,end:129384E7,duration:864E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:648E5,last_start:"2010-12-31T00:00:00.000 Europe/London",first_start:"2010-12-31T00:00:00.000 Europe/London",
first_end:"2010-12-31T18:00:00.000 Europe/London",last_end:"2010-12-31T18:00:00.000 Europe/London"}}},{start:12938184E5,end:12939048E5,duration:864E5,id:"2010-12-31T18:00:00.000 Europe/London",year:2010,month:11,day:30,activities:[{start:12938184E5,end:129384E7,type:"mid-end",time:12938292E5,record:{is_primary_sleep:!0,status:"asleep",start:12937536E5,end:129384E7,duration:864E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:.25,offset_time:.125}],activity_summaries:{asleep:{duration:216E5,
last_start:"2010-12-31T18:00:00.000 Europe/London",first_start:"2010-12-31T18:00:00.000 Europe/London",last_end:"2011-01-01T00:00:00.000 Europe/London",first_end:"2011-01-01T00:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12937536E5,end:12939264E5}],args:["Europe/London"],expected:[{start:1293732E6,end:12938184E5,duration:864E5,id:"2010-12-30T18:00:00.000 Europe/London",year:2010,month:11,day:29,activities:[{start:12937536E5,time:1293786E6,end:12938184E5,offset_start:.25,
offset_end:1,offset_time:.625,type:"start-mid",index:0,record:{start:12937536E5,end:12939264E5,duration:1728E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:648E5,last_start:"2010-12-31T00:00:00.000 Europe/London",first_start:"2010-12-31T00:00:00.000 Europe/London",first_end:"2010-12-31T18:00:00.000 Europe/London",last_end:"2010-12-31T18:00:00.000 Europe/London"}}},{start:12938184E5,end:12939048E5,duration:864E5,id:"2010-12-31T18:00:00.000 Europe/London",
year:2010,month:11,day:30,activities:[{start:12938184E5,end:12939048E5,type:"mid-mid",time:12938616E5,record:{is_primary_sleep:!0,status:"asleep",start:12937536E5,end:12939264E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:1,offset_start:0,offset_end:1,offset_time:.5}],activity_summaries:{asleep:{duration:864E5,first_start:"2010-12-31T18:00:00.000 Europe/London",last_start:"2010-12-31T18:00:00.000 Europe/London",first_end:"2011-01-01T18:00:00.000 Europe/London",last_end:"2011-01-01T18:00:00.000 Europe/London"}}},
{start:12939048E5,end:12939912E5,duration:864E5,id:"2011-01-01T18:00:00.000 Europe/London",year:2011,month:0,day:0,activities:[{start:12939048E5,end:12939264E5,type:"mid-end",time:12939156E5,record:{is_primary_sleep:!0,status:"asleep",start:12937536E5,end:12939264E5,duration:1728E5,start_of_new_day:!0,day_number:2},index:2,offset_start:0,offset_end:.25,offset_time:.125}],activity_summaries:{asleep:{duration:216E5,first_start:"2011-01-01T18:00:00.000 Europe/London",last_start:"2011-01-01T18:00:00.000 Europe/London",
first_end:"2011-01-02T00:00:00.000 Europe/London",last_end:"2011-01-02T00:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6}],args:["Etc/GMT",0],expected:[{start:1262304E6,end:12623904E5,duration:864E5,id:"2010-01-01T00:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:0,offset_time:0,start:1262304E6,time:1262304E6,type:"start-unknown",index:0,record:{start:1262304E6,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],
activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T00:00:00.000 Etc/GMT",first_start:"2010-01-01T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6}],args:["Etc/GMT-1",0],expected:[{start:12623004E5,end:12623868E5,duration:864E5,id:"2010-01-01T00:00:00.000 Etc/GMT-1",year:2010,month:0,day:0,activities:[{offset_start:.041666666666666664,offset_time:.041666666666666664,start:1262304E6,time:1262304E6,type:"start-unknown",index:0,record:{start:1262304E6,
is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T01:00:00.000 Etc/GMT-1",first_start:"2010-01-01T01:00:00.000 Etc/GMT-1"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6}],args:["Etc/GMT",0,36E5],expected:[{start:1262304E6,end:12623076E5,duration:36E5,id:"2010-01-01T00:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:0,offset_time:0,start:1262304E6,time:1262304E6,type:"start-unknown",
index:0,record:{start:1262304E6,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T00:00:00.000 Etc/GMT",first_start:"2010-01-01T00:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12623706E5}],args:["Etc/GMT",0,36E5],expected:[,,,,,,,,,,,,,,,,,,{start:12623688E5,end:12623724E5,duration:36E5,id:"2010-01-01T18:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:.5,offset_time:.5,
start:12623706E5,time:12623706E5,type:"start-unknown",index:0,record:{start:12623706E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T18:30:00.000 Etc/GMT",first_start:"2010-01-01T18:30:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1269738E6}],args:["Europe/London",54E5],expected:[,{start:12697362E5,end:1269819E6,duration:828E5,id:"2010-03-28T00:30:00.000 Europe/London",year:2010,month:2,
day:27,activities:[{offset_start:.021739130434782608,offset_time:.021739130434782608,start:1269738E6,time:1269738E6,type:"start-unknown",index:0,record:{start:1269738E6,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-03-28T02:00:00.000 Europe/London",first_start:"2010-03-28T02:00:00.000 Europe/London"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12623472E5}],args:["Etc/GMT",216E5],expected:[{start:12623256E5,
end:1262412E6,duration:864E5,id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:.25,offset_time:.25,start:12623472E5,time:12623472E5,type:"start-unknown",index:0,record:{start:12623472E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T12:00:00.000 Etc/GMT",first_start:"2010-01-01T12:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12623472E5}],args:["Etc/GMT",
648E5],expected:[{start:12622824E5,end:12623688E5,duration:864E5,id:"2009-12-31T18:00:00.000 Etc/GMT",year:2009,month:11,day:30,activities:[{offset_start:.75,offset_time:.75,start:12623472E5,time:12623472E5,type:"start-unknown",index:0,record:{start:12623472E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T12:00:00.000 Etc/GMT",first_start:"2010-01-01T12:00:00.000 Etc/GMT"}}}]},{records:[{is_primary_sleep:!0,
status:"asleep",start:12623472E5}],args:["Etc/GMT",216E5,864E5,36E5],expected:[{start:12623256E5,end:1262412E6,duration:864E5,id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:.25,offset_time:.25,start:12623472E5,time:12623472E5,type:"start-unknown",index:0,record:{start:12623472E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T12:00:00.000 Etc/GMT",first_start:"2010-01-01T12:00:00.000 Etc/GMT"}},
segments:[{dst_state:"off",id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:6,minute:0,second:0},{dst_state:"off",id:"2010-01-01T07:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:7,minute:0,second:0},{dst_state:"off",id:"2010-01-01T08:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:8,minute:0,second:0},{dst_state:"off",id:"2010-01-01T09:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:9,minute:0,second:0},{dst_state:"off",id:"2010-01-01T10:00:00.000 Etc/GMT",year:2010,month:0,day:0,
hour:10,minute:0,second:0},{dst_state:"off",id:"2010-01-01T11:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:11,minute:0,second:0},{dst_state:"off",id:"2010-01-01T12:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:12,minute:0,second:0},{dst_state:"off",id:"2010-01-01T13:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:13,minute:0,second:0},{dst_state:"off",id:"2010-01-01T14:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:14,minute:0,second:0},{dst_state:"off",id:"2010-01-01T15:00:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:15,minute:0,second:0},{dst_state:"off",id:"2010-01-01T16:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:16,minute:0,second:0},{dst_state:"off",id:"2010-01-01T17:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:17,minute:0,second:0},{dst_state:"off",id:"2010-01-01T18:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:18,minute:0,second:0},{dst_state:"off",id:"2010-01-01T19:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:19,minute:0,second:0},{dst_state:"off",id:"2010-01-01T20:00:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:20,minute:0,second:0},{dst_state:"off",id:"2010-01-01T21:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:21,minute:0,second:0},{dst_state:"off",id:"2010-01-01T22:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:22,minute:0,second:0},{dst_state:"off",id:"2010-01-01T23:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:23,minute:0,second:0},{dst_state:"off",id:"2010-01-02T00:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:0,minute:0,second:0},{dst_state:"off",id:"2010-01-02T01:00:00.000 Etc/GMT",
year:2010,month:0,day:1,hour:1,minute:0,second:0},{dst_state:"off",id:"2010-01-02T02:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:2,minute:0,second:0},{dst_state:"off",id:"2010-01-02T03:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:3,minute:0,second:0},{dst_state:"off",id:"2010-01-02T04:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:4,minute:0,second:0},{dst_state:"off",id:"2010-01-02T05:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:5,minute:0,second:0}]}]},{records:[{is_primary_sleep:!0,
status:"asleep",start:12623472E5}],args:["Etc/GMT",216E5,864E5,18E5],expected:[{start:12623256E5,end:1262412E6,duration:864E5,id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:.25,offset_time:.25,start:12623472E5,time:12623472E5,type:"start-unknown",index:0,record:{start:12623472E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T12:00:00.000 Etc/GMT",first_start:"2010-01-01T12:00:00.000 Etc/GMT"}},
segments:[{dst_state:"off",id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:6,minute:0,second:0},{dst_state:"off",id:"2010-01-01T06:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:6,minute:30,second:0},{dst_state:"off",id:"2010-01-01T07:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:7,minute:0,second:0},{dst_state:"off",id:"2010-01-01T07:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:7,minute:30,second:0},{dst_state:"off",id:"2010-01-01T08:00:00.000 Etc/GMT",year:2010,month:0,day:0,
hour:8,minute:0,second:0},{dst_state:"off",id:"2010-01-01T08:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:8,minute:30,second:0},{dst_state:"off",id:"2010-01-01T09:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:9,minute:0,second:0},{dst_state:"off",id:"2010-01-01T09:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:9,minute:30,second:0},{dst_state:"off",id:"2010-01-01T10:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:10,minute:0,second:0},{dst_state:"off",id:"2010-01-01T10:30:00.000 Etc/GMT",year:2010,
month:0,day:0,hour:10,minute:30,second:0},{dst_state:"off",id:"2010-01-01T11:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:11,minute:0,second:0},{dst_state:"off",id:"2010-01-01T11:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:11,minute:30,second:0},{dst_state:"off",id:"2010-01-01T12:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:12,minute:0,second:0},{dst_state:"off",id:"2010-01-01T12:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:12,minute:30,second:0},{dst_state:"off",id:"2010-01-01T13:00:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:13,minute:0,second:0},{dst_state:"off",id:"2010-01-01T13:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:13,minute:30,second:0},{dst_state:"off",id:"2010-01-01T14:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:14,minute:0,second:0},{dst_state:"off",id:"2010-01-01T14:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:14,minute:30,second:0},{dst_state:"off",id:"2010-01-01T15:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:15,minute:0,second:0},{dst_state:"off",id:"2010-01-01T15:30:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:15,minute:30,second:0},{dst_state:"off",id:"2010-01-01T16:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:16,minute:0,second:0},{dst_state:"off",id:"2010-01-01T16:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:16,minute:30,second:0},{dst_state:"off",id:"2010-01-01T17:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:17,minute:0,second:0},{dst_state:"off",id:"2010-01-01T17:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:17,minute:30,second:0},{dst_state:"off",id:"2010-01-01T18:00:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:18,minute:0,second:0},{dst_state:"off",id:"2010-01-01T18:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:18,minute:30,second:0},{dst_state:"off",id:"2010-01-01T19:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:19,minute:0,second:0},{dst_state:"off",id:"2010-01-01T19:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:19,minute:30,second:0},{dst_state:"off",id:"2010-01-01T20:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:20,minute:0,second:0},{dst_state:"off",id:"2010-01-01T20:30:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:20,minute:30,second:0},{dst_state:"off",id:"2010-01-01T21:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:21,minute:0,second:0},{dst_state:"off",id:"2010-01-01T21:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:21,minute:30,second:0},{dst_state:"off",id:"2010-01-01T22:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:22,minute:0,second:0},{dst_state:"off",id:"2010-01-01T22:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:22,minute:30,second:0},{dst_state:"off",id:"2010-01-01T23:00:00.000 Etc/GMT",
year:2010,month:0,day:0,hour:23,minute:0,second:0},{dst_state:"off",id:"2010-01-01T23:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:23,minute:30,second:0},{dst_state:"off",id:"2010-01-02T00:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:0,minute:0,second:0},{dst_state:"off",id:"2010-01-02T00:30:00.000 Etc/GMT",year:2010,month:0,day:1,hour:0,minute:30,second:0},{dst_state:"off",id:"2010-01-02T01:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:1,minute:0,second:0},{dst_state:"off",id:"2010-01-02T01:30:00.000 Etc/GMT",
year:2010,month:0,day:1,hour:1,minute:30,second:0},{dst_state:"off",id:"2010-01-02T02:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:2,minute:0,second:0},{dst_state:"off",id:"2010-01-02T02:30:00.000 Etc/GMT",year:2010,month:0,day:1,hour:2,minute:30,second:0},{dst_state:"off",id:"2010-01-02T03:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:3,minute:0,second:0},{dst_state:"off",id:"2010-01-02T03:30:00.000 Etc/GMT",year:2010,month:0,day:1,hour:3,minute:30,second:0},{dst_state:"off",id:"2010-01-02T04:00:00.000 Etc/GMT",
year:2010,month:0,day:1,hour:4,minute:0,second:0},{dst_state:"off",id:"2010-01-02T04:30:00.000 Etc/GMT",year:2010,month:0,day:1,hour:4,minute:30,second:0},{dst_state:"off",id:"2010-01-02T05:00:00.000 Etc/GMT",year:2010,month:0,day:1,hour:5,minute:0,second:0},{dst_state:"off",id:"2010-01-02T05:30:00.000 Etc/GMT",year:2010,month:0,day:1,hour:5,minute:30,second:0}]}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12623472E5}],args:["Etc/GMT",216E5,864E5,432E5],expected:[{start:12623256E5,end:1262412E6,
duration:864E5,id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:.25,offset_time:.25,start:12623472E5,time:12623472E5,type:"start-unknown",index:0,record:{start:12623472E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T12:00:00.000 Etc/GMT",first_start:"2010-01-01T12:00:00.000 Etc/GMT"}},segments:[{dst_state:"off",id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,
hour:6,minute:0,second:0},{dst_state:"off",id:"2010-01-01T18:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:18,minute:0,second:0}]}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12623472E5}],args:["Etc/GMT",216E5,864E5,45E6],expected:[{start:12623256E5,end:1262412E6,duration:864E5,id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,activities:[{offset_start:.25,offset_time:.25,start:12623472E5,time:12623472E5,type:"start-unknown",index:0,record:{start:12623472E5,is_primary_sleep:!0,
start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T12:00:00.000 Etc/GMT",first_start:"2010-01-01T12:00:00.000 Etc/GMT"}},segments:[{dst_state:"off",id:"2010-01-01T06:00:00.000 Etc/GMT",year:2010,month:0,day:0,hour:6,minute:0,second:0},{dst_state:"off",id:"2010-01-01T18:30:00.000 Etc/GMT",year:2010,month:0,day:0,hour:18,minute:30,second:0}]}]},{records:[{is_primary_sleep:!0,status:"asleep",start:12697344E5}],args:["Europe/London",432E5,
864E5,36E5],expected:[{start:12696912E5,end:1269774E6,duration:828E5,id:"2010-03-27T12:00:00.000 Europe/London",year:2010,month:2,day:26,activities:[{offset_start:.5217391304347826,offset_time:.5217391304347826,start:12697344E5,time:12697344E5,type:"start-unknown",index:0,record:{start:12697344E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-03-28T00:00:00.000 Europe/London",first_start:"2010-03-28T00:00:00.000 Europe/London"}},
segments:[{dst_state:"off",id:"2010-03-27T12:00:00.000 Europe/London",year:2010,month:2,day:26,hour:12,minute:0,second:0},{dst_state:"off",id:"2010-03-27T13:00:00.000 Europe/London",year:2010,month:2,day:26,hour:13,minute:0,second:0},{dst_state:"off",id:"2010-03-27T14:00:00.000 Europe/London",year:2010,month:2,day:26,hour:14,minute:0,second:0},{dst_state:"off",id:"2010-03-27T15:00:00.000 Europe/London",year:2010,month:2,day:26,hour:15,minute:0,second:0},{dst_state:"off",id:"2010-03-27T16:00:00.000 Europe/London",
year:2010,month:2,day:26,hour:16,minute:0,second:0},{dst_state:"off",id:"2010-03-27T17:00:00.000 Europe/London",year:2010,month:2,day:26,hour:17,minute:0,second:0},{dst_state:"off",id:"2010-03-27T18:00:00.000 Europe/London",year:2010,month:2,day:26,hour:18,minute:0,second:0},{dst_state:"off",id:"2010-03-27T19:00:00.000 Europe/London",year:2010,month:2,day:26,hour:19,minute:0,second:0},{dst_state:"off",id:"2010-03-27T20:00:00.000 Europe/London",year:2010,month:2,day:26,hour:20,minute:0,second:0},{dst_state:"off",
id:"2010-03-27T21:00:00.000 Europe/London",year:2010,month:2,day:26,hour:21,minute:0,second:0},{dst_state:"off",id:"2010-03-27T22:00:00.000 Europe/London",year:2010,month:2,day:26,hour:22,minute:0,second:0},{dst_state:"off",id:"2010-03-27T23:00:00.000 Europe/London",year:2010,month:2,day:26,hour:23,minute:0,second:0},{dst_state:"change-forward",id:"2010-03-28T00:00:00.000 Europe/London",year:2010,month:2,day:27,hour:0,minute:0,second:0},{dst_state:"on",id:"2010-03-28T02:00:00.000 Europe/London",year:2010,
month:2,day:27,hour:2,minute:0,second:0},{dst_state:"on",id:"2010-03-28T03:00:00.000 Europe/London",year:2010,month:2,day:27,hour:3,minute:0,second:0},{dst_state:"on",id:"2010-03-28T04:00:00.000 Europe/London",year:2010,month:2,day:27,hour:4,minute:0,second:0},{dst_state:"on",id:"2010-03-28T05:00:00.000 Europe/London",year:2010,month:2,day:27,hour:5,minute:0,second:0},{dst_state:"on",id:"2010-03-28T06:00:00.000 Europe/London",year:2010,month:2,day:27,hour:6,minute:0,second:0},{dst_state:"on",id:"2010-03-28T07:00:00.000 Europe/London",
year:2010,month:2,day:27,hour:7,minute:0,second:0},{dst_state:"on",id:"2010-03-28T08:00:00.000 Europe/London",year:2010,month:2,day:27,hour:8,minute:0,second:0},{dst_state:"on",id:"2010-03-28T09:00:00.000 Europe/London",year:2010,month:2,day:27,hour:9,minute:0,second:0},{dst_state:"on",id:"2010-03-28T10:00:00.000 Europe/London",year:2010,month:2,day:27,hour:10,minute:0,second:0},{dst_state:"on",id:"2010-03-28T11:00:00.000 Europe/London",year:2010,month:2,day:27,hour:11,minute:0,second:0}]}]},{records:[{is_primary_sleep:!0,
status:"asleep",start:12884796E5}],args:["Europe/London",432E5,864E5,36E5],expected:[{start:12884364E5,end:12885264E5,duration:9E7,id:"2010-10-30T12:00:00.000 Europe/London",year:2010,month:9,day:29,activities:[{offset_start:.48,offset_time:.48,start:12884796E5,time:12884796E5,type:"start-unknown",index:0,record:{start:12884796E5,is_primary_sleep:!0,start_of_new_day:!0,status:"asleep",day_number:2}}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-10-31T00:00:00.000 Europe/London",first_start:"2010-10-31T00:00:00.000 Europe/London"}},
segments:[{dst_state:"on",id:"2010-10-30T12:00:00.000 Europe/London",year:2010,month:9,day:29,hour:12,minute:0,second:0},{dst_state:"on",id:"2010-10-30T13:00:00.000 Europe/London",year:2010,month:9,day:29,hour:13,minute:0,second:0},{dst_state:"on",id:"2010-10-30T14:00:00.000 Europe/London",year:2010,month:9,day:29,hour:14,minute:0,second:0},{dst_state:"on",id:"2010-10-30T15:00:00.000 Europe/London",year:2010,month:9,day:29,hour:15,minute:0,second:0},{dst_state:"on",id:"2010-10-30T16:00:00.000 Europe/London",
year:2010,month:9,day:29,hour:16,minute:0,second:0},{dst_state:"on",id:"2010-10-30T17:00:00.000 Europe/London",year:2010,month:9,day:29,hour:17,minute:0,second:0},{dst_state:"on",id:"2010-10-30T18:00:00.000 Europe/London",year:2010,month:9,day:29,hour:18,minute:0,second:0},{dst_state:"on",id:"2010-10-30T19:00:00.000 Europe/London",year:2010,month:9,day:29,hour:19,minute:0,second:0},{dst_state:"on",id:"2010-10-30T20:00:00.000 Europe/London",year:2010,month:9,day:29,hour:20,minute:0,second:0},{dst_state:"on",
id:"2010-10-30T21:00:00.000 Europe/London",year:2010,month:9,day:29,hour:21,minute:0,second:0},{dst_state:"on",id:"2010-10-30T22:00:00.000 Europe/London",year:2010,month:9,day:29,hour:22,minute:0,second:0},{dst_state:"on",id:"2010-10-30T23:00:00.000 Europe/London",year:2010,month:9,day:29,hour:23,minute:0,second:0},{dst_state:"on",id:"2010-10-31T00:00:00.000 Europe/London",year:2010,month:9,day:30,hour:0,minute:0,second:0},{dst_state:"change-back",id:"2010-10-31T01:00:00.000 Europe/London",year:2010,
month:9,day:30,hour:1,minute:0,second:0},{dst_state:"off",id:"2010-10-31T01:00:00.000 Europe/London",year:2010,month:9,day:30,hour:1,minute:0,second:0},{dst_state:"off",id:"2010-10-31T02:00:00.000 Europe/London",year:2010,month:9,day:30,hour:2,minute:0,second:0},{dst_state:"off",id:"2010-10-31T03:00:00.000 Europe/London",year:2010,month:9,day:30,hour:3,minute:0,second:0},{dst_state:"off",id:"2010-10-31T04:00:00.000 Europe/London",year:2010,month:9,day:30,hour:4,minute:0,second:0},{dst_state:"off",
id:"2010-10-31T05:00:00.000 Europe/London",year:2010,month:9,day:30,hour:5,minute:0,second:0},{dst_state:"off",id:"2010-10-31T06:00:00.000 Europe/London",year:2010,month:9,day:30,hour:6,minute:0,second:0},{dst_state:"off",id:"2010-10-31T07:00:00.000 Europe/London",year:2010,month:9,day:30,hour:7,minute:0,second:0},{dst_state:"off",id:"2010-10-31T08:00:00.000 Europe/London",year:2010,month:9,day:30,hour:8,minute:0,second:0},{dst_state:"off",id:"2010-10-31T09:00:00.000 Europe/London",year:2010,month:9,
day:30,hour:9,minute:0,second:0},{dst_state:"off",id:"2010-10-31T10:00:00.000 Europe/London",year:2010,month:9,day:30,hour:10,minute:0,second:0},{dst_state:"off",id:"2010-10-31T11:00:00.000 Europe/London",year:2010,month:9,day:30,hour:11,minute:0,second:0}]}]},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6},{is_primary_sleep:!0,status:"asleep",start:12623904E5}],args:["Europe/London",0,36E5],expected:[{start:1262304E6,end:12623076E5,duration:36E5,id:"2010-01-01T00:00:00.000 Europe/London",
year:2010,month:0,day:0,activities:[{start:1262304E6,type:"start-unknown",time:1262304E6,record:{is_primary_sleep:!0,status:"asleep",start:1262304E6,start_of_new_day:!0,day_number:2,missing_record_after:!0},index:0,offset_start:0,offset_time:0}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-01T00:00:00.000 Europe/London",first_start:"2010-01-01T00:00:00.000 Europe/London"}}},,,,,,,,,,,,,,,,,,,,,,,,{start:12623904E5,end:1262394E6,duration:36E5,id:"2010-01-02T00:00:00.000 Europe/London",
year:2010,month:0,day:1,activities:[{start:12623904E5,type:"start-unknown",time:12623904E5,record:{is_primary_sleep:!0,status:"asleep",start:12623904E5,start_of_new_day:!0,day_number:3},index:0,offset_start:0,offset_time:0}],activity_summaries:{asleep:{duration:NaN,last_start:"2010-01-02T00:00:00.000 Europe/London",first_start:"2010-01-02T00:00:00.000 Europe/London"}}}]}].forEach(function(b){try{var c=I(a({file_format:"Standard",records:b.records}));expect(c.daily_activities.apply(c,b.args)).toEqual(b.expected)}catch(g){throw console.error(g),
g;}})});it("calculates the correct total per day",function(){[{records:[],args:[],expected:null},{records:[{day_number:0}],args:[],expected:null},{records:[{day_number:0},{day_number:1}],args:[],expected:null},{records:[{day_number:0},{day_number:1},{day_number:2}],args:[],expected:{average:1,mean:1,interquartile_mean:1,median:1,interquartile_range:0,durations:[1],interquartile_durations:[1],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[void 0],rolling_average:[void 0]}},{records:[{day_number:0},
{day_number:1},{day_number:1},{day_number:1},{day_number:2}],args:[],expected:{average:3,mean:3,interquartile_mean:3,median:3,interquartile_range:0,durations:[3],interquartile_durations:[3],standard_deviation:0,interquartile_standard_deviation:0,timestamps:[void 0],rolling_average:[void 0]}}].forEach(function(b){try{var c=I(a({file_format:"Standard",records:b.records}));expect(c.total_per_day.apply(c,b.args)).toEqual(b.expected)}catch(g){throw console.error(g),g;}})});it("calculates the correct daily summary",
function(){[{records:[],args:[],expected:null},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6,day_number:0}],args:[],expected:null},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6,day_number:0},{is_primary_sleep:!0,status:"asleep",start:12623904E5,day_number:1}],args:[],expected:null},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6,day_number:0},{is_primary_sleep:!0,status:"asleep",start:12623904E5,day_number:1},{is_primary_sleep:!0,status:"asleep",start:12624768E5,
day_number:2}],args:[],expected:null},{records:[{is_primary_sleep:!0,status:"asleep",start:1262304E6,day_number:0},{is_primary_sleep:!0,status:"asleep",start:12623904E5,day_number:1},{is_primary_sleep:!0,status:"asleep",start:12624768E5,day_number:2},{is_primary_sleep:!0,status:"asleep",start:12625632E5,day_number:3}],args:[],expected:{average:864E5,mean:864E5,interquartile_mean:864E5,median:864E5,interquartile_range:0,durations:[864E5],interquartile_durations:[864E5],standard_deviation:0,interquartile_standard_deviation:0,
timestamps:[12623904E5],rolling_average:[void 0]}}].forEach(function(b){try{var c=I(a({file_format:"Standard",records:b.records}));expect(c.summarise_days.apply(c,b.args)).toEqual(b.expected)}catch(g){throw console.error(g),g;}})});it("calculates the correct rolling average",function(){[{records:[{start:1,end:2},{start:2,end:3},{start:3,end:4},{start:4,end:5},{start:5,end:6},{start:6,end:7},{start:7,end:8},{start:8,end:9},{start:9,end:10},{start:10,end:11},{start:11,end:12},{start:12,end:13},{start:13,
end:14},{start:14,end:15},{start:15,end:16},{start:16,end:17},{start:17,end:18},{start:18,end:19},{start:19,end:20},{start:20,end:22},{start:21,end:23},{start:22,end:24},{start:23,end:25},{start:24,end:26},{start:25,end:27},{start:26,end:28},{start:27,end:29},{start:28,end:30},{start:29,end:31},{start:30,end:32},{start:31,end:33},{start:32,end:34},{start:33,end:35},{start:34,end:36},{start:35,end:37},{start:36,end:38},{start:37,end:39},{start:38,end:40},{start:39,end:41}],args:[],expected:{average:1.5128205128205128,
mean:1.5128205128205128,interquartile_mean:1.5263157894736843,median:2,interquartile_range:1,durations:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],interquartile_durations:[1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2],standard_deviation:.4998356074261009,interquartile_standard_deviation:.49930699897395464,timestamps:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],rolling_average:[void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,1,1,1,1,15/14,16/14,17/14,18/14,19/14,20/14,1.5,22/14,23/14,24/14,25/14,26/14,27/14,2,2,2,2,2,2,2]}}].forEach(function(b){try{var c=I(a({file_format:"Standard",records:b.records}));expect(c.summarise_records.apply(c,b.args)).toEqual(b.expected)}catch(g){throw console.error(g),g;}})})});fb("Sleepmeter",function(a,b,c){switch(c.name){case "ActivityLog":case "SleepChart1":case "PleesTracker":case "SpreadsheetGraph":case "SpreadsheetTable":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["start_timezone","end_timezone","duration","tags"].forEach(function(d){delete f[d]})})})}switch(c.name){case "ActivityLog":case "SleepChart1":case "PleesTracker":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["comments"].forEach(function(d){delete f[d]})})})}});
describe("Sleepmeter format",function(){X({i:"Sleepmeter",name:"simple diary from README.md",input:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',g:{custom_aids:[],custom_hindrances:[],custom_tags:[],records:[{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,
month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});X({i:"Sleepmeter",name:"complex diary from README.md",input:'custom_aid_id,class,name\nCUSTOM_0002,RELAXATION,"custom aid 2"\nCUSTOM_0003,EXERTION,"custom aid 3"\nCUSTOM_0001,HERBAL,"custom aid 1"\n\ncustom_hindrance_id,class,name\nCUSTOM_0003,OBLIGATION,"custom hindrance 3"\nCUSTOM_0002,MENTAL,"custom hindrance 2"\nCUSTOM_0001,NOISE,"custom hindrance 1"\n\ncustom_tag_id,name\nCUSTOM_0001,"custom tag 1"\nCUSTOM_0002,"custom tag 2"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2099-12-31 23:59+1000","2099-12-31 23:58+1000","2099-12-31 23:57+1000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,""\n"1900-01-02 00:00+0000","1900-01-01 00:02+0000","1900-01-01 00:01+0000",1-57|1436-1437,NAP,NONE,NONE,NONE,NONE,5,"comment"\n',
g:{custom_aids:[{custom_aid_id:"CUSTOM_0002","class":"RELAXATION",name:"custom aid 2"},{custom_aid_id:"CUSTOM_0003","class":"EXERTION",name:"custom aid 3"},{custom_aid_id:"CUSTOM_0001","class":"HERBAL",name:"custom aid 1"}],custom_hindrances:[{custom_hindrance_id:"CUSTOM_0003","class":"OBLIGATION",name:"custom hindrance 3"},{custom_hindrance_id:"CUSTOM_0002","class":"MENTAL",name:"custom hindrance 2"},{custom_hindrance_id:"CUSTOM_0001","class":"NOISE",name:"custom hindrance 1"}],custom_tags:[{custom_tag_id:"CUSTOM_0001",
name:"custom tag 1"},{custom_tag_id:"CUSTOM_0002",name:"custom tag 2"}],records:[{start:410240862E4,end:410240874E4,wake:{string:'"2099-12-31 23:59+1000"',year:2099,month:12,day:31,hour:23,minute:59,offset:600},sleep:{string:'"2099-12-31 23:58+1000"',year:2099,month:12,day:31,hour:23,minute:58,offset:600},bedtime:{string:'"2099-12-31 23:57+1000"',year:2099,month:12,day:31,hour:23,minute:57,offset:600},duration:6E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:["CUSTOM_0001"],hindrances:["CUSTOM_0001"],
tags:["CUSTOM_0001"],quality:5,notes:""},{end:-22089024E5,wake:{string:'"1900-01-02 00:00+0000"',year:1900,month:1,day:2,hour:0,minute:0,offset:0},sleep:{string:'"1900-01-01 00:02+0000"',year:1900,month:1,day:1,hour:0,minute:2,offset:0},start:-220898874E4,bedtime:{string:'"1900-01-01 00:01+0000"',year:1900,month:1,day:1,hour:0,minute:1,offset:0},duration:86280057,holes:[{wake:1,sleep:57},{wake:1436,sleep:1437}],type:"NAP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:"comment"}]}});X({i:"Sleepmeter",
name:"multi-line strings",input:'custom_aid_id,class,name\nCUSTOM_0001,HERBAL,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_tag_id,name\nCUSTOM_0001,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2099-12-31 23:57+1000","2099-12-31 23:58+1000","2099-12-31 23:59+1000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n',
g:{custom_aids:[{custom_aid_id:"CUSTOM_0001","class":"HERBAL",name:',", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): '}],
custom_hindrances:[{custom_hindrance_id:"CUSTOM_0001","class":"NOISE",name:',", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): '}],
custom_tags:[{custom_tag_id:"CUSTOM_0001",name:',", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): '}],records:[{end:410240862E4,
wake:{string:'"2099-12-31 23:57+1000"',year:2099,month:12,day:31,hour:23,minute:57,offset:600},sleep:{string:'"2099-12-31 23:58+1000"',year:2099,month:12,day:31,hour:23,minute:58,offset:600},start:410240874E4,bedtime:{string:'"2099-12-31 23:59+1000"',year:2099,month:12,day:31,hour:23,minute:59,offset:600},duration:-6E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:["CUSTOM_0001"],hindrances:["CUSTOM_0001"],tags:["CUSTOM_0001"],quality:5,notes:',", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): '}]}});
Y({name:"output test",format:"output",input:'custom_aid_id,class,name\nCUSTOM_0001,HERBAL,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_tag_id,name\nCUSTOM_0001,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2099-12-31 23:57+1000","2099-12-31 23:58+1000","2099-12-31 23:59+1000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n',
g:'custom_aid_id,class,name\nCUSTOM_0001,HERBAL,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_tag_id,name\nCUSTOM_0001,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2099-12-31 23:57+1000","2099-12-31 23:58+1000","2099-12-31 23:59+1000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n'});
Z({name:"two empty diaries",left:"wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n",right:"wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n",g:{custom_aids:[],custom_hindrances:[],custom_tags:[],records:[]}});Z({name:"right empty, left non-empty",left:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',right:"wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n",
g:{custom_aids:[],custom_hindrances:[],custom_tags:[],records:[{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},holes:[],duration:-732E4,type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"left empty, right non-empty",
left:"wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n",right:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',g:{custom_aids:[],custom_hindrances:[],custom_tags:[],records:[{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,
day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty",left:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',right:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
g:{custom_aids:[],custom_hindrances:[],custom_tags:[],records:[{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (2)",
left:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',right:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',g:{custom_aids:[],custom_hindrances:[],custom_tags:[],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',
year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',
year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (3)",left:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
right:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',g:{custom_aids:[{custom_aid_id:"CUSTOM_0001","class":"RELAXATION",name:"value 1"}],custom_hindrances:[],custom_tags:[],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',
year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',
year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (4)",left:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',right:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 2"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
g:{custom_aids:[{custom_aid_id:"CUSTOM_0001","class":"RELAXATION",name:"value 1"},{custom_aid_id:"CUSTOM_0002","class":"RELAXATION",name:"value 2"}],custom_hindrances:[],custom_tags:[],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,
offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],
tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (5)",left:'custom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',right:'custom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
g:{custom_aids:[],custom_hindrances:[{custom_hindrance_id:"CUSTOM_0001","class":"NOISE",name:"value 1"}],custom_tags:[],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],
hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (6)",left:'custom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
right:'custom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 2"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',g:{custom_aids:[],custom_hindrances:[{custom_hindrance_id:"CUSTOM_0001","class":"NOISE",name:"value 1"},{custom_hindrance_id:"CUSTOM_0002","class":"NOISE",name:"value 2"}],custom_tags:[],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',
year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',
year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (7)",left:'custom_tag_id,name\nCUSTOM_0001,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
right:'custom_tag_id,name\nCUSTOM_0001,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',g:{custom_aids:[],custom_hindrances:[],custom_tags:[{custom_tag_id:"CUSTOM_0001",name:"value 1"}],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,
month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',
year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (8)",left:'custom_tag_id,name\nCUSTOM_0001,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',right:'custom_tag_id,name\nCUSTOM_0001,"value 2"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,NONE,NONE,NONE,5,""\n',
g:{custom_aids:[],custom_hindrances:[],custom_tags:[{custom_tag_id:"CUSTOM_0001",name:"value 1"},{custom_tag_id:"CUSTOM_0002",name:"value 2"}],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',year:2010,month:11,day:12,hour:13,minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",
dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:[],hindrances:[],tags:[],quality:5,notes:""}]}});Z({name:"both non-empty (9)",
left:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 1"\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 1"\n\ncustom_tag_id,name\nCUSTOM_0001,"value 1"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,""\n',right:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 2"\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 2"\n\ncustom_tag_id,name\nCUSTOM_0001,"value 2"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:14+0000","2010-11-12 15:16+0000","2010-11-12 17:18+0000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,""\n',
g:{custom_aids:[{custom_aid_id:"CUSTOM_0001","class":"RELAXATION",name:"value 1"},{custom_aid_id:"CUSTOM_0002","class":"RELAXATION",name:"value 2"}],custom_hindrances:[{custom_hindrance_id:"CUSTOM_0001","class":"NOISE",name:"value 1"},{custom_hindrance_id:"CUSTOM_0002","class":"NOISE",name:"value 2"}],custom_tags:[{custom_tag_id:"CUSTOM_0001",name:"value 1"},{custom_tag_id:"CUSTOM_0002",name:"value 2"}],records:[{end:12895677E5,wake:{string:'"2010-11-12 13:15+0000"',year:2010,month:11,day:12,hour:13,
minute:15,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-726E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:["CUSTOM_0001"],hindrances:["CUSTOM_0001"],tags:["CUSTOM_0001"],quality:5,notes:""},{end:128956764E4,wake:{string:'"2010-11-12 13:14+0000"',year:2010,month:11,day:12,hour:13,minute:14,offset:0},sleep:{string:'"2010-11-12 15:16+0000"',
year:2010,month:11,day:12,hour:15,minute:16,offset:0},start:128958228E4,bedtime:{string:'"2010-11-12 17:18+0000"',year:2010,month:11,day:12,hour:17,minute:18,offset:0},duration:-732E4,holes:[],type:"NIGHT_SLEEP",dreams:[],aids:["CUSTOM_0002"],hindrances:["CUSTOM_0002"],tags:["CUSTOM_0002"],quality:5,notes:""}]}});Y({name:"empty diary to Standard",format:"Standard",input:"wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n",g:[]});Y({name:"non-empty diary to Standard",format:"Standard",
input:'custom_aid_id,class,name\nCUSTOM_0001,RELAXATION,"value 1"\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,"value 2"\n\ncustom_tag_id,name\nCUSTOM_0001,"value 3"\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 17:18+0000","2010-11-12 15:16+0000","2010-11-12 13:14+0000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,""\n',g:[{status:"in bed",start:128956764E4,end:128957496E4,start_timezone:"Etc/GMT",end_timezone:"Etc/GMT",duration:732E4,start_of_new_day:!1,
day_number:0},{status:"asleep",start:128957496E4,end:128958228E4,start_timezone:"Etc/GMT",end_timezone:"Etc/GMT",tags:["value 1","value 2","value 3"],is_primary_sleep:!0,duration:732E4,start_of_new_day:!0,day_number:2}]});ib({name:"empty diary",format:"Sleepmeter",input:[],g:"wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"});ib({name:"non-empty diary",format:"Sleepmeter",input:[{status:"asleep",start:128957496E4,end:12895677E5,tags:["SOUND_MACHINE","BUNKMATE_SNORING","OUT_OF_TOWN"],
comments:[],is_primary_sleep:!0,duration:-726E4,start_of_new_day:!0,day_number:2},{status:"in bed",start:128958228E4,end:128957496E4,duration:-732E4,start_of_new_day:!1,day_number:2}],g:'wake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2010-11-12 13:15+0000","2010-11-12 15:16+0000","2010-11-12 15:16+0000",,NIGHT_SLEEP,NONE,SOUND_MACHINE,BUNKMATE_SNORING,OUT_OF_TOWN,5,""\n'})});fb("SleepAsAndroid",function(a,b,c){switch(c.name){case "ActivityLog":case "SleepChart1":case "PleesTracker":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["comments"].forEach(function(d){delete f[d]})})});case "SpreadsheetGraph":case "SpreadsheetTable":case "Sleepmeter":[a,b].forEach(function(g){g.records.forEach(function(f){["start_timezone","end_timezone"].forEach(function(d){delete f[d]})})})}});
describe("SleepAsAndroid format",function(){function a(f){return{file_format:function(){return"archive"},contents:f}}var b=a({"alarms.json":"[]","prefs.xml":"<?xml version='1.0' encoding='utf-8' standalone='yes' ?>\n<map></map>","sleep-export.csv":""}),c='<?xml version=\'1.0\' encoding=\'utf-8\' standalone=\'yes\' ?>\n<map>\n<boolean name="bool_value" value="false" />\n<string name="string_value"><![CDATA[my_string]]\x3e</string>\n<long name="long_value" value="'+Math.pow(2,31)+'" />\n<int name="int_value" value="0" />\n</map>\n',
g={bool_value:!1,string_value:"my_string",long_value:Math.pow(2,31),int_value:0};X({i:"SleepAsAndroid",name:"empty diary",input:b,s:"disable",g:{prefs:{},alarms:[],records:[]}});X({i:"SleepAsAndroid",name:"string diary",input:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',g:{alarms:[],prefs:{},
records:[{start:10440723E5,end:0xf317c6db70,alarm:104407962E4,duration:3661200,Id:"1044072300000",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,
Geo:"",times:[],events:[]}]}});X({i:"SleepAsAndroid",name:"object diary",input:a({"alarms.json":"[{}]","prefs.xml":c,"sleep-export.csv":'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n'}),g:{alarms:[{}],prefs:g,records:[{start:10440723E5,end:0xf317c6db70,alarm:104407962E4,duration:3661200,Id:"1044072300000",
Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[]}]}});X({i:"SleepAsAndroid",name:"string escapes",input:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","""Comment \\n ""text","10000","-1","-1.0","-1","-1.0","0",""\n',
g:{alarms:[],prefs:{},records:[{start:10440723E5,end:0xf317c6db70,alarm:104407962E4,duration:3661200,Id:"1044072300000",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:'"Comment\n"text',tags:[],notags:'"Comment\n"text'},Framerate:"10000",Snore:null,Noise:null,Cycles:null,
DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[]}]}});Y({name:"output test",format:"output",input:'custom_aid_id,class,name\nCUSTOM_0001,HERBAL,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_tag_id,name\nCUSTOM_0001,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2099-12-31 23:57+1000","2099-12-31 23:58+1000","2099-12-31 23:59+1000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n',
g:'custom_aid_id,class,name\nCUSTOM_0001,HERBAL,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_hindrance_id,class,name\nCUSTOM_0001,NOISE,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\ncustom_tag_id,name\nCUSTOM_0001,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n\nwake,sleep,bedtime,holes,type,dreams,aid,hindrances,tags,quality,notes\n"2099-12-31 23:57+1000","2099-12-31 23:58+1000","2099-12-31 23:59+1000",,NIGHT_SLEEP,NONE,CUSTOM_0001,CUSTOM_0001,CUSTOM_0001,5,",", <-- those the commas and quotation mark do not mark a field boundary.\nHere are some more things that are hard to parse:\n1. a quote at the end of a line (does not end the comment because the next line still looks like a comment): "\n2. a pair of blank lines (does not end the comment because the next line still looks like a comment):\n\n3. another quote at the end of a line (ends the comment because the next line looks like a header): "\n'});
Y({name:"output test",format:"output",input:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Etc/GMT","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","""Comment \\n ""text","10000","-1","-1.0","-1","-1.0","0",""\n',g:{"prefs.xml":"<?xml version='1.0' encoding='utf-8' standalone='yes' ?>\n<map>\n</map>\n","alarms.json":"[]","sleep-export.csv":'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Etc/GMT","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0","""Comment \\n ""text","10000","-1","-1.0","-1","-1.0","0",""\n'}});
Y({name:"standard format test 1",format:"Standard",input:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","""Comment \\n ""text","10000","-1","-1.0","-1","-1.0","0",""\n',g:[{status:"asleep",start:10440723E5,end:0xf317c6db70,start_timezone:"Europe/London",end_timezone:"Europe/London",comments:['"Comment\n"text'],duration:3661200,start_of_new_day:!0,
day_number:2,is_primary_sleep:!0}]});ib({name:"standard format test 2",format:"SleepAsAndroid",input:[{status:"asleep",start:10440723E5,end:0xf317c6db70,comments:['"Comment\n"text'],duration:3661200,start_of_new_day:!0,day_number:1,is_primary_sleep:!0}],g:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Etc/GMT","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 5:06","1.017","2.5","""Comment \\n ""text","10000","-1","-1.0","-1","-1.0","-1.0",""\n'});
Z({left:b,right:b,g:{prefs:{},alarms:[],records:[]}});Z({left:b,right:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',g:{prefs:{},alarms:[],records:[{Id:"1044072300000",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',
year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[],start:10440723E5,end:0xf317c6db70,duration:3661200,alarm:104407962E4}]}});Z({left:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',
right:b,g:{prefs:{},alarms:[],records:[{Id:"1044072300000",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[],start:10440723E5,
end:0xf317c6db70,duration:3661200,alarm:104407962E4}]}});Z({left:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',right:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',
g:{prefs:{},alarms:[],records:[{Id:"1044072300000",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[],start:10440723E5,
end:0xf317c6db70,duration:3661200,alarm:104407962E4}]}});Z({left:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"123456788","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',right:'Id,Tz,From,To,Sched,Hours,Rating,Comment,Framerate,Snore,Noise,Cycles,DeepSleep,LenAdjust,Geo\n"1044072300000","Europe/London","01. 02. 2003 4:05","01. 02. 2003 5:06","01. 02. 2003 6:07","1.017","0.0","Comment text","10000","-1","-1.0","-1","-1.0","0",""\n',
g:{prefs:{},alarms:[],records:[{Id:"123456788",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[],start:123456788,end:127117988,
duration:3661200,alarm:1308E5},{Id:"1044072300000",Tz:"Europe/London",From:{string:'"01. 02. 2003 4:05"',year:2003,month:2,day:1,hour:4,minute:5},To:{string:'"01. 02. 2003 5:06"',year:2003,month:2,day:1,hour:5,minute:6},Sched:{string:'"01. 02. 2003 6:07"',year:2003,month:2,day:1,hour:6,minute:7},Hours:1.017,Rating:0,Comment:{string:"Comment text",tags:[],notags:"Comment text"},Framerate:"10000",Snore:null,Noise:null,Cycles:null,DeepSleep:null,LenAdjust:0,Geo:"",times:[],events:[],start:10440723E5,
end:0xf317c6db70,duration:3661200,alarm:104407962E4}]}})});describe("PleesTracker format",function(){var a=[{sid:1,start:1608323029380,stop:1608323057541,rating:0},{sid:2,start:1608323062156,stop:1608323063678,rating:5},{sid:3,start:1608323066387,stop:1608323067794,rating:3}];X({i:"PleesTracker",name:"empty diary",input:"sid,start,stop,rating\n",g:{records:[]}});X({i:"PleesTracker",name:"simple diary",input:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",g:{records:a}});Y({name:"output test",
format:"output",input:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",g:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n"});Y({name:"standard format test",format:"Standard",input:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",g:[{status:"asleep",start:1608323029380,end:1608323057541,
duration:28161,start_of_new_day:!0,day_number:2,missing_record_after:!0,is_primary_sleep:!0},{status:"asleep",start:1608323062156,end:1608323063678,duration:1522,start_of_new_day:!1,day_number:2,missing_record_after:!0},{status:"asleep",start:1608323066387,end:1608323067794,duration:1407,start_of_new_day:!1,day_number:2}]});ib({name:"standard format test",format:"PleesTracker",input:[{status:"asleep",start:1608323029380,end:1608323057541,duration:28161,start_of_new_day:!0,day_number:2,missing_record_after:!0,
is_primary_sleep:!0},{status:"asleep",start:1608323062156,end:1608323063678,duration:1522,start_of_new_day:!1,day_number:2,missing_record_after:!0},{status:"asleep",start:1608323066387,end:1608323067794,duration:1407,start_of_new_day:!1,day_number:2}],g:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,0\n3,1608323066387,1608323067794,0\n"});Z({name:"two empty diaries",left:"sid,start,stop,rating\n",right:"sid,start,stop,rating\n",g:{records:[]}});Z({name:"left empty, right non-empty",
left:"sid,start,stop,rating\n",right:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",g:{records:a}});Z({name:"left non-empty, right empty",left:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",right:"sid,start,stop,rating\n",g:{records:a}});Z({name:"two identical diaries",left:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",
right:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",g:{records:a}});Z({name:"two different diaries",left:"sid,start,stop,rating\n1,1608323029380,1608323057541,0\n2,1608323062156,1608323063678,5\n3,1608323066387,1608323067794,3\n",right:"sid,start,stop,rating\n1,608323029380,608323057541,0\n2,608323062156,608323063678,5\n3,608323066387,608323067794,3\n",g:{records:a.concat([{start:608323029380,stop:608323057541,sid:4,rating:0},
{start:608323062156,stop:608323063678,sid:5,rating:5},{start:608323066387,stop:608323067794,sid:6,rating:3}])}})});fb("SleepChart1",function(a,b,c){switch(c.name){case "ActivityLog":case "PleesTracker":case "SpreadsheetGraph":case "SpreadsheetTable":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["tags"].forEach(function(d){delete f[d]})})})}});
describe("SleepChart1 format",function(){function a(g){return{file_format:function(){return"array"},contents:g}}function b(g){for(var f=new Float32Array(3*g.length),d=new Uint8Array(f.buffer),h=0;h!=g.length;++h){var e=g[h];f[3*h]=e[0];f[3*h+1]=e[1];d[12*h+8]=e[2]?255:0;d[12*h+9]=e[3]?255:0}return f.buffer}var c=a(b([]));X({i:"SleepChart1",name:"Empty diary",input:c,g:{records:[]}});X({i:"SleepChart1",name:"Simple diary 1",input:a(b([[1,2,!0,!0]])),g:{records:[{start:9466848E5,end:9467712E5,"delayed retirement":!1,
"forced awakening":!1}]}});X({i:"SleepChart1",name:"Simple diary 2",input:a(b([[2,3,!0,!1]])),g:{records:[{start:9467712E5,end:9468576E5,"delayed retirement":!0,"forced awakening":!1}]}});X({i:"SleepChart1",name:"Simple diary 3",input:a(b([[100,200,!1,!0]])),g:{records:[{start:9552384E5,end:9638784E5,"delayed retirement":!1,"forced awakening":!0}]}});X({i:"SleepChart1",name:"Multiple records",input:a(b([[1,2,!0,!0],[2,3,!0,!1],[100,200,!1,!0]])),g:{records:[{start:9466848E5,end:9467712E5,"delayed retirement":!1,
"forced awakening":!1},{start:9467712E5,end:9468576E5,"delayed retirement":!0,"forced awakening":!1},{start:9552384E5,end:9638784E5,"delayed retirement":!1,"forced awakening":!0}]}});Y({name:"Output test",format:"output",input:a(b([[1,2,!0,!0],[2,3,!0,!1],[100,200,!1,!0]])),g:b([[1,2,!0,!0],[2,3,!0,!1],[100,200,!1,!0]])});Y({name:"Standard Format test",format:"Standard",input:a(b([[1,2,!0,!0],[2,3,!0,!1],[100,200,!1,!0]])),g:[{status:"asleep",start:9466848E5,end:9467712E5,duration:864E5,start_of_new_day:!0,
day_number:2,missing_record_after:!0,is_primary_sleep:!0},{status:"asleep",start:9467712E5,end:9468576E5,tags:["delayed retirement"],duration:864E5,start_of_new_day:!0,day_number:3,missing_record_after:!0,is_primary_sleep:!0},{status:"asleep",start:9552384E5,end:9638784E5,tags:["forced awakening"],duration:864E7,start_of_new_day:!0,day_number:5,is_primary_sleep:!0}]});ib({name:"Standard Format test",format:"SleepChart1",input:[{status:"asleep",start:9466848E5,end:9467712E5,duration:864E5,start_of_new_day:!0,
day_number:2,missing_record_after:!0,is_primary_sleep:!0},{status:"asleep",start:9467712E5,end:9468576E5,tags:["delayed retirement"],duration:864E5,start_of_new_day:!0,day_number:3,missing_record_after:!0,is_primary_sleep:!0},{status:"asleep",start:9552384E5,end:9638784E5,tags:["forced awakening"],duration:864E7,start_of_new_day:!0,day_number:5,is_primary_sleep:!0}],g:a(b([[1,2,!0,!0],[2,3,!0,!1],[100,200,!1,!0]]))});Z({name:"Two identical diaries",left:a(b([[1,2,!0,!0]])),right:a(b([[1,2,!0,!0]])),
g:{records:[{start:9466848E5,end:9467712E5,"delayed retirement":!1,"forced awakening":!1}]}});Z({name:"Two different diaries",left:a(b([[1,2,!0,!0]])),right:a(b([[100,200,!1,!0]])),g:{records:[{start:9466848E5,end:9467712E5,"delayed retirement":!1,"forced awakening":!1},{start:9552384E5,end:9638784E5,"delayed retirement":!1,"forced awakening":!0}]}});Z({name:"Two different diaries (reverse order)",left:a(b([[100,200,!1,!0]])),right:a(b([[1,2,!0,!0]])),g:{records:[{start:9466848E5,end:9467712E5,"delayed retirement":!1,
"forced awakening":!1},{start:9552384E5,end:9638784E5,"delayed retirement":!1,"forced awakening":!0}]}});Z({name:"Two different diaries (overlapping)",left:a(b([[1,3,!0,!0]])),right:a(b([[2,4,!0,!0]])),g:{records:[{start:9466848E5,end:9468576E5,"delayed retirement":!1,"forced awakening":!1}]}})});describe("ActivityLog format",function(){X({i:"ActivityLog",name:"Empty diary",input:"ActivityStart,ActivityEnd\n",g:{records:[],activities:[],settings:[]}});X({i:"ActivityLog",name:"Simple diary",input:"ActivityStart,ActivityEnd\n12345678,23456789",g:{records:[{status:"awake",start:12345678E5,end:23456789E5}],activities:[{ActivityStart:12345678E5,ActivityEnd:23456789E5}],settings:[]}});X({i:"ActivityLog",name:"Diary with gaps",input:[["ActivityStart","ActivityEnd"],[1E12,11E11],[11001152E5,12E11],
[1200000000100,13E11],[14E11,140001E7],[1400010060100,140002E7]].map(function(a){return a.join()}).join("\n"),g:{records:[{status:"awake",start:1E12,end:11E11},{status:"awake",start:11001152E5,end:13E11},{status:"awake",start:14E11,end:140002E7}],activities:[{ActivityStart:1E12,ActivityEnd:11E11},{ActivityStart:11001152E5,ActivityEnd:13E11},{ActivityStart:14E11,ActivityEnd:140001E7},{ActivityStart:1400010060100,ActivityEnd:140002E7}],settings:[]}});X({i:"ActivityLog",name:"Diary with sleeps",input:[["ActivityStart",
"ActivityEnd"],[0xe8d4a51064,0xe8d881d5c8],[0xe8d9cb6d2c,0xe8dda83290],[0xe8def1c9f4,0xe8e2ce8f58],[0xe8e41826bc,0xe8e7f4ec20]].map(function(a){return a.join()}).join("\n"),g:{records:[{status:"awake",start:0xe8d4a51064,end:0xe8d881d5c8},{status:"asleep",start:0xe8d881d5c9,end:0xe8d9cb6d2b},{status:"awake",start:0xe8d9cb6d2c,end:0xe8dda83290},{status:"asleep",start:0xe8dda83291,end:0xe8def1c9f3},{status:"awake",start:0xe8def1c9f4,end:0xe8e2ce8f58},{status:"asleep",start:0xe8e2ce8f59,end:0xe8e41826bb},
{status:"awake",start:0xe8e41826bc,end:0xe8e7f4ec20}],activities:[{ActivityStart:0xe8d4a51064,ActivityEnd:0xe8d881d5c8},{ActivityStart:0xe8d9cb6d2c,ActivityEnd:0xe8dda83290},{ActivityStart:0xe8def1c9f4,ActivityEnd:0xe8e2ce8f58},{ActivityStart:0xe8e41826bc,ActivityEnd:0xe8e7f4ec20}],settings:[]}});X({i:"ActivityLog",name:"Diary with sleeps and maximum_day_length_ms",input:[["maximum_day_length_ms=172800000"],["ActivityStart","ActivityEnd"],[0xe8d4a51064,0xe8d881d5c8],[0xe8d9cb6d2c,0xe8dda83290],[0xe8def1c9f4,
0xe8e2ce8f58],[0xe8e41826bc,0xe8e7f4ec20]].map(function(a){return a.join()}).join("\n"),g:{records:[{status:"awake",start:0xe8d4a51064,end:0xe8d881d5c8},{status:"asleep",start:0xe8d881d5c9,end:0xe8d9cb6d2b},{status:"awake",start:0xe8d9cb6d2c,end:0xe8dda83290},{status:"asleep",start:0xe8dda83291,end:0xe8def1c9f3},{status:"awake",start:0xe8def1c9f4,end:0xe8e7f4ec20}],activities:[{ActivityStart:0xe8d4a51064,ActivityEnd:0xe8d881d5c8},{ActivityStart:0xe8d9cb6d2c,ActivityEnd:0xe8dda83290},{ActivityStart:0xe8def1c9f4,
ActivityEnd:0xe8e2ce8f58},{ActivityStart:0xe8e41826bc,ActivityEnd:0xe8e7f4ec20}],settings:[{Setting:"maximum_day_length_ms",Value:1728E5}]}});Y({name:"Output test",format:"output",input:[["maximum_day_length_ms=172800000"],["ActivityStart","ActivityEnd"],[0xe8d4a51064,0xe8d881d5c8]].map(function(a){return a.join()}).join("\n"),g:"maximum_day_length_ms=172800000\nActivityStart,ActivityEnd\n2001-09-09T01:46:40.100Z,2001-09-09T19:46:40.200Z\n"});Y({name:"Standard Format test",format:"Standard",input:[["maximum_day_length_ms=172800000"],
["ActivityStart","ActivityEnd"],[0xe8d4a51064,0xe8d881d5c8]].map(function(a){return a.join()}).join("\n"),g:[{start:0xe8d4a51064,end:0xe8d881d5c8,status:"awake",duration:64800100,start_of_new_day:!1,day_number:0}]});Z({name:"Two empty diaries",left:"ActivityStart,ActivityEnd\n",right:"ActivityStart,ActivityEnd\n",g:{activities:[],settings:[],records:[]}});Z({name:"Left empty, right non-empty",left:"ActivityStart,ActivityEnd\n",right:"ActivityStart,ActivityEnd\n12345678,23456789",g:{records:[{status:"awake",
start:12345678E5,end:23456789E5}],activities:[{ActivityStart:12345678E5,ActivityEnd:23456789E5}],settings:[]}});Z({name:"Left non-empty, right empty",left:"ActivityStart,ActivityEnd\n12345678,23456789",right:"ActivityStart,ActivityEnd\n",g:{records:[{status:"awake",start:12345678E5,end:23456789E5}],activities:[{ActivityStart:12345678E5,ActivityEnd:23456789E5}],settings:[]}});Z({name:"Two identical diaries",left:"ActivityStart,ActivityEnd\n12345678,23456789",right:"ActivityStart,ActivityEnd\n12345678,23456789",
g:{records:[{status:"awake",start:12345678E5,end:23456789E5}],activities:[{ActivityStart:12345678E5,ActivityEnd:23456789E5}],settings:[]}});Z({name:"Two different diaries",left:"ActivityStart,ActivityEnd\n12345678,12345876",right:"ActivityStart,ActivityEnd\n23456789,23456987",g:{records:[{status:"awake",start:12345678E5,end:12345876E5},{status:"awake",start:23456789E5,end:23456987E5}],activities:[{ActivityStart:12345678E5,ActivityEnd:12345876E5},{ActivityStart:23456789E5,ActivityEnd:23456987E5}],
settings:[]}});Z({name:"Two different diaries",left:"ActivityStart,ActivityEnd\n12345678,12345876\n23456789,23456987",right:"ActivityStart,ActivityEnd\n12345976,12345999",g:{records:[{status:"awake",start:12345678E5,end:12345999E5},{status:"awake",start:23456789E5,end:23456987E5}],activities:[{ActivityStart:12345678E5,ActivityEnd:12345876E5},{ActivityStart:12345976E5,ActivityEnd:12345999E5},{ActivityStart:23456789E5,ActivityEnd:23456987E5}],settings:[]}})});fb("Fitbit",function(a,b,c){switch(c.name){case "Sleepmeter":case "SleepAsAndroid":case "SleepChart1":[a,b].forEach(function(g){g.records.forEach(function(f){["comments","tags"].forEach(function(d){delete f[d]})})})}});
describe("Fitbit format",function(){var a=(new Date(2010,10,12,14,34,0,0)).getTime(),b=(new Date(2012,10,10,16,32,0,0)).getTime(),c=[{"Minutes Asleep":700,"Minutes Awake":91,"Number of Awakenings":1,"Time in Bed":12,"Minutes REM Sleep":123,"Minutes Light Sleep":1234,"Minutes Deep Sleep":12345,"End Time":a,end:a,"Start Time":a-4746E4,start:a-4746E4}];X({i:"Fitbit",name:"Empty diary",input:"Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n\n",
g:{records:[]}});X({i:"Fitbit",name:"Simple diary",input:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',g:{records:c}});X({i:"Fitbit",name:"Hard-to-parse diary",input:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","12-11-2010 2:34PM","5,000","500","300","N/A","1,000","3,000","1,000"\n"2010-11-12 1:23 AM","12-11-2010 2:34 PM","500","5,000","300","5,000","N/A","3,000","1,000"\n"2010-11-12 1:23am","12-11-2010 2:34pm","5,000","500","300","5,000","1,000","N/A","1,000"\n"2010-11-12 1:23 am","12-11-2010 2:34 pm","5,000","500","300","5,000","1,000","3,000","N/A"\n\n',
g:{records:[{"End Time":a,end:a,"Start Time":a-33E7,start:a-33E7,"Minutes Asleep":5E3,"Minutes Awake":500,"Number of Awakenings":300,"Time in Bed":null,"Minutes REM Sleep":1E3,"Minutes Light Sleep":3E3,"Minutes Deep Sleep":1E3},{"End Time":a,end:a,"Start Time":a-33E7,start:a-33E7,"Minutes Asleep":500,"Minutes Awake":5E3,"Number of Awakenings":300,"Time in Bed":5E3,"Minutes REM Sleep":null,"Minutes Light Sleep":3E3,"Minutes Deep Sleep":1E3},{"End Time":a,end:a,"Start Time":a-33E7,start:a-33E7,"Minutes Asleep":5E3,
"Minutes Awake":500,"Number of Awakenings":300,"Time in Bed":5E3,"Minutes REM Sleep":1E3,"Minutes Light Sleep":null,"Minutes Deep Sleep":1E3},{"End Time":a,end:a,"Start Time":a-33E7,start:a-33E7,"Minutes Asleep":5E3,"Minutes Awake":500,"Number of Awakenings":300,"Time in Bed":5E3,"Minutes REM Sleep":1E3,"Minutes Light Sleep":3E3,"Minutes Deep Sleep":null}]}});Y({name:"Output test",format:"output",input:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',
g:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n'});Y({name:"Standard Format test",format:"Standard",input:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',
g:[{status:"asleep",start:a-4746E4,end:a,duration:4746E4,start_of_new_day:!0,day_number:2,is_primary_sleep:!0}]});Z({name:"Two empty diaries",left:"Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n\n",right:"Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n\n",g:{records:[]}});Z({name:"Left empty, right non-empty",
left:"Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n\n",right:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',g:{records:c}});Z({name:"Left non-empty, right empty",left:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',
right:"Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n\n",g:{records:c}});Z({name:"Two identical diaries",left:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',right:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',
g:{records:c}});Z({name:"Two different diaries",left:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2010-11-12 1:23AM","2010-11-12 2:34PM","700","91","1","12","123","1,234","12,345"\n\n',right:'Sleep\nStart Time,End Time,Minutes Asleep,Minutes Awake,Number of Awakenings,Time in Bed,Minutes REM Sleep,Minutes Light Sleep,Minutes Deep Sleep\n"2012-11-10 3:21AM","2012-11-10 4:32PM","91","700","12,345","1,234","123","12","1"\n\n',
g:{records:[{"Start Time":b-4746E4,"End Time":b,start:b-4746E4,end:b,"Minutes Asleep":91,"Minutes Awake":700,"Number of Awakenings":12345,"Time in Bed":1234,"Minutes REM Sleep":123,"Minutes Light Sleep":12,"Minutes Deep Sleep":1}].concat(c)}})});fb("SpreadsheetTable",function(a,b,c){switch(c.name){case "ActivityLog":case "SleepChart1":case "PleesTracker":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["comments"].forEach(function(d){delete f[d]})})})}});
describe("SpreadsheetTable format",function(){var a={start:["start",0],end:["end",1]},b={start:["SleepStart",0],end:["SleepEnd",1],status:["sTaTe",2],comments:["comments",3,["comments","NOTES"]]};X({i:"SpreadsheetTable",name:"empty diary",input:"start,end\n",g:{records:[],member_map:a}});X({i:"SpreadsheetTable",name:"simple SpreadsheetTable with one row",input:"start,end\n123456789,123456789\n",g:{records:[{start:123456789E4,end:123456789E4,status:"asleep"}],member_map:a}});X({i:"SpreadsheetTable",
name:"Simple SpreadsheetTable with two rows",input:"Sleep,Wake\n123456789,123456789\n2020-01-01 01:01-0100,2020-02-02 02:02+0200\n",g:{records:[{Sleep:123456789E4,Wake:123456789E4,status:"asleep"},{Sleep:157784406E4,Wake:158060172E4,status:"asleep"}],member_map:{start:["Sleep",0],end:["Wake",1]}}});X({i:"SpreadsheetTable",name:"Complex SpreadsheetTable",input:'SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,"this is a single field containing one comma (,) one newline (\n) and one double quote ("")",ignored comment\n',
g:{records:[{SleepStart:123456789E4,SleepEnd:123456789E4,sTaTe:"asleep",comments:[]},{SleepStart:157784406E4,SleepEnd:158060172E4,sTaTe:"awake",comments:["comment 1",'this is a single field containing one comma (,) one newline (\n) and one double quote (")']}],member_map:b}});Y({name:"output test",format:"output",input:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",g:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n1234567890000,1234567890000,asleep\n1577844060000,1580601720000,awake,comment 1,comment 2\n"});
Y({name:"standard format test",format:"Standard",input:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",g:[{status:"asleep",start:123456789E4,end:123456789E4,duration:0,start_of_new_day:!0,day_number:2,missing_record_after:!1,is_primary_sleep:!0},{status:"awake",start:157784406E4,end:158060172E4,comments:["comment 1","comment 2"],duration:275766E4,start_of_new_day:!1,day_number:2}]});Z({name:"two empty diaries",
left:"start,end\n",right:"start,end\n",g:{records:[],member_map:a}});Z({name:"left empty, right non-empty",left:"start,end\n",right:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",g:{records:[{start:123456789E4,end:123456789E4},{start:157784406E4,end:158060172E4}],member_map:a}});Z({name:"left non-empty, right empty",left:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",
right:"start,end\n",g:{records:[{SleepStart:123456789E4,SleepEnd:123456789E4,sTaTe:"asleep",comments:[]},{SleepStart:157784406E4,SleepEnd:158060172E4,sTaTe:"awake",comments:["comment 1","comment 2"]}],member_map:b}});Z({name:"two identical diaries",left:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",right:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",
g:{records:[{SleepStart:123456789E4,SleepEnd:123456789E4,sTaTe:"asleep",comments:[]},{SleepStart:157784406E4,SleepEnd:158060172E4,sTaTe:"awake",comments:["comment 1","comment 2"]}],member_map:b}});Z({name:"two different diaries",left:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n123456789,123456789,slept\n2020-01-01 01:01-0100,2020-02-02 02:02+0200,awoke,comment 1,comment 2\n",right:"SleepStart,SleepEnd,sTaTe,comments,NOTES\n12346,12346,slept\n2020-01-01 01:02-0100,2020-02-02 02:03+0200,awoke,comment 1,comment 2\n",
g:{records:[{SleepStart:123456789E4,SleepEnd:123456789E4,sTaTe:"asleep",comments:[]},{SleepStart:157784406E4,SleepEnd:158060172E4,sTaTe:"awake",comments:["comment 1","comment 2"]},{SleepStart:12346E8,SleepEnd:12346E8,sTaTe:"asleep"},{SleepStart:157784412E4,SleepEnd:158060178E4,sTaTe:"awake",comments:["comment 1","comment 2"]}],member_map:b}})});fb("SpreadsheetGraph",function(a,b,c){switch(c.name){case "Sleepmeter":[a,b].forEach(function(g){g.records=g.records.filter(function(f){delete f.missing_record_after;return"asleep"==f.status})})}switch(c.name){case "ActivityLog":case "SleepChart1":case "PleesTracker":case "Fitbit":[a,b].forEach(function(g){g.records.forEach(function(f){["comments"].forEach(function(d){delete f[d]})})})}});
describe("SpreadsheetGraph format",function(){function a(e){return{file_format:function(){return"spreadsheet"},spreadsheet:Ga("").ta,sheets:[{cells:e||[b.slice(0),[{value:"2000-01-01"},{value:"",style:"#FFFFFFFF,#FFFFFFFF"}]]}]}}var b=";midnight;1am;2am;3am;4am;5am;6am;7am;8am;9am;10am;11am;12 noon;1:00 PM;2pm;3p m;4pm;5pm;6pm;7pm;8pm;9pm;10pm;11-midnight".split(";"),c=(new Date).getTime();c-=c%864E5;X({i:"SpreadsheetGraph",name:"minimal diary",input:a([b.slice(1),[{value:"",style:"#FFFFFFFF,#FFFFFFFF"}]]),
s:"disable",g:{records:[{start:c,comments:[],end:c+3599999,status:"awake"},{start:c+36E5,comments:[],status:"asleep"}],status_map:{awake:"#FFFFFFFF,#FFFFFFFF",asleep:""}}});X({i:"SpreadsheetGraph",name:"simple diary",input:a(),s:"disable",g:{records:[{start:9466848E5,comments:[],end:946688399999,status:"awake"},{start:9466884E5,comments:[],status:"asleep"}],status_map:{awake:"#FFFFFFFF,#FFFFFFFF",asleep:""}}});X({i:"SpreadsheetGraph",name:"hard-to-parse comment",input:a([b.slice(0),[{value:"2000-01-01"},
{value:'this is a single field containing one comma (,) one newline (\n) and one double quote (")',style:"#FFFFFFFF,#FFFFFFFF"}]]),s:"disable",g:{records:[{start:9466848E5,comments:['this is a single field containing one comma (,) one newline (\n) and one double quote (")'],end:946688399999,status:"awake"},{start:9466884E5,comments:[],status:"asleep"}],status_map:{awake:"#FFFFFFFF,#FFFFFFFF",asleep:""}}});var g=hb({name:"output test",input:a()});it('converts "output test" to "output" correctly',function(){return g.to_async("output").then(function(e){expect(e.contents.length).toBeGreaterThan(0)})});
Y({name:"standard format test 1",format:"Standard",input:a(),g:[{start:9466848E5,end:946688399999,status:"awake",duration:3599999,start_of_new_day:!1,day_number:0,missing_record_after:!1},{start:9466884E5,status:"asleep",start_of_new_day:!0,day_number:2}]});ib({name:"standard format test 2",format:"SpreadsheetGraph",input:[{start:9466848E5,comments:["Comment\ntext"],end:946688399999,status:"asleep",duration:3599999,start_of_new_day:!1,day_number:0,missing_record_after:!1},{start:9466884E5,status:"awake",
start_of_new_day:!0,day_number:2}],g:a([b.slice(0),[{value:"2000-01-01"},{value:"Comment\ntext",style:"#FFFFFF00,#FF0000FF,#FFFFFFFF"}],[],[{value:"asleep",style:"#FFFFFF00,#FF0000FF,#FFFFFFFF"}]])});Z({name:"two identical diaries",left:a(),right:a(),g:{records:[{start:9466848E5,comments:[],end:946688399999,status:"awake"},{start:9466884E5,comments:[],status:"asleep"}],status_map:{awake:"#FFFFFFFF,#FFFFFFFF",asleep:""}}});Z({name:"two different diaries",left:a(),right:a([b.slice(0),[{value:"2000-01-01"},
{value:"Comment\ntext",style:"#FFFFFF00,#FF0000FF"}],[],[{value:"asleep",style:"#FFFFFF00,#FF0000FF"}]]),g:{records:[{start:9466848E5,comments:[],end:946688399999,status:"awake"},{start:9466884E5,comments:[],status:"asleep"},{start:9466848E5,comments:["Comment\ntext"],end:946688399999,status:"asleep"},{start:9466884E5,comments:[],status:"awake"}],status_map:{awake:"#FFFFFFFF,#FFFFFFFF",asleep:""}}});for(c=0;2>c;++c){var f=[b.slice(0),[{value:"2001-01-01"},{},{value:"",style:"#FFFFFFFF,#FFFFFFFF"}],
[{value:"2001-01-02"},{},{},{value:"",style:"#FFFFFFFF,#FFFFFFFF"}],[{value:"2001-01-03"},{},{},{},{value:"",style:"#FFFFFFFF,#FFFFFFFF"}],[{value:"2001-01-04"},{},{},{},{},{value:"",style:"#FFFFFFFF,#FFFFFFFF"}]];f.forEach(function(e){for(;e.length<b.length;)e.push({})});c&&f.shift();var d=[];f.forEach(function(e,p){return e.forEach(function(k,l){d[l]||(d[l]=[]);d[l][p]=k})});var h={records:[{start:9783072E5,comments:[],end:978310799999,status:"awake"},{start:9783108E5,comments:[],end:978314399999,
status:"asleep"},{start:9783144E5,comments:[],end:978400799999,status:"awake"},{start:9784008E5,comments:[],end:978404399999,status:"asleep"},{start:9784044E5,comments:[],end:978490799999,status:"awake"},{start:9784908E5,comments:[],end:978494399999,status:"asleep"},{start:9784944E5,comments:[],end:978580799999,status:"awake"},{start:9785808E5,comments:[],end:978584399999,status:"asleep"},{start:9785844E5,comments:[],status:"awake"}],status_map:{awake:"",asleep:"#FFFFFFFF,#FFFFFFFF"}};X({i:"SpreadsheetGraph",
name:"sheet with row_offset=="+c,input:a(f),s:"disable",g:h});X({i:"SpreadsheetGraph",name:"sheet with row_offset=="+c+" (rotated)",input:a(d),s:"disable",g:h})}[60,30,15,5].forEach(function(e){for(var p=[""],k=0;1440!=k;k+=e){var l=Math.floor(k/60).toString(),q=(k%60).toString();1==l.length&&(l="0"+l);1==q.length&&(q="0"+q);p.push(l+":"+q)}X({i:"SpreadsheetGraph",name:"diary with duration="+e,input:a([p,[{value:"2000-01-01"},{},{value:"",style:"#FFFFFFFF,#FFFFFFFF"}]]),s:"disable",g:{records:[{start:9466848E5+
0*e,comments:[],end:9466848E5+6E4*e-1,status:"awake"},{start:9466848E5+6E4*e,comments:[],end:9466848E5+12E4*e-1,status:"asleep"},{start:9466848E5+12E4*e,comments:[],status:"awake"}],status_map:{asleep:"#FFFFFFFF,#FFFFFFFF",awake:""}}})});[{name:"unused values outside the header/body",cells:[[{},{value:"unused value"}],[{},{value:"unused value"}],[{},{value:"unused value"}],[{},{value:"unused value"}]],H:"caffeine;alcohol;snack;awake;asleep;lights off;lights on;meal;chocolate;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;caffeine;alcohol;snack;awake;asleep;lights off;lights on;alcohol;snack;awake;asleep;lights off;lights on;meal;chocolate;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;caffeine;alcohol;snack;awake;asleep;lights off;lights on;meal;snack;awake;asleep;lights off;lights on;meal;chocolate;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;caffeine;alcohol;snack;awake;asleep;lights off;lights on;meal;chocolate;awake;asleep;lights off;lights on;meal;chocolate;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;caffeine;alcohol;snack;awake;asleep;lights off;lights on;meal;chocolate;drink".split(";"),
G:{awake:"#FFFFFFFF,#FFFFF0003",asleep:"#FFFFFFFF,#FFFFF0004",snack:"#FFFFFFFF,#FFFFF0002",meal:"#FFFFFFFF,#FFFFF0007",alcohol:"#FFFFFFFF,#FFFFF0001",chocolate:"#FFFFFFFF,#FFFFF0008",caffeine:"#FFFFFFFF,#FFFFF0000",drink:"#FFFFFFFF,#FFFFF0009","sleep aid":"#FFFFFFFF,#FFFFF0010",exercise:"#FFFFFFFF,#FFFFF0011",toilet:"#FFFFFFFF,#FFFFF0012",noise:"#FFFFFFFF,#FFFFF0013",alarm:"#FFFFFFFF,#FFFFF0014","in bed":"#FFFFFFFF,#FFFFF0015","out of bed":"#FFFFFFFF,#FFFFF0016","lights off":"#FFFFFFFF,#FFFFF0005",
"lights on":"#FFFFFFFF,#FFFFF0006"}},{name:"full legend",cells:[[{style:"#FFFFFFFF,#FFFFF0000",value:"awake"},{style:"#FFFFFFFF,#FFFFF0001",value:"asleep"},{style:"#FFFFFFFF,#FFFFF0002",value:"snack"},{style:"#FFFFFFFF,#FFFFF0003",value:"meal"},{style:"#FFFFFFFF,#FFFFF0004",value:"alcohol"},{style:"#FFFFFFFF,#FFFFF0005",value:"chocolate"},{style:"#FFFFFFFF,#FFFFF0006",value:"caffeine"},{style:"#FFFFFFFF,#FFFFF0007",value:"drink"},{style:"#FFFFFFFF,#FFFFF0008",value:"sleep aid"},{style:"#FFFFFFFF,#FFFFF0009",
value:"exercise"},{style:"#FFFFFFFF,#FFFFF0010",value:"toilet"},{style:"#FFFFFFFF,#FFFFF0011",value:"noise"},{style:"#FFFFFFFF,#FFFFF0012",value:"alarm"},{style:"#FFFFFFFF,#FFFFF0013",value:"in bed"},{style:"#FFFFFFFF,#FFFFF0014",value:"out of bed"},{style:"#FFFFFFFF,#FFFFF0015",value:"lights off"},{style:"#FFFFFFFF,#FFFFF0016",value:"lights on"}]],H:"awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise".split(";"),
G:{awake:"#FFFFFFFF,#FFFFF0000",asleep:"#FFFFFFFF,#FFFFF0001",snack:"#FFFFFFFF,#FFFFF0002",meal:"#FFFFFFFF,#FFFFF0003",alcohol:"#FFFFFFFF,#FFFFF0004",chocolate:"#FFFFFFFF,#FFFFF0005",caffeine:"#FFFFFFFF,#FFFFF0006",drink:"#FFFFFFFF,#FFFFF0007","sleep aid":"#FFFFFFFF,#FFFFF0008",exercise:"#FFFFFFFF,#FFFFF0009",toilet:"#FFFFFFFF,#FFFFF0010",noise:"#FFFFFFFF,#FFFFF0011",alarm:"#FFFFFFFF,#FFFFF0012","in bed":"#FFFFFFFF,#FFFFF0013","out of bed":"#FFFFFFFF,#FFFFF0014","lights off":"#FFFFFFFF,#FFFFF0015",
"lights on":"#FFFFFFFF,#FFFFF0016"}},{name:"legend with text below styles",cells:[[{style:"#FFFFFFFF,#FFFFF0000"},{style:"#FFFFFFFF,#FFFFF0001"},{style:"#FFFFFFFF,#FFFFF0002"},{style:"#FFFFFFFF,#FFFFF0003"},{style:"#FFFFFFFF,#FFFFF0004"},{style:"#FFFFFFFF,#FFFFF0005"},{style:"#FFFFFFFF,#FFFFF0006"},{style:"#FFFFFFFF,#FFFFF0007"},{style:"#FFFFFFFF,#FFFFF0008"},{style:"#FFFFFFFF,#FFFFF0009"},{style:"#FFFFFFFF,#FFFFF0010"},{style:"#FFFFFFFF,#FFFFF0011"},{style:"#FFFFFFFF,#FFFFF0012"},{style:"#FFFFFFFF,#FFFFF0013"},
{style:"#FFFFFFFF,#FFFFF0014"},{style:"#FFFFFFFF,#FFFFF0015"},{style:"#FFFFFFFF,#FFFFF0016"}],[{value:"awake"},{value:"asleep"},{value:"snack"},{value:"meal"},{value:"alcohol"},{value:"chocolate"},{value:"caffeine"},{value:"drink"},{value:"sleep aid"},{value:"exercise"},{value:"toilet"},{value:"noise"},{value:"alarm"},{value:"in bed"},{value:"out of bed"},{value:"lights off"},{value:"lights on"}]],H:"awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise".split(";"),
G:{awake:"#FFFFFFFF,#FFFFF0000",asleep:"#FFFFFFFF,#FFFFF0001",snack:"#FFFFFFFF,#FFFFF0002",meal:"#FFFFFFFF,#FFFFF0003",alcohol:"#FFFFFFFF,#FFFFF0004",chocolate:"#FFFFFFFF,#FFFFF0005",caffeine:"#FFFFFFFF,#FFFFF0006",drink:"#FFFFFFFF,#FFFFF0007","sleep aid":"#FFFFFFFF,#FFFFF0008",exercise:"#FFFFFFFF,#FFFFF0009",toilet:"#FFFFFFFF,#FFFFF0010",noise:"#FFFFFFFF,#FFFFF0011",alarm:"#FFFFFFFF,#FFFFF0012","in bed":"#FFFFFFFF,#FFFFF0013","out of bed":"#FFFFFFFF,#FFFFF0014","lights off":"#FFFFFFFF,#FFFFF0015",
"lights on":"#FFFFFFFF,#FFFFF0016"}},{name:"one legend item missing",cells:[[{style:"#FFFFFFFF,#FFFFF0000",value:"awake"},{style:"#FFFFFFFF,#FFFFF0001",value:"asleep"},{style:"#FFFFFFFF,#FFFFF0002",value:"snack"},{style:"#FFFFFFFF,#FFFFF0003",value:"meal"},{style:"#FFFFFFFF,#FFFFF0004",value:"alcohol"},{style:"#FFFFFFFF,#FFFFF0005",value:"chocolate"},{style:"#FFFFFFFF,#FFFFF0006",value:"caffeine"},{style:"#FFFFFFFF,#FFFFF0008",value:"sleep aid"},{style:"#FFFFFFFF,#FFFFF0009",value:"exercise"},{style:"#FFFFFFFF,#FFFFF0010",
value:"toilet"},{style:"#FFFFFFFF,#FFFFF0011",value:"noise"},{style:"#FFFFFFFF,#FFFFF0012",value:"alarm"},{style:"#FFFFFFFF,#FFFFF0013",value:"in bed"},{style:"#FFFFFFFF,#FFFFF0014",value:"out of bed"},{style:"#FFFFFFFF,#FFFFF0015",value:"lights off"},{style:"#FFFFFFFF,#FFFFF0016",value:"lights on"}]],H:"awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;asleep;snack;meal;alcohol;chocolate;caffeine;drink;sleep aid;exercise".split(";"),
G:{awake:"#FFFFFFFF,#FFFFF0000",asleep:"#FFFFFFFF,#FFFFF0001",snack:"#FFFFFFFF,#FFFFF0002",meal:"#FFFFFFFF,#FFFFF0003",alcohol:"#FFFFFFFF,#FFFFF0004",chocolate:"#FFFFFFFF,#FFFFF0005",caffeine:"#FFFFFFFF,#FFFFF0006",drink:"#FFFFFFFF,#FFFFF0007","sleep aid":"#FFFFFFFF,#FFFFF0008",exercise:"#FFFFFFFF,#FFFFF0009",toilet:"#FFFFFFFF,#FFFFF0010",noise:"#FFFFFFFF,#FFFFF0011",alarm:"#FFFFFFFF,#FFFFF0012","in bed":"#FFFFFFFF,#FFFFF0013","out of bed":"#FFFFFFFF,#FFFFF0014","lights off":"#FFFFFFFF,#FFFFF0015",
"lights on":"#FFFFFFFF,#FFFFF0016"}},{name:"several legend items missing",cells:[[{style:"#FFFFFFFF,#FFFFF0000",value:"awake"},{style:"#FFFFFFFF,#FFFFF0002",value:"snack"},{style:"#FFFFFFFF,#FFFFF0004",value:"alcohol"},{style:"#FFFFFFFF,#FFFFF0006",value:"caffeine"},{style:"#FFFFFFFF,#FFFFF0008",value:"sleep aid"},{style:"#FFFFFFFF,#FFFFF0010",value:"toilet"},{style:"#FFFFFFFF,#FFFFF0012",value:"alarm"},{style:"#FFFFFFFF,#FFFFF0014",value:"out of bed"},{style:"#FFFFFFFF,#FFFFF0015",value:"lights off"},
{style:"#FFFFFFFF,#FFFFF0016",value:"lights on"}]],H:"awake;drink;snack;asleep;alcohol;meal;caffeine;chocolate;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;drink;snack;asleep;alcohol;meal;caffeine;drink;snack;asleep;alcohol;meal;caffeine;chocolate;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;drink;snack;asleep;alcohol;meal;caffeine;chocolate;snack;asleep;alcohol;meal;caffeine;chocolate;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;drink;snack;asleep;alcohol;meal;caffeine;chocolate;sleep aid;asleep;alcohol;meal;caffeine;chocolate;sleep aid;exercise;toilet;noise;alarm;in bed;out of bed;lights off;lights on;awake;drink;snack;asleep;alcohol;meal;caffeine;chocolate;sleep aid;exercise".split(";"),
G:{awake:"#FFFFFFFF,#FFFFF0000",asleep:"#FFFFFFFF,#FFFFF0003",snack:"#FFFFFFFF,#FFFFF0002",meal:"#FFFFFFFF,#FFFFF0005",alcohol:"#FFFFFFFF,#FFFFF0004",chocolate:"#FFFFFFFF,#FFFFF0007",caffeine:"#FFFFFFFF,#FFFFF0006",drink:"#FFFFFFFF,#FFFFF0001","sleep aid":"#FFFFFFFF,#FFFFF0008",exercise:"#FFFFFFFF,#FFFFF0009",toilet:"#FFFFFFFF,#FFFFF0010",noise:"#FFFFFFFF,#FFFFF0011",alarm:"#FFFFFFFF,#FFFFF0012","in bed":"#FFFFFFFF,#FFFFF0013","out of bed":"#FFFFFFFF,#FFFFF0014","lights off":"#FFFFFFFF,#FFFFF0015",
"lights on":"#FFFFFFFF,#FFFFF0016"}}].forEach(function(e){for(var p=[[{value:"2000-01-01"}],[{value:"2000-01-02"}],[{value:"2000-01-03"}],[{value:"2000-01-04"}]],k=0;24!=k;++k)p.forEach(function(q,n){for(n=((k+n)%17).toString();4>n.length;)n="0"+n;q[k+1]={value:"",style:"#FFFFFFFF,#FFFFF"+n}});e.cells.forEach(function(q,n){return p[n]=p[n].concat(q)});var l=e.H.map(function(q,n){return{start:9466848E5+36E5*n,comments:[],end:9466848E5+36E5*(n+1)-1,status:q}});delete l[l.length-1].end;X({i:"SpreadsheetGraph",
name:e.name,input:a(p),s:"disable",g:{records:l,status_map:e.G}})})});}).call(this);
//# sourceMappingURL=test.js.map
