<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: DiaryStandard</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: DiaryStandard</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>DiaryStandard<span class="signature">(file, serialiser<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    

    
    <h4 class="name" id="DiaryStandard"><span class="type-signature"></span>new DiaryStandard<span class="signature">(file, serialiser<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>file</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last">file contents, or object containing records
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>records</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">individual records from the sleep diary</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>minimum_day_duration</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">minimum expected day duration in milliseconds</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>maximum_day_duration</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">maximum expected day duration in milliseconds</td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>serialiser</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">function to serialise output</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line295">line 295</a>
    </li></ul></dd>
    

    

    

    
</dl>



















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>let diary = new_sleep_diary(contents_of_my_file));

// print the minimum expected day duration in milliseconds:
console.log(diary.settings.minimum_day_duration);
-> 12345

// print the maximum expected day duration in milliseconds:
console.log(diary.settings.maximum_day_duration);
-> 23456

// Print the complete list of records
console.log(diary.records);
-> [
     {
       // DiaryStandardRecordStatus value, usually "awake" or "asleep"
       status: "awake",

       // start and end time (in milliseconds past the Unix epoch), estimated if the user forgot to log some data:
       start: 12345678,
       end: 23456789,
       start_timezone: "Etc/GMT-1",
       end_timezone: "Europe/Paris",

       duration: 11111111, // or missing if duration is unknown

       // tags associated with this period:
       tags: [
         "tag 1",
         "tag 2",
         ...
       ],

       // comments recorded during this period:
       comments: [
         "comment with no associated timestamp",
         { time: 23456543, text: "timestamped comment" },
         ...
       ],

       // (estimated) day this record is assigned to:
       day_number: 1,

       // true if the current day number is greater than the previous record's day number:
       start_of_new_day: true,

       // whether this value is the primary sleep for the current day number:
       is_primary_sleep: false,

       // this is set if it looks like the user forgot to log some data:
       missing_record_after: true

     },

     ...

   ]

// Print the user's current sleep/wake status:
console.log(diary.latest_sleep_status());
-> "awake"

// Print the user's sleep statistics:
console.log( diary.summarise_records( record => record.status == "asleep" ) );
-> {
                   average           : 12345.678,
                   mean              : 12356.789,
     interquartile_mean              : 12345.678,
                   standard_deviation: 12.56,
     interquartile_standard_deviation: 12.45,
                   median            : 12345,
     interquartile_range             : 12,
                   durations         : [ undefined, 12345, undefined, ... ],
     interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
   }

// Print the user's day length statistics for the past 14 days:
let cutoff = new Date().getTime() - 1000*60*60*24*14;
console.log( diary.summarise_days( record => record.start > cutoff ) );
-> {
                   average           : 12345.678,
                   mean              : 12356.789,
     interquartile_mean              : 12345.678,
                   standard_deviation: 12.56,
     interquartile_standard_deviation: 12.45,
                   median            : 12345,
     interquartile_range             : 12,
                   durations         : [ undefined, 12345, undefined, ... ],
     interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
   }

// Print the user's daily schedule on a 24-hour clock:
console.log( diary.summarise_schedule();
-> {
     sleep: { // time (GMT) when the user falls asleep:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
     wake: { // time (GMT) when the user wakes up:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
   }

// Print the user's daily schedule on a 24-hour clock for the past 14 days:
let cutoff = new Date().getTime() - 1000*60*60*24*14;
console.log( diary.summarise_schedule( record => record.start > cutoff ) );
-> {
     sleep: { // time (GMT) when the user falls asleep:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
     wake: { // time (GMT) when the user wakes up:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
   }
// Print the user's daily schedule on a 25-hour clock, defaulting to Cairo's timezone:
console.log( diary.summarise_schedule( null, 25*60*60*1000, "Africa/Cairo" ) );
-> {
     sleep: { // time (Cairo) when the user falls asleep:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
     wake: { // time (Cairo) when the user wakes up:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
   }</code></pre>



    
    </div>

    
        <h3 class="subsection-title">Extends</h3>

        


    <ul>
        <li><a href="DiaryBase.html">DiaryBase</a></li>
    </ul>


    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="%22records%22"><span class="type-signature"></span>"records"<span class="type-signature"> :Array.&lt;<a href="global.html#DiaryStandardRecord">DiaryStandardRecord</a>></span></h4>




<div class="description">
    Individual records from the sleep diary
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Array.&lt;<a href="global.html#DiaryStandardRecord">DiaryStandardRecord</a>></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line464">line 464</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="%22spreadsheet%22"><span class="type-signature">(protected) </span>"spreadsheet"<span class="type-signature"> :<a href="Spreadsheet.html">Spreadsheet</a></span></h4>




<div class="description">
    Spreadsheet manager
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><a href="Spreadsheet.html">Spreadsheet</a></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line320">line 320</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id="serialiser"><span class="type-signature"></span>serialiser<span class="type-signature"> :function</span></h4>




<div class="description">
    Serialise a value for output
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">function</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#serialiser">DiaryBase#serialiser</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line85">line 85</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="clone"><span class="type-signature"></span>clone<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Create a deep copy of the current object
</div>













<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#clone">DiaryBase#clone</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line119">line 119</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="corrupt"><span class="type-signature">(protected) </span>corrupt<span class="signature">(file, message)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Indicates the file is a corrupt file in the specified format
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>file</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">file contents, or filename/contents pairs (for archive files)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>message</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">optional error message</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#corrupt">DiaryBase#corrupt</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line295">line 295</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="daily_activities"><span class="type-signature"></span>daily_activities<span class="signature">(timezone<span class="signature-attributes">opt</span>, day_start<span class="signature-attributes">opt</span>, day_stride<span class="signature-attributes">opt</span>, segment_stride<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    List of activities, grouped by day

<p>It can be useful to display a diary as a series of columns
or rows, each containing the activities for that day.  This
function returns a structure that accounts for the following
issues:</p>

<p><strong>Multi-day records</strong> - the function returns a
list of <em>days</em>, which contain <em>activities</em> -
parts of a record confined within that day.</p>

<p><strong>Daylight savings time</strong> - if the timezone
observes daylight savings time (e.g. `Europe/London` instead of
`Etc/GMT`), the function will modify days to account for DST
changes (so a 24-hour diary will start at the same time
every day, even if that means having a 23- or 25-hour day).</p>

<p><strong>Missing days</strong> - if a user skips a day, or
stops recording altogether for months or even years, the
function will leave a gap in the array for each missing
day.</p>

<p>Not including workarounds for a few edge cases, the start
and end times for days are calculated like this:</p>

<ol>
 <li>Find the start of the first day:
  <ol>
   <li>find the earliest date in the list of records
   <li>find the last time at or before that date
    where the time equals `day_start` in `timezone`
   <li>if that date would be invalid (because a DST change
    causes that time to be skipped), move backwards by the DST
    change duration.
  </ol>
 </li>
 <li>Find the start of the next day:
  <ol>
   <li>move forwards in time by `day_stride`
   <li>move backwards by the difference between the start and end timezone offsets<br>
    (so a 24-hour `day_stride` will always start at the same time of day)
  </ol>
 </li>
 <li>Create a new day object with the start of the current and next day</li>
 <li>Continue moving forward one day at a time until we reach the final record
</ul>

<p>An activity represents the fraction of a record that exists
within the current day.  For example, a record that lasted two
days would have two associated records.  Activity times are
decided like this:</p>

<ul>
 <li>if a record has neither a `start` nor `end` time, no activities are created
 <li>if a record has exactly one `start` or `end` time, one activity is created.
  The activity has a `time` equal to whichever was defined.
 <li>if a record has both `start` and `end`, and both are within the same day,
  one activity is created. The activity has a `time` halfway between the two.
 <li>if a record has both `start` and `end` that span multiple days,
  one activity is created for each day the record is active.  The first
  activity has a `time` halfway between `start` and the end of that day.
  middle activities have a `time` equal to the middle of the day.  The final
  activity has a `time` halfway between the start of that day and `end`
</ul>

<p>Each activity includes a `type`, which is one of:</p>

<ul>
 <li>`start-end` - complete duration of an event
 <li>`start-mid` - start of an event that spans multiple days
 <li>`mid-mid` - middle of an event that spans multiple days
 <li>`mid-end` - end of an event that spans multiple days
 <li>`start-unknown` - start of an event with an undefined end time
 <li>`unknown-end` - end of an event with an undefined start time
</ul>

<p>If a `segment_stride` argument is passed, segments for a day
are calculated like this:</p>

<ol>
 <li>create a segment that starts at the `start` time
 <li>check whether the DST offset is the same at the start and end of the day
 <ul>
  <li>if not, create segments `segment_stride` apart
  <li>otherwise...
   <ul>
    <li>continue forwards until the current segment's end time is
     greater than the `end` time, or the timezone's DST status
     changes
    <li>stop unless a DST change was crossed
    <li>create a new segment that ends at the `end` time
    <li>continue backwards until the current segment's start time
     is less than or equal to the last segment from amove
    <li>sort all segments by start time
   </ul>
  </li>
</ol>

<p>The algorithm above should produce intuitive dates in most
 cases, but produces unexpected behaviour if there is more than
 one DST change in a single day.</p>

<p>Be aware that some timezones have [a 45-minute offset from
UTC](https://en.wikipedia.org/wiki/UTC%2B05:45), and [even more
esoteric
timezones](https://en.wikipedia.org/wiki/UTC%E2%88%9200:25:21),
existed in the 20th century.  You may need to test your program
carefully to avoid incorrect behaviour in some cases.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>timezone</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    system_timezone
                
                </td>
            

            <td class="description last">display dates in this timezone</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>day_start</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    64800000
                
                </td>
            

            <td class="description last">start the first new day at this time (usually 6pm)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>day_stride</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    86400000
                
                </td>
            

            <td class="description last">amount of time to advance each day (usually 24 hours)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>segment_stride</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last">amount of time to advance each segment</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line1246">line 1246</a>
    </li></ul></dd>
    

    

    

    
</dl>



















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>console.log( diary.daily_activities() );
-> [
     {
       "start"   : 123456789, // Unix time when the day starts
       "end"     : 234567890, // start + day_stride - dst_change
       "duration": 11111111, // end - start
       "id"      : "2020-03-30T18:00:00.000 Etc/GMT" // ISO 8601 equivalent of "start"
       "year"    : 2020,
       "month"   : 2, // zero-based month number
       "day"     : 29, // zero-based day of month
       "activities": [
         {
           "start"       : 123459999, // time when the event started (optional)
           "end"         : 234560000, // time when the event ended (optional)
           "time"        : 200000000, // time associated with the event (required)
           "offset_start": 0.1, // ( start - day.start ) / day.duration
           "offset_end"  : 0.9, // ( end - day.start ) / day.duration
           "offset_time" : 0.5, // ( time - day.start ) / day.duration
           "type"        : "start-end" // see above for list of types
           "record"      : { ... }, // associated record
           "index"       : 0, // this is the nth activity for this record
         },
       ],
       "activity_summaries": {
         "asleep": {
           "first_start": "2020-03-30T20:00:00.000 Etc/GMT", // start of first activity
           "first_end"  : "2020-03-31T06:00:00.000 Etc/GMT", // end of first activity
            "last_start": "2020-03-31T14:00:00.000 Etc/GMT", // start of last activity
            "last_end"  : "2020-03-31T14:30:00.000 Etc/GMT", // end of last activity
           "duration"   : 37800000, // total milliseconds (NaN if some activities have undefined duration)
         },
         ...
       },
       "segments": [
         {
           "dst_state": "on" // or "off" or "change-forward" or "change-back"
           "year"  : 2020,
           "month" : 2, // zero-based month number
           "day"   : 29, // zero-based day of month
           "hour"  : 18,
           "minute": 0,
           "second": 0,
           "id"    : "2020-03-30T18:00:00.000 Etc/GMT"
         },
         ...
       ],
     },
     ...
   ]</code></pre>



        
            

    

    
    <h4 class="name" id="invalid"><span class="type-signature">(protected) </span>invalid<span class="signature">(file)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Indicates the file is not valid in our file format
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>file</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">file contents, or filename/contents pairs (for archive files)</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#invalid">DiaryBase#invalid</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line285">line 285</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="latest_sleep_status"><span class="type-signature"></span>latest_sleep_status<span class="signature">()</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    Latest sleep/wake status
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line1486">line 1486</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    "awake", "asleep" or "" (for an empty diary)
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="merge"><span class="type-signature"></span>merge<span class="signature">(other)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Merge another diary into this one
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>other</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="DiaryBase.html">DiaryBase</a></span>


            
            </td>

            

            

            <td class="description last">diary to merge in</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#merge">DiaryBase#merge</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line110">line 110</a>
    </li></ul></dd>
    

    

    

    
</dl>



















    <h5>Example</h5>
    
    <pre class="prettyprint"><code>diary.merge(my_data);</code></pre>



        
            

    

    
    <h4 class="name" id="serialise"><span class="type-signature">(protected) </span>serialise<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Serialise data for output
</div>













<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#serialise">DiaryBase#serialise</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line249">line 249</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="software_version"><span class="type-signature"></span>software_version<span class="signature">()</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    Version ID for this package
</div>













<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#software_version">DiaryBase#software_version</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line615">line 615</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="summarise_days"><span class="type-signature"></span>summarise_days<span class="signature">(filter<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Summary statistics (based on records grouped by day_number)

<p>Similar to <a href="DiaryStandard.html#summarise_records">DiaryStandard#summarise_records</a>, but
groups records by day_number.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>filter</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">only examine records that match this filter</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line825">line 825</a>
    </li></ul></dd>
    

    
    <dt class="tag-tutorial">Tutorials:</dt>
    <dd class="tag-tutorial">
        <ul>
            <li><a href="tutorial-Graph your day lengths.html">Graph your day lengths</a></li>
        </ul>
    </dd>
    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="DiaryStandard.html#summarise_records">summarise_records</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    MaybeDiaryStandardStatistics
</div>



    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>console.log( diary.summarise_days( record => record.start > cutoff ) );
-> {
                   average           : 12345.678,
                   mean              : 12356.789,
     interquartile_mean              : 12345.678,
                   standard_deviation: 12.56,
     interquartile_standard_deviation: 12.45,
                   median            : 12345,
     interquartile_range             : 12,
                   durations         : [ undefined, 12345, undefined, ... ],
     interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
   }</code></pre>



        
            

    

    
    <h4 class="name" id="summarise_records"><span class="type-signature"></span>summarise_records<span class="signature">(filter<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Summary statistics (based on individual records)

<p>Because real-world data tends to be quite messy, and because
different users have different requirements, we provide several
summaries for the data:</p>

<ul>
 <li><tt>average</tt> is the best guess at what the
     user would intuitively consider the average duration of a
     record.  The exact calculation is chosen from the list
     below, and may change in future.  It is currently the
     <tt>trimmed_mean</tt>.  If you don't have any specific
     requirements, you should use this and ignore the
     others.</li>
 <li><tt>mean</tt> and <tt>standard_deviation</tt> are
     traditional summary statistics for the duration, but are
     not recommended because real-world data tends to skew
     these values higher than one would expect.</li>
 <li><tt>interquartile_mean</tt> and <tt>interquartile_standard_deviation</tt>
     produce more robust values in cases like ours, because they
     ignore the highest and lowest few records.
 <li><tt>median</tt> and <tt>interquartile_range</tt> produce
     more robust results, but tend to be less representative when
     there are only a few outliers in the data.
 <li><tt>durations</tt> and <tt>interquartile_durations</tt>
     are the raw values the other statistics were created from.
</ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>filter</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">only examine records that match this filter</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line787">line 787</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    MaybeDiaryStandardStatistics
</div>



    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>console.log( diary.summarise_records( record => record.status == "asleep" ) );
-> {
                   average           : 12345.678,
                   mean              : 12356.789,
     interquartile_mean              : 12345.678,
                   standard_deviation: 12.56,
     interquartile_standard_deviation: 12.45,
                   median            : 12345,
     interquartile_range             : 12,
                   durations         : [ undefined, 12345, undefined, ... ],
     interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
   }</code></pre>



        
            

    

    
    <h4 class="name" id="summarise_schedule"><span class="type-signature"></span>summarise_schedule<span class="signature">(filter<span class="signature-attributes">opt</span>, day_length<span class="signature-attributes">opt</span>, timezone<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Object}</span></h4>
    

    



<div class="description">
    Summary statistics about daily events

<p>Somewhat similar to <a href="DiaryStandard.html#summarise_records">DiaryStandard#summarise_records</a>.</p>

<p>Calculates the time of day when the user is likey to wake up
or go to sleep.</p>

<p>Sleep/wake times are currently calculated based on the
beginning/end time for each day's primary sleep, although this
may change in future.</p>

<p>Times are calculated according to the associated timezone.
For example, say you woke up in New York at 8am, flew to Los
Angeles, went to bed and woke up again at 8am local time.  You
would be counted as waking up at 8am both days, even though 27
hours had passed between wake events.</p>

<p>Records without a timezone are treated as if they had the
environment's default timezone</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>filter</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    null
                
                </td>
            

            <td class="description last">only examine records that match this filter</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>day_length</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    86400000
                
                </td>
            

            <td class="description last">times of day are calculated relative to this amount of time</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>timezone</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    system_timezone
                
                </td>
            

            <td class="description last">default timezone for records</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line992">line 992</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="DiaryStandard.html#summarise_records">summarise_records</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>console.log( diary.summarise_schedule() );
-> {
     sleep: { // time when the user falls asleep:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
     wake: { // time when the user wakes up:
                     average           : 12345.678,
                     mean              : 12356.789,
       interquartile_mean              : 12345.678,
                     standard_deviation: 12.56,
       interquartile_standard_deviation: 12.45,
                     median            : 12345,
       interquartile_range             : 12,
                     durations         : [ undefined, 12345, undefined, ... ],
       interquartile_durations         : [ 10000, 10001 ... 19998, 19999 ],
     },
   }</code></pre>



        
            

    

    
    <h4 class="name" id="timezones"><span class="type-signature"></span>timezones<span class="signature">()</span><span class="type-signature"> &rarr; {Array.&lt;string>}</span></h4>
    

    



<div class="description">
    Complete list of allowed timezones
</div>













<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#timezones">DiaryBase#timezones</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line607">line 607</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array.&lt;string></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="to"><span class="type-signature"></span>to<span class="signature">(to_format)</span><span class="type-signature"> &rarr; {*}</span></h4>
    

    



<div class="description">
    Convert a value to some other format

<p>Supported formats:</p>

<ul>
  <li><tt>url</tt> - contents serialised for inclusion in a URL</li>
  <li><tt>json</tt> - contents serialised to JSON</li>
  <li><tt>storage-line</tt> - contents serialised for inclusion in a newline-separated list of diaries</li>
  <li><tt>Standard</tt> - Standard format</li>
  <li><em>(other formats)</em> - the name of any other diary format</li>
</ul>

<p><a href="DiaryBase.html#to_async">to_async()</a> supports more formats
and should be used where possible.  You should only call this
function directly if you want to guarantee synchronous execution.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>to_format</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">requested format</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#to">DiaryBase#to</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line162">line 162</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    diary data in new format
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">*</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>console.log( diary.to("NewFormat") );</code></pre>



        
            

    

    
    <h4 class="name" id="to_async"><span class="type-signature"></span>to_async<span class="signature">(to_format)</span><span class="type-signature"> &rarr; {Promise|Object}</span></h4>
    

    



<div class="description">
    Convert a value to some other format

<p>Supported formats:</p>

<ul>
  <li><tt>output</tt> - contents serialised for output (e.g. to a file)</li>
  <li><tt>spreadsheet</tt> - binary data that can be loaded by a spreadsheet program</li>
  <li><em>(formats supported by <a href="DiaryBase.html#to">to()</a>)</em></li>
</ul>

<p>See also <a href="DiaryBase.html#to">to()</a>, a lower-level function
that supports formats that can be generated synchronously.  You
can use that function if a Promise interface would be
cumbersome or unnecessary in a given piece of code.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>to_format</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">requested format</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    
    <dt class="tag-overrides">Overrides:</dt>
    <dd class="tag-overrides"><ul class="dummy"><li>
        <a href="DiaryBase.html#to_async">DiaryBase#to_async</a>
    </li></ul></dd>
    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="DiaryBase.js.html">DiaryBase.js</a>, <a href="DiaryBase.js.html#line228">line 228</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    Promise that returns the converted diary
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>
|

<span class="param-type">Object</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>diary.to_async("NewFormat").then( reformatted => console.log( reformatted_diary ) );</code></pre>



        
            

    

    
    <h4 class="name" id="total_per_day"><span class="type-signature"></span>total_per_day<span class="signature">(record_filter<span class="signature-attributes">opt</span>, day_filter<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Summary statistics about the number of times an event occurs per day

<p>Similar to <a href="DiaryStandard.html#summarise_days">DiaryStandard#summarise_days</a>, but
looks at totals instead of sums.</p>

<p>The <tt>summarise_*</tt> functions examine sums, so missing
values are treated as <tt>undefined</tt>.  This function
examines totals, so missing values are treated as <tt>0</tt>.
The <tt>record_filter</tt> and <tt>day_filter</tt> parameters
allow you to exclude days and records separately.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>record_filter</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">only examine records that match this filter</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>day_filter</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">only examine days that match this filter</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="Standard_engine.js.html">Standard/engine.js</a>, <a href="Standard_engine.js.html#line903">line 903</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="DiaryStandard.html#summarise_records">summarise_records</a></li>
        </ul>
    </dd>
    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    MaybeDiaryStandardStatistics
</div>



    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>console.log( diary.total_per_day(
  record => record.status == "asleep", // only count sleep records
  record => record.start > cutoff      // ignore old records
) );
-> {
                   average           : 1.234,
                   mean              : 1.345,
     interquartile_mean              : 1.234,
                   standard_deviation: 0.123,
     interquartile_standard_deviation: 0.012,
                   median            : 1,
     interquartile_range             : 1,
                   counts            : [ undefined, 1, undefined, ... ],
     interquartile_counts            : [ 1, 1, 2, 1, 1, 0, ... ],
     // included for compatibility with summarise_* functions:
                   durations         : [ undefined, 1, undefined, ... ],
     interquartile_durations         : [ 1, 1, 2, 1, 1, 0, ... ],
   }</code></pre>



        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DiaryActivityLog.html">DiaryActivityLog</a></li><li><a href="DiaryBase.html">DiaryBase</a></li><li><a href="DiaryLoader.html">DiaryLoader</a></li><li><a href="DiaryPleesTracker.html">DiaryPleesTracker</a></li><li><a href="DiarySleepAsAndroid.html">DiarySleepAsAndroid</a></li><li><a href="DiarySleepChart1.html">DiarySleepChart1</a></li><li><a href="DiarySleepmeter.html">DiarySleepmeter</a></li><li><a href="DiarySpreadsheetGraph.html">DiarySpreadsheetGraph</a></li><li><a href="DiarySpreadsheetTable.html">DiarySpreadsheetTable</a></li><li><a href="DiaryStandard.html">DiaryStandard</a></li><li><a href="Spreadsheet.html">Spreadsheet</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-Graph your day lengths.html">Graph your day lengths</a></li><li><a href="tutorial-List supported formats.html">List supported formats</a></li><li><a href="tutorial-Using diary objects.html">Using diary objects</a></li></ul><h3>Global</h3><ul><li><a href="global.html#debugging">debugging</a></li><li><a href="global.html#DiaryStandardRecordStatus">DiaryStandardRecordStatus</a></li><li><a href="global.html#new_sleep_diary">new_sleep_diary</a></li><li><a href="global.html#sleepdiary_engines">sleepdiary_engines</a></li><li><a href="global.html#system_timezone">system_timezone</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Jul 27 2021 06:02:55 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>